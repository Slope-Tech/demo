"use strict";(self.heliuxModules=self.heliuxModules||[]).push([[1020],{41453:(e,t,i)=>{var o=i(54705),s=i(58480),r=i(31080),n=i(87587),l=i(37252);const c={selectors:{loadingSpinner:"heliux-spinner"},types:{delete:"delete",login:"login",logout:"logout",register:"register",resendVerificationEmail:"resendVerificationEmail"},classes:{disabled:"disabled"},publishes:{ciamStart:e=>`ciam::${e}::start`,showSpinner:e=>`spinner:${e}:show`,hideSpinner:e=>`spinner:${e}:hide`},externalEvents:{publishes:{externalEventFlowClick:"ciam:calltoaction:waitForEventToProceed:clicked"},subscribes:{externalEventFlowWaitToProceed:"ciam:calltoaction:waitForEventToProceed",externalEventFlowProceed:"ciam:calltoaction:waitForEventToProceed:proceed"}}};function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){(0,o.A)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}class d extends s.ComponentBase{init(){this.config=h(h({},c),this.config),this.logger=new l.V("CiamCallToAction"),this.getElements(),this.addEvents(),this.subscribedForEventToProceed=!1,this.raqnCommerceStore=(0,r.KA)("raqnCommerce"),this.userStore=(0,r.KA)(n.EF)}addEvents(){this.el.addEventListener("click",(async e=>this.onClick(e)))}onClick(e){if(e.preventDefault(),this.shouldWaitForExternalEventToProceed)return this.waitForExternalEventToProceed(),void this.publishClickForExternalFlow();this.performButtonAction()}performButtonAction(){const{type:e}=this.config,{ciamStart:t}=this.config.publishes,i=t(e);this.disableButtonOnDeleteAction(),this.showLoadingSpinner(),this.logger.log("Message published",i);let o={};"optout"===e&&(o={newsletterAuthority:this.config.newsletterPolicy,optOutPolicies:this.config.optOutPolicies,flow:this.config.flow}),(0,s.publish)(i,h(h({},o),{},{redirectUrl:this.redirectUrl}))}get redirectUrl(){const{flow:e,redirectUrl:t,type:i}=this.config;return"login"===i&&t&&this.userStore&&(this.userStore.redirects=h(h({},this.userStore.redirects),{},{successfullLogin:t})),"redirect"===e||"optout"===i?t:""}get shouldWaitForExternalEventToProceed(){var e,t;const{subscribes:i}=this.config.externalEvents;return null===(e=this.raqnCommerceStore)||void 0===e||null===(t=e[i.externalEventFlowWaitToProceed])||void 0===t?void 0:t.includes(window.location.href)}waitForExternalEventToProceed(){const{subscribes:e}=this.config.externalEvents;if(this.subscribedForEventToProceed)return;const t=i=>{this.el.id===i&&(this.logger.log("[external events flow] Proceed with button action",this.el.id),this.performButtonAction(),(0,s.unsubscribe)(e.externalEventFlowProceed,t.bind(this)),this.subscribedForEventToProceed=!1)};this.logger.log("[external events flow] Wait for external event to proceed",this.el.id),(0,s.subscribe)(e.externalEventFlowProceed,t.bind(this)),this.subscribedForEventToProceed=!0}publishClickForExternalFlow(){const{publishes:e}=this.config.externalEvents;this.logger.log("[external events flow] Click message published",this.el.id),(0,s.publish)(e.externalEventFlowClick,{id:this.el.id},{usePostMessage:!0})}disableButtonOnDeleteAction(){this.config.type===this.config.types.delete&&(this.el.style.pointerEvents="none",this.el.classList.add(this.config.classes.disabled))}showLoadingSpinner(){const{publishes:e}=this.config;this.loadingSpinner&&(0,s.publish)(e.showSpinner(this.loadingSpinner.id))}}(0,s.register)({CiamCallToAction:d},0)}},e=>{e.O(0,[750],(()=>(41453,e(e.s=41453)))),e.O()}]);