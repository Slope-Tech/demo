"use strict";(self.heliuxModules=self.heliuxModules||[]).push([[9192],{51113:(e,t,s)=>{var r=s(54705),a=s(58480),i=s(70228),n=s(7684),o=s(75854),u=s(62130),l=s(31080);const c=(e,t,{skipKeysNumberCheck:s})=>{let r=!0;const a=e=>null!=e&&"object"==typeof e;if(!a(e)||!a(t))return!1;const i=Object.keys(e),n=Object.keys(t);return!(!s&&i.length!==n.length)&&(i.forEach((i=>{const n=e[i],o=t[i],u=a(n)&&a(o);(u&&!c(n,o,{skipKeysNumberCheck:s})||!u&&n!==o)&&(r=!1)})),r)};var g=s(17249),h=s(63645),d=s(7873);const p={preferredLanguage:"preferredLanguage",urlParam:"languageUpdated",topics:{redirectToLanguage:"redirect::to::language"}};function f(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function b(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?f(Object(s),!0).forEach((function(t){(0,r.A)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):f(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class m extends a.ComponentBase{init(){this.config=b(b({},p),this.config),this.urlLanguage=this.getUrlLanguage(),this.userStore=new g.L,this.store=this.userStore.getStore(),this.userApi=(0,i.q)(this.config),this.config.userApiV2Url&&(this.userApiV2=(0,n.c)(this.config)),(0,h.jk)().then((e=>{e&&this.onUserLogIn().then((()=>""))})),this.addListeners()}addListeners(){(0,a.subscribe)(d.v.userLoggedIn,(()=>{this.onUserLogIn().then((()=>""))})),(0,a.subscribe)(d.v.delete,(async()=>{await this.userApi.deleteUser()})),(0,a.subscribe)(d.v.taxExemptionOnSubmit,(async({data:e,callbackMessage:t})=>{this.handleUserTaxExemptionRequest({data:e,callbackMessage:t})})),(0,a.subscribe)(d.v.resendVerificationEmail,(async e=>{this.resendVerificationEmail(e)}))}async onUserLogIn(){const e=await this.getUserData();e&&(this.config.forceRedirectToUserLanguage&&await this.handleUserLanguage(e),await this.redirectOnFirstLogin(this.store.redirects,e.signedInBefore),this.updateUserStore(e))}async redirectOnFirstLogin(e,t){return(0,u.l3)(this.config.userProfilePageUrl,e,t,(e=>{this.userStore.updateRedirects(e)}))}async updateUserLanguage(e,t){e&&t&&e.language!==t&&await this.userApi.updateUserData({User:{email:e.email,language:t}})}getUrlLanguage(){return new URLSearchParams(window.location.search).get(this.config.urlParam)}async getUserData(){var e;return Promise.allSettled([this.userApi.getUserData(),null===(e=this.userApiV2)||void 0===e?void 0:e.getUserData()]).then((e=>{let t,s=[];return e.forEach((e=>{var r,a;"fulfilled"===e.status&&(null!=e&&null!==(r=e.value)&&void 0!==r&&r.details?t=e.value:s=(null==e||null===(a=e.value)||void 0===a?void 0:a.groups)||[])})),t?(t.groups=s,t):null}))}async handleUserLanguage(e){const t=e.details||e;if(this.urlLanguage)await this.updateUserLanguage(t,this.urlLanguage);else{const e=t.language;await(0,u.Pm)(e)}}updateUserStore(e){this.userStore.update(e,"api"),(0,a.publish)(d.v.reRenderOnAccountRefreshed)}async handleUserTaxExemptionRequest({data:e,callbackMessage:t}){var s,r;const i=e.customer,n=null===(s=this.store)||void 0===s?void 0:s.user,u=(0,o.Hi)(b(b({},i),{},{email:null==n||null===(r=n.details)||void 0===r?void 0:r.email}));c(u.company,null==n?void 0:n.company,{skipKeysNumberCheck:!0})?(0,a.publish)(t):await this.userApi.updateUserData(u).then((async()=>i.id?i.id:this.userApi.getUserCompanyId())).then((e=>{(0,a.publish)(t,{companyId:e})})).catch((e=>{const s=e.toJSON();(0,a.publish)(t,{error:s.message||e})}))}resendVerificationEmail({redirectUrl:e,email:t}){const s=(0,l.KA)("formSummary")["user.email"],r=t||s;r&&this.userApi.resendVerificationEmail(r).then((()=>{window.location=e}))}}(0,a.register)({CiamUser:m},0)}},e=>{e.O(0,[750,7694,4253,9397,5117],(()=>(51113,e(e.s=51113)))),e.O()}]);