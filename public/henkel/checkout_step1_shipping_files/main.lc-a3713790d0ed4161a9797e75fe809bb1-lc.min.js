"use strict";(self.heliuxModules=self.heliuxModules||[]).push([[6993],{93939:(e,t,n)=>{n.d(t,{D:()=>L});var i=n(54705),s=n(58480),r=n(28131),o=n(48669),c=n(88760),a=n(87696),l=n(9911),h=n(7873),u=n(31736),g=n(82303),d=n(29789),p=n(60059),_=n(36097),f=n(43783),y=n(78261),k=n(80648),m=n(37252);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class S{constructor(e){const t=((e={})=>{const{LogLevel:t}=e;return{auth:{clientId:e.clientId,authority:e.authority,knownAuthorities:e.knownAuthorities,redirectUri:e.loginRedirectUrl,postLogoutRedirectUri:e.logoutRedirectUrl,navigateToLoginRequestUrl:!e.forceRedirectToLoginPage},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{logLevel:t.Verbose,loggerCallback:(e,n,i)=>{const s=new m.V("MSAL Plugin"),r=` : ${t[e]} - `,o=n.split(r),c=2===o.length?o[1]:n;if(!i)switch(e){case t.Error:return void s.error(c);case t.Info:case t.Verbose:return void s.info(c);case t.Warning:return void s.warning(c);default:s.info(c)}}}}}})(w({LogLevel:u.$},e));this.logger=new m.V("MsalCore"),this.config=w({msalConfig:t},e),this.__msalSDK=new g.v(t),this.__msalSDK.enableAccountStorageEvents()}get Utils(){const{userFlow:e}=this.config;return{get isPopup(){return e===d.X8.Popup},EventType:p.B,InteractionRequiredAuthError:_.CB,urlHash:new k.u(f.H.getDeserializedHash,y.$.decodeAuthToken)}}}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class v extends S{constructor(e={}){super(e),this.logger.name="MsalSdk",this.logger.info("[constructor]"),this.perf=r.j,this.perf.mark("ELearningMain init start",{test:2}),this.topics=h.v||{},this.__authToken=null,this.calbackIds={},this.currentAccount=this.__getCurrentAccount(),this.__mappedData=(0,a.M)(this.currentAccount)}set token(e){this.__authToken=e}get token(){return this.__authToken}set account(e){this.__mappedData=e?(0,a.M)(e):null}get account(){return this.__mappedData}get email(){var e,t;return(null===(e=this.account)||void 0===e||null===(t=e.account)||void 0===t?void 0:t.email)||""}__getCurrentAccount(){const e=this.__msalSDK.getAllAccounts()||[],t=this.currentAccount||e[0];return e.length>1?(this.logger.info("[__getCurrentAccount]: Multiple accounts scenario",t),e[0]):1===e.length?(this.logger.info("[__getCurrentAccount]: Single account scenario"),e[0]):t}__addEvents(){this.listenAllEvents((async e=>{switch(e.eventType){case this.Utils.EventType.LOGIN_SUCCESS:case this.Utils.EventType.LOGIN_FAILURE:case this.Utils.EventType.SSO_SILENT_SUCCESS:return this.__onLogin(e);case this.Utils.EventType.LOGOUT_SUCCESS:case this.Utils.EventType.LOGOUT_FAILURE:return this.__onLogout(e);default:return null}}),"all")}__refreshCurrentAccount(e,t){if(!e)return;const n=this.account;this.account=e,e.homeAccountId&&(this.currentAccount=this.getHomeAccount(e.homeAccountId),t&&this.emmitAccountUpdated(n))}emmitAccountUpdated(e){const t=(0,a.Z)(e,this.account);this.currentAccount&&t&&this.emitEvent(this.topics.userAccountRefreshed,this.account)}getHomeAccount(e){return this.__msalSDK.getAccountByHomeId(e)}getActiveAccount(){return this.__msalSDK.getActiveAccount()}handleRedirectPromise(){return this.__msalSDK.handleRedirectPromise()}emitEvent(e,t){e||this.logger.warning("Event topic is missing. Event not triggered"),this.__msalSDK.eventHandler.emitEvent(e,null,t)}listenAllEvents(e,t="all"){this.calbackIds[t]=this.__msalSDK.addEventCallback(e)}listenEvent(e,t=(()=>{})){this.calbackIds[e]=this.__msalSDK.addEventCallback((n=>{n.eventType===e&&t(n)}))}listenEventAsync(e,t=1e4){return(0,c.c)(this.listenEvent.bind(this),e,t)}__getTokenFromData({authToken:e,idToken:t}={}){return e||t}async __onLogin(e){const t=e.payload,n=e.error;if(!t)return this.showMessage("user.login_failed-title","user.login_failed-description"),this.logger.info(n),void this.emitEvent(this.topics.userLoginError);const{account:i}=t;this.__msalSDK.setActiveAccount(i),await this.__refreshData(t,!1),this.logger.info("__onLogin done",i),this.emitEvent(this.topics.userLoggedIn,i),this.showMessage("user.login_successful-title","user.login_successful-description","info")}__onLogout(e){const t=e.payload;if(!t)return this.showMessage("user.logout_failed-title","user.logout_failed-description"),void this.emitEvent(this.topics.userLogoutError);const n=t.postLogoutRedirectUri;this.__destroyData(),this.logger.info("__onLogout done",n),this.emitEvent(this.topics.userLoggedOut)}async __refreshData(e,t,n){e&&e.account?(this.__refreshCurrentAccount(e.account,!0),await this.__refreshToken(e,t,n)):this.__destroyData()}__destroyData(){this.account=null,this.token=null,this.logger.info("Data destroyed")}async __getRedirectPromiseResponse(){try{const e=await this.handleRedirectPromise();return this.__getRequestObj(e)}catch(e){return this.logger.warning(e),null}}__getRequestObj(e){return null!==e?e:{account:this.__getCurrentAccount()}}__handleResponse(){return this.token}__handleError(e={}){this.logger.warning(e),this.showMessage("error.general_error-title",`${e.message}`,"error",!1)}async __refreshToken(e,t,n=!0){let i=this.__getTokenFromData(e);return i&&this.token===i||(this.logger.info("__refreshToken with ",{response:e,skipNetwork:t}),i||(i=await this.__getTokenSilent(null,n,t)),this.token=i,(0,l.O)(this.config.tokenCookieName,i),this.emitEvent(this.topics.userTokenRefreshed,this.account)),i}async __getTokenSilent(e,t,n){const i="boolean"!=typeof t||t,s="boolean"==typeof n&&n,r=A(A({},s?this.scopes.silentCache:this.scopes.silent),e||{});if(e||(r.account=this.currentAccount),!r.account&&i)return this.logger.info("__getTokenSilent aborted, account missing"),null;if(!r.account&&!i){this.logger.warning("__getTokenSilent aborted, account missing, fallback to interaction");const e=A(A({},r),{},{prompt:"login"}),t=this.__getTokenWithInteraction(e);return this.token=t,t}let o;this.logger.info("acquireTokenSilent starting",{initialRequest:e,shouldSkipUI:i,shouldSkipNetwork:s,request:r});try{o=await this.__acquireTokenSilent(r,i)}catch(e){this.logger.error("acquireTokenSilent failed")}return this.token=o,o}async __acquireTokenSilent(e,t=!0){let n;try{n=await this.__msalSDK.acquireTokenSilent(e),this.logger.info("acquireTokenSilent response received");const i=this.__getTokenFromData(n);if(!t&&!i)throw new this.Utils.InteractionRequiredAuthError;return i}catch(n){if(this.logger.error("acquireTokenSilent error",n),t||!(n instanceof this.Utils.InteractionRequiredAuthError))return null;this.logger.warning("acquireTokenSilent failed, fallback to interaction");const i=A(A({},e),{},{prompt:"login"});return this.__getTokenWithInteraction(i)}}async __getTokenWithInteraction(e){return this.Utils.isPopup?(this.logger.info("Acquiring token using popup."),this.__msalSDK.acquireTokenPopup(e).then((e=>(this.logger.info("acquireTokenPopup response",e),this.__getTokenFromData(e)))).catch((e=>(this.logger.error("acquireTokenPopup error",e),null)))):(this.logger.info("Acquiring token using redirect."),this.__msalSDK.acquireTokenRedirect(e).then((e=>(this.logger.info("acquireTokenRedirect response",e),this.__getTokenFromData(e)))).catch((e=>(this.logger.error("acquireTokenRedirect error",e),null))))}showMessage(e,t,n="info",i=!0){return window.heliuxGigyaService&&window.heliuxGigyaService.isEnabled?null:this.emitEvent(this.topics.notification,{autoHide:i,type:n,title:e,description:t})}}var R=n(67941),I=n(63645),T=n(52060),P=n(47533),E=n(87587);const C={scopes:{login:{scopes:["openid","profile"],forceRefresh:!1},silent:{scopes:["openid","profile","offline_access"],forceRefresh:!0},silentCache:{scopes:["openid"],forceRefresh:!1}},tokenCookieName:"CIAM_TOKEN"};function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class L extends v{constructor(e={}){var t;const n=j(j({},C),e);super(n),this.scopes=n.doNotExtendScope?n.scopes:((e={},t=!1)=>{const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return Object.keys(n).forEach(((e={})=>{t&&n[e].scopes&&n[e].scopes.push(t)})),n})(n.scopes,n.clientId),this.extraQueryParameters=n.extraQueryParameters||{},this.skipUI=n.skipUI||!0,this.logger.name="CiamSDK",this.isInit=!0,this.isEnabled=null===(t=this.getCIAMInstance())||void 0===t?void 0:t.isEnabled,this.isReady=!1,this.logoutRedirectUrl=n.logoutRedirectUrl,this.perf=r.j,this.perf.mark("CiamSDK init")}static get name(){return"CiamSDK"}init(e){this.__addEvents(),this.__refreshCurrentAccount(this.currentAccount),this.__checkUrlHashForIdToken(),(0,c.N2)(this.checkUserOnPageLoad(),e).then((async()=>{this.isReady=!0,this.logger.info("initSDK CIAM is ready."),this.emitEvent(this.topics.apiready)})).catch((async e=>{this.isReady=!1,this.logger.info("initSDK CIAM on ready error",e)})),this.logger.info("INIT CIAM initialized."),this.emitEvent(this.topics.apiInit)}get isLoggedIn(){return!!this.account}__signInPopup(e){const t=j(j({},this.getRequestConfig(this.scopes.login,e)),{},{popupWindowAttributes:this.getSignInPopupWindowAttributes()});return this.__msalSDK.loginPopup(t).then((()=>this.__handleResponse())).catch((e=>(this.__handleError(e),null)))}getSignInPopupWindowAttributes(){const{popUpWidth:e}=this.config;if(!e)return null;const t=document.documentElement.clientWidth;return{popupPosition:{left:screenX+(t-e)/2},popupSize:{width:e}}}__signInRedirect(e){const t=this.getRequestConfig(this.scopes.login,e);return this.__msalSDK.loginRedirect(t)}__checkUrlHashForIdToken(){if(this.currentAccount)return null;let e;try{e=this.Utils.urlHash.getTokenHint()}catch(e){this.logger.error("[__getCurrentAccount]: error parsing hash",e.message)}return e?this.ssoSilentLogin():null}async checkUserOnPageLoad(){const e=this.getActiveAccount(),t=e?{account:e}:await this.__getRedirectPromiseResponse();return await this.__refreshData(t,!0),this.account}async onReadyPromise(e){const t=(0,I.g)();if(t.isReady)return t;const n=await this.listenEventAsync(this.topics.apiready,e);return!n&&t.isReady?t:n?n.payload:null}async onReadyPromiseV1(e){const t=(0,I.g)();window.RAQN=window.RAQN||{};const n=window.RAQN.CIAM||{};return t.isReady&&n.sdk?(window.RAQN.CIAM.isReady=!0,n.sdk):!await this.listenEventAsync(this.topics.apiready,e)&&t.isReady&&n.sdk||n.sdk?n.sdk:null}async getToken(e){return this.token||this.getCachedToken(e)}async getCachedToken(e,t){const n="boolean"==typeof t?t:this.skipUI;return this.__getTokenSilent(e,n,!0)}async getRefreshedTokenWithFallback(e){let t;try{return t=await this.getRefreshedToken(e,this.skipUI),t}catch(e){}try{return t=await this.getCachedToken(e,this.skipUI),t}catch(e){}return this.token}async getRefreshedToken(e,t){const n="boolean"==typeof t?t:this.skipUI;return this.__getTokenSilent(e,n,!1)}async getTokens(e,t){const n="boolean"==typeof t?t:this.skipUI;return new Promise(((t,i)=>{this.__getTokenSilent(e,n,!1).then((e=>{t({idToken:e})})).catch((e=>{i(e)}))}))}async __acquireTokenSilent(e,t=!0){const n=await super.__acquireTokenSilent(e,t);return n||this.signOut({skipRedirect:!0}),n}getSSOConfig(e={}){const t=j(j(j({},(0,R.P)(this.config.extraParameters)||{}),this.extraQueryParameters),e);return this.getRequestConfig(this.scopes.silent,{extraQueryParameters:t})}isObjectEmpty(e){return!e||"object"!=typeof e||0===Object.keys(e).length}isValueDefined(e){return"boolean"==typeof e||!!e}filterUndefinedProps(e){if(this.isObjectEmpty(e))return null;const t={};return Object.entries(e).forEach((([e,n])=>{this.isValueDefined(n)&&(t[e]=n)})),t}getRequestConfig(e,t){const n=this.filterUndefinedProps(t);return j(j({},e),!this.isObjectEmpty(n)&&n)}getSSOParams(e={}){const t=j(j(j({},(0,R.P)(this.config.extraParameters)||{}),this.extraQueryParameters),e),n=!t||0===Object.keys(t).length,{scopes:i}=this.scopes.silent;return j({response_type:"code",response_mode:"fragment",code_challenge:"abc",code_challenge_method:"S256",nonce:12345,scope:i.join(" "),client_id:this.config.clientId,redirect_uri:this.config.loginRedirectUrl},!n&&t)}getSSOUrl(e={}){const t=this.getSSOParams(e),n=new URLSearchParams(t);return`${this.config.authority}/oauth2/v2.0/authorize?${n.toString()}`}async ssoSilentLogin(e={}){this.perf.mark("ssoSilentLogin start");const t=this.__getCurrentAccount(),n=this.getSSOConfig(e);return this.logger.info("Starting ssoSilentLogin",n),t?this.__getTokenSilent(n,this.skipUI):(this.perf.mark("msalSDK.ssoSilent start"),this.__msalSDK.ssoSilent(n).then((async()=>(this.logger.log("ssoSilent success"),this.emitEvent(this.topics.userLoggedIn),this.perf.mark("msalSDK.ssoSilent end"),this.__handleResponse()))).catch((async e=>(this.logger.error("ssoSilent failed, start acquireTokenSilent",e),this.__getTokenSilent(n,this.skipUI)))))}async signIn(e,t){if(this.logger.info("signIn start",e),(t?"popup"===t:this.Utils.isPopup)&&!(0,o.Fr)())return this.getActiveAccount()?(this.showMessage("user.already_logged_in-title","user.already_logged_in-description"),null):this.__signInPopup(e);try{const e=await this.handleRedirectPromise();this.logger.info("msal redirect promise resolved",e)}catch(e){return this.logger.warning(e),null}return this.getActiveAccount()?(this.showMessage("user.already_logged_in-title","user.already_logged_in-description"),null):this.__signInRedirect(e)}async signOut({skipRedirect:e}={skipRedirect:!1}){if(this.logger.info("signOut start"),!this.isLoggedIn)return void this.logger.info("signOut: user not logged in");const t={account:this.currentAccount,popupWindowAttributes:(0,T.o)()};(0,s.removeCookie)(this.config.tokenCookieName),this.Utils.isPopup?(await this.__msalSDK.logoutPopup(t),!e&&this.logoutRedirectUrl&&(window.location=this.logoutRedirectUrl)):await this.__msalSDK.logoutRedirect(t)}async openCustomPopup(e,t,n){this.logger.info("openCustomPopup start",e,t,n);const i=n?"popup"===n:this.Utils.isPopup,s=j({client_id:this.config.clientId,redirect_uri:this.config.logoutRedirectUrl,scope:"openid",response_type:"id_token"},t),r=`${e}/oauth2/v2.0/authorize?${new URLSearchParams(s).toString()}`;return i&&!(0,o.Fr)()?window.open(r):window.open(r,"_blank")}async refreshLongLivedToken(){return(0,P.uz)(this.config.tokenUrl,this.token)}public(){const e=this;return{extraParameters:e.config.extraParameters,topics:e.topics,isInit:e.isInit,isEnabled:e.isEnabled,get isReady(){return e.isReady},get signedIn(){return e.isLoggedIn},get token(){return e.token},get account(){return e.account},onReady:e.onReadyPromise.bind(e),signIn:e.signIn.bind(e),signOut:e.signOut.bind(e),silentLogin:e.ssoSilentLogin.bind(e),getCachedToken:e.getCachedToken.bind(e),getRefreshedToken:e.getRefreshedToken.bind(e),getRefreshedTokenWithFallback:e.getRefreshedTokenWithFallback.bind(e),getTokens:e.getTokens.bind(e),onReadyV1:e.onReadyPromiseV1.bind(e),emitEvent:e.emitEvent.bind(e),listenEvent:e.listenEvent.bind(e),listenEventAsync:e.listenEventAsync.bind(e),listenAllEvents:e.listenAllEvents.bind(e),getSSOUrl:e.getSSOUrl.bind(e),refreshLongLivedToken:e.refreshLongLivedToken.bind(e),openCustomPopup:e.openCustomPopup.bind(e),Utils:e.Utils}}create(){if(!this.isEnabled)return this.logger.info("INIT CIAM not enabled. exit."),null;const e=this.getCIAMInstance();return e.isInit?(this.logger.info("INIT CIAM already initialized. exit.",e),e):(window[E.CU]=this.public(),this.logger.info("setGlobalInstance CIAM global instance set."),this.__setDeprecatedNS(),this.getCIAMInstance())}__setDeprecatedNS(){const e=this.public();window.RAQN=window.RAQN||{},window.RAQN.CIAM=window.RAQN.CIAM||{},window.RAQN.CIAM.isReady=e.isReady,window.RAQN.CIAM.onReady=e.onReadyV1,window.RAQN.CIAM.sdk=e,window.RAQN.CIAM.sdk.getRefreshedToken=e.getTokens}getCIAMInstance(){return window[E.CU]}}}}]);