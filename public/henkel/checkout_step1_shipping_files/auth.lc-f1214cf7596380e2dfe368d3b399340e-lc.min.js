"use strict";(self.heliuxModules=self.heliuxModules||[]).push([[7267],{77602:(e,t,s)=>{var i=s(54705),r=s(58480),a=s(28131),o=s(67941),n=s(11608),h=s(62130),c=s(87587),u=s(30082),d=s(17249),p=s(93939);function l(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function m(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?l(Object(s),!0).forEach((function(t){(0,i.A)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}performance.mark("CiamAuth file loaded");class f extends r.ComponentBase{init(){var e;this.perf=a.j,this.perf.mark("CiamAuth init");const t=(0,o.P)(this.config.extraParameters);this.config=m(m({},this.config),{},{extraQueryParameters:t}),this.ciamSDK=new p.D(this.config),this.sdk=this.ciamSDK.create(),this.topics=this.sdk.topics,this.HashUtils=this.sdk.Utils.urlHash,this.userStore=new d.L(null===(e=this.sdk)||void 0===e?void 0:e.account),this.store=this.userStore.getStore(),(0,n.Co)(c.s_),this.config.isUserVerificationPage&&(0,r.subscribe)("AdobeAnalytics:events:ready",(()=>{(0,r.publish)("AdobeAnalytics:ciam:register:verified")})),this.checkErrorMessage(),this.initSDK()}initSDK(){this.addEvents(),this.ciamSDK.init()}checkErrorMessage(){const e=this.HashUtils.getErrorMessage();e&&(0,u.t2)(m(m({},e),{},{forceRender:!0,autoHideTime:12e3}))}addEvents(){this.sdk.listenAllEvents((e=>{var t;switch(e.eventType){case this.topics.apiready:this.perf.mark("CiamAuth ready"),(e=>{try{performance.measure("0 --\x3e> HTML head start",{},"HTML head start"),e.measure("HTML head start","HTML head end"),e.measure("HTML body start","HTML body end"),e.measure("CiamAuth script injected","CiamAuth file loaded"),e.measure("CiamAuth file loaded","CiamAuth init"),e.measure("HTML head start","CiamAuth init"),e.measure("CiamAuth init","CiamAuth ready"),e.measure("CiamAuth init","CiamAuth refreshed"),e.measure("CiamAuth init","CiamAuth verified")}catch(e){}})(this.perf),this.handleRedirects();break;case this.topics.userAccountRefreshed:this.userStore.update(e.payload,"refreshed"),this.perf.mark("CiamAuth refreshed");break;case this.topics.userTokenRefreshed:this.perf.mark("CiamAuth verified"),this.userStore.updateToken(null===(t=e.payload)||void 0===t?void 0:t.idToken,"verified");break;case this.topics.userLoggedIn:this.userStore.updateStatus("login"),this.handleRedirects();break;case this.topics.userLoggedOut:this.userStore.clear()}(0,r.publish)(e.eventType,e.payload,{usePostMessage:!0})})),(0,r.subscribe)(this.topics.login,(async e=>{await this.sdk.signIn(e)})),(0,r.subscribe)(this.topics.logout,(async e=>{await this.sdk.signOut(e)})),(0,r.subscribe)(this.topics.optOut,(async e=>{this.handleCustomPopup(e)})),this.listenPopupEvents()}async handleRedirects(){this.store.logged?(this.config.isLoginPage&&await(0,n.$k)(c.s_),await(0,h.Hx)(this.store.redirects,(e=>{this.userStore.updateRedirects(e)}))):(0,n.Lq)(c.s_)}handleCustomPopup(e){const t=this.HashUtils.getIdTokenHint();if(!t)return void(0,u.t2)({title:"Opt Out Error",description:"ID Token Hint missing",forceRender:!0,autoHideTime:12e3});const s={id_token_hint:t,unsubscribe:e.optOutPolicies,redirect_uri:e.redirectUrl};this.sdk.openCustomPopup(e.newsletterAuthority,s,e.flow)}listenPopupEvents(){window.addEventListener("message",(e=>{const t=this.config.knownAuthorities||[],{host:s}=new URL(e.origin);if(e&&e.data){const{message:i,params:a}=e.data;i&&t.includes(s)&&(0,r.publish)(i,a)}}))}}(0,r.register)({CiamAuth:f},0)}},e=>{e.O(0,[750,4253,5117,5729,6993],(()=>(77602,e(e.s=77602)))),e.O()}]);