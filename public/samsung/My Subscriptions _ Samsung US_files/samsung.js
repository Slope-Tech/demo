(function(window) {
	try {
		window.BAMX = window.BAMX || {};
		window.BAMX.GLOBALS = window.BAMX.GLOBALS || {
			LOADED: {},
			PROMISE: {},
			AUCTION_MAP: {},
			BAM_BOX: {}
		};

		var CONTAINED_BAMX_OBJ = {
			IS_IFRAME: window.BAMX.IS_IFRAME,
			DEBUG_MODE: false,
			ENV: 'release',
			GITHASH: '7062f75303a127fa71d674a3a89dbf00d0e0dd4e',
			CORE_CONFIG: {
				isPreview: false
			}
		};

		/* Preview mode can be turned on if isPreview is set to true
		 * in the BAMX window object.
		 */
		if (window.BAMX.CORE_CONFIG && window.BAMX.CORE_CONFIG.isPreview) {
			CONTAINED_BAMX_OBJ.CORE_CONFIG.isPreview = window.BAMX.CORE_CONFIG.isPreview;
		}
		window.BAMX.CORE_CONFIG = CONTAINED_BAMX_OBJ.CORE_CONFIG;

		// Prevent amd from causing Bluebird to try and load using amd
		if (typeof(window.define) === 'function' && window.define.amd) {
			window._bamDefine = window.define;
			window.define = null;
		}

		"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Promise=t()}}(function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof _dereq_&&_dereq_;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return i(n||t)},u,u.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){e.exports=function(t){function e(t){var e=new n(t),r=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),r}var n=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e,n){function r(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new c(16),this._normalQueue=new c(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=l}function i(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function o(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function s(t){this._normalQueue._pushOne(t),this._queueTick()}var a;try{throw new Error}catch(t){a=t}var l=t("./schedule"),c=t("./queue"),u=t("./util");r.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},r.prototype.hasCustomScheduler=function(){return this._customScheduler},r.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},r.prototype.disableTrampolineIfNecessary=function(){u.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},r.prototype.fatalError=function(t,e){e?(process.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),process.exit(2)):this.throwLater(t)},r.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},u.hasDevTools?(r.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?i.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},r.prototype.invoke=function(t,e,n){this._trampolineEnabled?o.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},r.prototype.settlePromises=function(t){this._trampolineEnabled?s.call(this,t):this._schedule(function(){t._settlePromises()})}):(r.prototype.invokeLater=i,r.prototype.invoke=o,r.prototype.settlePromises=s),r.prototype.invokeFirst=function(t,e,n){this._normalQueue.unshift(t,e,n),this._queueTick()},r.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var n=t.shift(),r=t.shift();e.call(n,r)}else e._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},e.exports=r,e.exports.firstLineError=a},{"./queue":26,"./schedule":29,"./util":36}],3:[function(t,e,n){e.exports=function(t,e,n,r){var i=!1,o=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},l=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){i||(i=!0,t.prototype._propagateFrom=r.propagateFromFunction(),t.prototype._boundValue=r.boundValueFunction());var c=n(o),u=new t(e);u._propagateFrom(this,1);var h=this._target();if(u._setBoundTo(c),c instanceof t){var p={promiseRejectionQueued:!1,promise:u,target:h,bindingPromise:c};h._then(e,s,void 0,u,p),c._then(a,l,void 0,u,p),u._setOnCancel(c)}else u._resolveCallback(h);return u},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},{}],4:[function(t,e,n){function r(){try{Promise===o&&(Promise=i)}catch(t){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=t("./promise")();o.noConflict=r,e.exports=o},{"./promise":22}],5:[function(t,e,n){var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}e.exports=function(e){function n(t,n){var r;if(null!=t&&(r=t[n]),"function"!=typeof r){var i="Object "+a.classString(t)+" has no method '"+a.toString(n)+"'";throw new e.TypeError(i)}return r}function r(t){return n(t,this.pop()).apply(t,this)}function i(t){return t[this]}function o(t){var e=+this;return 0>e&&(e=Math.max(0,e+t.length)),t[e]}var s,a=t("./util"),l=a.canEvaluate;a.isIdentifier,e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(r,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e;if("number"==typeof t)e=o;else if(l){var n=s(t);e=null!==n?n:i}else e=i;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(t,e,n){e.exports=function(e,n,r,i){var o=t("./util"),s=o.tryCatch,a=o.errorObj,l=e._async;e.prototype.break=e.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t.isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n.isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),e=t,t=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=s(t).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),l.throwLater(r.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,n){e.exports=function(e){function n(t,n,a){return function(l){var c=a._boundValue();t:for(var u=0;u<t.length;++u){var h=t[u];if(h===Error||null!=h&&h.prototype instanceof Error){if(l instanceof h)return o(n).call(c,l)}else if("function"==typeof h){var p=o(h).call(c,l);if(p===s)return p;if(p)return o(n).call(c,l)}else if(r.isObject(l)){for(var f=i(h),d=0;d<f.length;++d){var _=f[d];if(h[_]!=l[_])continue t}return o(n).call(c,l)}}return e}}var r=t("./util"),i=t("./es5").keys,o=r.tryCatch,s=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(t,e,n){e.exports=function(t){function e(){this._trace=new e.CapturedTrace(r())}function n(){return i?new e:void 0}function r(){var t=o.length-1;return t>=0?o[t]:void 0}var i=!1,o=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=o.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=n,e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var n=t.prototype._pushContext,o=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,l=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=n,t.prototype._popContext=o,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=l,i=!1},i=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=r,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},{}],9:[function(t,e,n){e.exports=function(e,n){function r(t,e){return{promise:e}}function i(){return!1}function o(t,e,n){var r=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+M.toString(t));r._attachCancellationCallback(t)})}catch(t){return t}}function s(t){if(!this.isCancellable())return this;var e=this._onCancel();void 0!==e?M.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function a(){return this._onCancelField}function l(t){this._onCancelField=t}function c(){this._cancellationParent=void 0,this._onCancelField=void 0}function u(t,e){if(0!=(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function h(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function p(){var t=this._boundTo;return void 0!==t&&t instanceof e?t.isFulfilled()?t.value():void 0:t}function f(){this._trace=new R(this._peekContext())}function d(t,e){if(B(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=k(t);M.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),M.notEnumerableProp(t,"__stackCleaned__",!0)}}}function _(t,e,n,r,i){if(void 0===t&&null!==e&&z){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="a promise was created in a "+n+"handler but was not returned from it";r._warn(o,!0,e)}}function v(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),y(n)}function y(t,n,r){if(rt.warnings){var i,o=new L(t);if(n)r._attachExtraTrace(o);else if(rt.longStackTraces&&(i=e._peekContext()))i.attachExtraTrace(o);else{var s=k(o);o.stack=s.message+"\n"+s.stack.join("\n")}Y("warning",o)||C(o,"",!0)}}function g(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}function m(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function b(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],i=e.length-1,o=e[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(var a=s;a>=0;--a){var l=r[a];if(e[i]!==l)break;e.pop(),i--}e=r}}function w(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],i="    (No stack trace)"===r||V.test(r),o=i&&tt(r);i&&!o&&(H&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function E(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||V.test(r))break}return n>0&&(e=e.slice(n)),e}function k(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?E(t):["    (No stack trace)"],{message:n,stack:w(e)}}function C(t,e,n){if("undefined"!=typeof console){var r;if(M.isObject(t)){var i=t.stack;r=e+G(i,t)}else r=e+String(t);"function"==typeof I?I(r,n):("function"==typeof console.log||"object"==typeof console.log)&&console.log(r)}}function A(t,e,n,r){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(t){D.throwLater(t)}"unhandledRejection"===t?Y(t,n,r)||i||C(n,"Unhandled rejection "):Y(t,r)}function S(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():M.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+O(e)+">, no stack trace)"}function O(t){return t.length<41?t:t.substr(0,38)+"..."}function T(){return"function"==typeof nt}function P(t){var e=t.match(et);return e?{fileName:e[1],line:parseInt(e[2],10)}:void 0}function j(t,e){if(T()){for(var n,r,i=t.stack.split("\n"),o=e.stack.split("\n"),s=-1,a=-1,l=0;l<i.length;++l){var c=P(i[l]);if(c){n=c.fileName,s=c.line;break}}for(var l=0;l<o.length;++l){var c=P(o[l]);if(c){r=c.fileName,a=c.line;break}}0>s||0>a||!n||!r||n!==r||s>=a||(tt=function(t){if(N.test(t))return!0;var e=P(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=a)})}}function R(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);nt(this,R),e>32&&this.uncycle()}var x,F,I,U=e._getDomain,D=e._async,L=t("./errors").Warning,M=t("./util"),B=M.canAttachTrace,N=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,V=null,G=null,H=!1,X=!(0==M.env("BLUEBIRD_DEBUG")||!M.env("BLUEBIRD_DEBUG")&&"development"!==M.env("NODE_ENV")),q=!(0==M.env("BLUEBIRD_WARNINGS")||!X&&!M.env("BLUEBIRD_WARNINGS")),W=!(0==M.env("BLUEBIRD_LONG_STACK_TRACES")||!X&&!M.env("BLUEBIRD_LONG_STACK_TRACES")),z=0!=M.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(q||!!M.env("BLUEBIRD_W_FORGOTTEN_RETURN"));e.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},e.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),D.invokeLater(this._notifyUnhandledRejection,this,void 0))},e.prototype._notifyUnhandledRejectionIsHandled=function(){A("rejectionHandled",x,void 0,this)},e.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},e.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),A("unhandledRejection",F,t,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},e.prototype._warn=function(t,e,n){return y(t,e,n||this)},e.onPossiblyUnhandledRejection=function(t){var e=U();F="function"==typeof t?null===e?t:e.bind(t):void 0},e.onUnhandledRejectionHandled=function(t){var e=U();x="function"==typeof t?null===e?t:e.bind(t):void 0};var Q=function(){};e.longStackTraces=function(){if(D.haveItemsQueued()&&!rt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!rt.longStackTraces&&T()){var t=e.prototype._captureStackTrace,r=e.prototype._attachExtraTrace;rt.longStackTraces=!0,Q=function(){if(D.haveItemsQueued()&&!rt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");e.prototype._captureStackTrace=t,e.prototype._attachExtraTrace=r,n.deactivateLongStackTraces(),D.enableTrampoline(),rt.longStackTraces=!1},e.prototype._captureStackTrace=f,e.prototype._attachExtraTrace=d,n.activateLongStackTraces(),D.disableTrampolineIfNecessary()}},e.hasLongStackTraces=function(){return rt.longStackTraces&&T()};var $=function(){try{var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),M.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!M.global.dispatchEvent(n)}}catch(t){}return function(){return!1}}(),K=function(){return M.isNode?function(){return process.emit.apply(process,arguments)}:M.global?function(t){var e="on"+t.toLowerCase(),n=M.global[e];return!!n&&(n.apply(M.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),J={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:r},Y=function(t){var e=!1;try{e=K.apply(null,arguments)}catch(t){D.throwLater(t),e=!0}var n=!1;try{n=$(t,J[t].apply(null,arguments))}catch(t){D.throwLater(t),n=!0}return n||e};e.config=function(t){if(t=Object(t),"longStackTraces"in t&&(t.longStackTraces?e.longStackTraces():!t.longStackTraces&&e.hasLongStackTraces()&&Q()),"warnings"in t){var n=t.warnings;rt.warnings=!!n,z=rt.warnings,M.isObject(n)&&"wForgottenReturn"in n&&(z=!!n.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!rt.cancellation){if(D.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");e.prototype._clearCancellationData=c,e.prototype._propagateFrom=u,e.prototype._onCancel=a,e.prototype._setOnCancel=l,e.prototype._attachCancellationCallback=s,e.prototype._execute=o,Z=u,rt.cancellation=!0}"monitoring"in t&&(t.monitoring&&!rt.monitoring?(rt.monitoring=!0,e.prototype._fireEvent=Y):!t.monitoring&&rt.monitoring&&(rt.monitoring=!1,e.prototype._fireEvent=i))},e.prototype._fireEvent=i,e.prototype._execute=function(t,e,n){try{t(e,n)}catch(t){return t}},e.prototype._onCancel=function(){},e.prototype._setOnCancel=function(t){},e.prototype._attachCancellationCallback=function(t){},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._clearCancellationData=function(){},e.prototype._propagateFrom=function(t,e){};var Z=h,tt=function(){return!1},et=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;M.inherits(R,Error),n.CapturedTrace=R,R.prototype.uncycle=function(){var t=this._length;if(!(2>t)){for(var e=[],n={},r=0,i=this;void 0!==i;++r)e.push(i),i=i._parent;t=this._length=r;for(var r=t-1;r>=0;--r){var o=e[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;t>r;++r){var s=e[r].stack,a=n[s];if(void 0!==a&&a!==r){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var l=r>0?e[r-1]:this;t-1>a?(l._parent=e[a+1],l._parent.uncycle(),l._length=l._parent._length+1):(l._parent=void 0,l._length=1);for(var c=l._length+1,u=r-2;u>=0;--u)e[u]._length=c,c++;return}}}},R.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=k(t),n=e.message,r=[e.stack],i=this;void 0!==i;)r.push(w(i.stack.split("\n"))),i=i._parent;b(r),m(r),M.notEnumerableProp(t,"stack",g(n,r)),M.notEnumerableProp(t,"__stackCleaned__",!0)}};var nt=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():S(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,V=t,G=e;var n=Error.captureStackTrace;return tt=function(t){return N.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return V=/@/,G=e,H=!0,function(t){t.stack=(new Error).stack};var i;try{throw new Error}catch(t){i="stack"in t}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(G=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?S(e):e.toString()},null):(V=t,G=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(I=function(t){console.warn(t)},M.isNode&&process.stderr.isTTY?I=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:M.isNode||"string"!=typeof(new Error).stack||(I=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var rt={warnings:q,longStackTraces:!1,cancellation:!1,monitoring:!1};return W&&e.longStackTraces(),{longStackTraces:function(){return rt.longStackTraces},warnings:function(){return rt.warnings},cancellation:function(){return rt.cancellation},monitoring:function(){return rt.monitoring},propagateFromFunction:function(){return Z},boundValueFunction:function(){return p},checkForgottenReturns:_,setBounds:j,warn:y,deprecated:v,CapturedTrace:R,fireDomEvent:$,fireGlobalEvent:K}}},{"./errors":12,"./util":36}],10:[function(t,e,n){e.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1],r=function(){throw e};return this.caught(t,r)},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var r=arguments[1];r instanceof t&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(t,e,n){e.exports=function(t,e){function n(){return o(this)}function r(t,n){return i(t,n,e,e)}var i=t.reduce,o=t.all;t.prototype.each=function(t){return this.mapSeries(t)._then(n,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return i(this,t,e,e)},t.each=function(t,e){return r(t,e)._then(n,void 0,void 0,t,void 0)},t.mapSeries=r}},{}],12:[function(t,e,n){function r(t,e){function n(r){return this instanceof n?(h(this,"message","string"==typeof r?r:e),h(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new n(r)}return u(n,Error),n}function i(t){return this instanceof i?(h(this,"name","OperationalError"),h(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(h(this,"message",t.message),h(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new i(t)}var o,s,a=t("./es5"),l=a.freeze,c=t("./util"),u=c.inherits,h=c.notEnumerableProp,p=r("Warning","warning"),f=r("CancellationError","cancellation error"),d=r("TimeoutError","timeout error"),_=r("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(t){o=r("TypeError","type error"),s=r("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<v.length;++y)"function"==typeof Array.prototype[v[y]]&&(_.prototype[v[y]]=Array.prototype[v[y]]);a.defineProperty(_.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),_.prototype.isOperational=!0;var g=0;_.prototype.toString=function(){var t=Array(4*g+1).join(" "),e="\n"+t+"AggregateError of:\n";g++,t=Array(4*g+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];r=i.join("\n"),e+=r+"\n"}return g--,e},u(i,Error);var m=Error.__BluebirdErrorTypes__;m||(m=l({CancellationError:f,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:_}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:m,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:m.CancellationError,OperationalError:m.OperationalError,TimeoutError:m.TimeoutError,AggregateError:m.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(t,e,n){var r=function(){return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e},l=function(t,e){return{value:t[e]}},c=function(t,e,n){return t[e]=n.value,t},u=function(t){return t},h=function(t){try{return Object(t).constructor.prototype}catch(t){return s}},p=function(t){try{return"[object Array]"===o.call(t)}catch(t){return!1}};e.exports={isArray:p,keys:a,names:a,defineProperty:c,getDescriptor:l,freeze:u,getPrototypeOf:h,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,n){e.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,i){return n(t,r,i,e)}}},{}],15:[function(t,e,n){e.exports=function(e,n){function r(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function i(t){this.finallyHandler=t}function o(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function s(){return l.call(this,this.promise._target()._settledValue())}function a(t){return o(this,t)?void 0:(h.e=t,h)}function l(t){var r=this.promise,l=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?l.call(r._boundValue()):l.call(r._boundValue(),t);if(void 0!==c){r._setReturnedNonUndefined();var p=n(c,r);if(p instanceof e){if(null!=this.cancelPromise){if(p.isCancelled()){var f=new u("late cancellation observer");return r._attachExtraTrace(f),h.e=f,h}p.isPending()&&p._attachCancellationCallback(new i(this))}return p._then(s,a,void 0,this,void 0)}}}return r.isRejected()?(o(this),h.e=t,h):(o(this),t)}var c=t("./util"),u=e.CancellationError,h=c.errorObj;return r.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},e.prototype._passThrough=function(t,e,n,i){return"function"!=typeof t?this.then():this._then(n,i,void 0,new r(this,e,t),void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThrough(t,0,l,l)},e.prototype.tap=function(t){return this._passThrough(t,1,l)},r}},{"./util":36}],16:[function(t,e,n){e.exports=function(e,n,r,i,o,s){function a(t,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=f(n[o])(t);if(r._popContext(),s===p){r._pushContext();var a=e.reject(p.e);return r._popContext(),a}var l=i(s,r);if(l instanceof e)return l}return null}function l(t,n,i,o){if(s.cancellation()){var a=new e(r),l=this._finallyPromise=new e(r);this._promise=a.lastly(function(){return l}),a._captureStackTrace(),a._setOnCancel(this)}else{(this._promise=new e(r))._captureStackTrace()}this._stack=o,this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(d):d,this._yieldedPromise=null,this._cancellationPhase=!1}var c=t("./errors"),u=c.TypeError,h=t("./util"),p=h.errorObj,f=h.tryCatch,d=[];h.inherits(l,o),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var t;if(void 0!==this._generator.return)this._promise._pushContext(),t=f(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),t=f(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},l.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=f(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},l.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=f(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(t){var n=this._promise;if(t===p)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(t.e,!1);var r=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(!(o instanceof e)&&null===(o=a(o,this._yieldHandlers,this._promise)))return void this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",r)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var s=o._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?this._promiseFulfilled(o._value()):0!=(16777216&s)?this._promiseRejected(o._reason()):this._promiseCancelled()},e.coroutine=function(t,e){if("function"!=typeof t)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n")
;var n=Object(e).yieldHandler,r=l,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=e,o._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new u("expecting a function but got "+h.classString(t));d.push(t)},e.spawn=function(t){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new l(t,this),i=r.promise();return r._run(e.spawn),i}}},{"./errors":12,"./util":36}],17:[function(t,e,n){e.exports=function(e,n,r,i){var o=t("./util");o.canEvaluate,o.tryCatch,o.errorObj,e.join=function(){var t,e=arguments.length-1;if(e>0&&"function"==typeof arguments[e]){t=arguments[e];var r}var i=[].slice.call(arguments);t&&i.pop();var r=new n(i).promise();return void 0!==t?r.spread(t):r}}},{"./util":36}],18:[function(t,e,n){e.exports=function(e,n,r,i,o,s){function a(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var i=c();this._callback=null===i?e:i.bind(e),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:f,this._init$(void 0,-2)}function l(t,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+u.classString(n));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return e.reject(new TypeError("options argument must be an object but it is "+u.classString(i)));if("number"!=typeof i.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+u.classString(i.concurrency)));s=i.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(t,n,s,o).promise()}var c=e._getDomain,u=t("./util"),h=u.tryCatch,p=u.errorObj,f=[];u.inherits(a,n),a.prototype._init=function(){},a.prototype._promiseFulfilled=function(t,n){var r=this._values,o=this.length(),a=this._preservedValues,l=this._limit;if(0>n){if(n=-1*n-1,r[n]=t,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return r[n]=t,this._queue.push(n),!1;null!==a&&(a[n]=t);var c=this._promise,u=this._callback,f=c._boundValue();c._pushContext();var d=h(u).call(f,t,n,o),_=c._popContext();if(s.checkForgottenReturns(d,_,null!==a?"Promise.filter":"Promise.map",c),d===p)return this._reject(d.e),!0;var v=i(d,this._promise);if(v instanceof e){v=v._target();var y=v._bitField;if(0==(50397184&y))return l>=1&&this._inFlight++,r[n]=v,v._proxy(this,-1*(n+1)),!1;if(0==(33554432&y))return 0!=(16777216&y)?(this._reject(v._reason()),!0):(this._cancel(),!0);d=v._value()}r[n]=d}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},a.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),i=0,o=0;n>o;++o)t[o]&&(r[i++]=e[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return l(this,t,e,null)},e.map=function(t,e,n,r){return l(t,e,n,r)}}},{"./util":36}],19:[function(t,e,n){e.exports=function(e,n,r,i,o){var s=t("./util"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var r=new e(n);r._captureStackTrace(),r._pushContext();var i=a(t).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},e.attempt=e.try=function(t){if("function"!=typeof t)return i("expecting a function but got "+s.classString(t));var r=new e(n);r._captureStackTrace(),r._pushContext();var l;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],u=arguments[2];l=s.isArray(c)?a(t).apply(u,c):a(t).call(u,c)}else l=a(t)();var h=r._popContext();return o.checkForgottenReturns(l,h,"Promise.try",r),r._resolveFromSyncValue(l),r},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,n){function r(t){return t instanceof Error&&u.getPrototypeOf(t)===Error.prototype}function i(t){var e;if(r(t)){e=new c(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var n=u.keys(t),i=0;i<n.length;++i){var o=n[i];h.test(o)||(e[o]=t[o])}return e}return s.markAsOriginatingFromRejection(t),t}function o(t,e){return function(n,r){if(null!==t){if(n){var o=i(a(n));t._attachExtraTrace(o),t._reject(o)}else if(e){var s=[].slice.call(arguments,1);t._fulfill(s)}else t._fulfill(r);t=null}}}var s=t("./util"),a=s.maybeWrapAsError,l=t("./errors"),c=l.OperationalError,u=t("./es5"),h=/^(?:name|message|stack|cause)$/;e.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){e.exports=function(e){function n(t,e){var n=this;if(!o.isArray(t))return r.call(n,t,e);var i=a(e).apply(n._boundValue(),[null].concat(t));i===l&&s.throwLater(i.e)}function r(t,e){var n=this,r=n._boundValue(),i=void 0===t?a(e).call(r,null):a(e).call(r,null,t);i===l&&s.throwLater(i.e)}function i(t,e){var n=this;if(!t){var r=new Error(t+"");r.cause=t,t=r}var i=a(e).call(n._boundValue(),t);i===l&&s.throwLater(i.e)}var o=t("./util"),s=e._async,a=o.tryCatch,l=o.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var o=r;void 0!==e&&Object(e).spread&&(o=n),this._then(o,i,void 0,this,t)}return this}}},{"./util":36}],22:[function(t,e,n){e.exports=function(){function n(){}function r(t,e){if("function"!=typeof e)throw new g("expecting a function but got "+f.classString(e));if(t.constructor!==i)throw new g("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function i(t){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,t!==b&&(r(this,t),this._resolveFromExecutor(t)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(t){this.promise._resolveCallback(t)}function s(t){this.promise._rejectCallback(t,!1)}function a(t){var e=new i(b);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var l,c=function(){return new g("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},u=function(){return new i.PromiseInspection(this._target())},h=function(t){return i.reject(new g(t))},p={},f=t("./util");l=f.isNode?function(){var t=process.domain;return void 0===t&&(t=null),t}:function(){return null},f.notEnumerableProp(i,"_getDomain",l);var d=t("./es5"),_=t("./async"),v=new _;d.defineProperty(i,"_async",{value:v});var y=t("./errors"),g=i.TypeError=y.TypeError;i.RangeError=y.RangeError;var m=i.CancellationError=y.CancellationError;i.TimeoutError=y.TimeoutError,i.OperationalError=y.OperationalError,i.RejectionError=y.OperationalError,i.AggregateError=y.AggregateError;var b=function(){},w={},E={},k=t("./thenables")(i,b),C=t("./promise_array")(i,b,k,h,n),A=t("./context")(i),S=A.create,O=t("./debuggability")(i,A),T=(O.CapturedTrace,t("./finally")(i,k)),P=t("./catch_filter")(E),j=t("./nodeback"),R=f.errorObj,x=f.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(t){var e=arguments.length;if(e>1){var n,r=new Array(e-1),i=0;for(n=0;e-1>n;++n){var o=arguments[n];if(!f.isObject(o))return h("expecting an object but got "+f.classString(o));r[i++]=o}return r.length=i,t=arguments[n],this.then(void 0,P(r,t,this))}return this.then(void 0,t)},i.prototype.reflect=function(){return this._then(u,u,void 0,this,void 0)},i.prototype.then=function(t,e){if(O.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+f.classString(t);arguments.length>1&&(n+=", "+f.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},i.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},i.prototype.spread=function(t){return"function"!=typeof t?h("expecting a function but got "+f.classString(t)):this.all()._then(t,void 0,void 0,w,void 0)},i.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},i.prototype.error=function(t){return this.caught(f.originatesFromRejection,t)},i.getNewLibraryCopy=e.exports,i.is=function(t){return t instanceof i},i.fromNode=i.fromCallback=function(t){var e=new i(b);e._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=x(t)(j(e,n));return r===R&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},i.all=function(t){return new C(t).promise()},i.cast=function(t){var e=k(t);return e instanceof i||(e=new i(b),e._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(t){var e=new i(b);return e._captureStackTrace(),e._rejectCallback(t,!0),e},i.setScheduler=function(t){if("function"!=typeof t)throw new g("expecting a function but got "+f.classString(t));return v.setScheduler(t)},i.prototype._then=function(t,e,n,r,o){var s=void 0!==o,a=s?o:new i(b),c=this._target(),u=c._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&u)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var h=l();if(0!=(50397184&u)){var p,f,d=c._settlePromiseCtx;0!=(33554432&u)?(f=c._rejectionHandler0,p=t):0!=(16777216&u)?(f=c._fulfillmentHandler0,p=e,c._unsetRejectionIsUnhandled()):(d=c._settlePromiseLateCancellationObserver,f=new m("late cancellation observer"),c._attachExtraTrace(f),p=e),v.invoke(d,c,{handler:null===h?p:"function"==typeof p&&h.bind(p),promise:a,receiver:r,value:f})}else c._addCallbacks(t,e,a,r,h);return a},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},i.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setAsyncGuaranteed=function(){v.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];return e===p?void 0:void 0===e&&this._isBound()?this._boundValue():e},i.prototype._promiseAt=function(t){return this[4*t-4+2]},i.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},i.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),n=t._rejectionHandler0,r=t._promise0,i=t._receiverAt(0);void 0===i&&(i=p),this._addCallbacks(e,n,r,i,null)},i.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=p),this._addCallbacks(n,r,i,o,null)},i.prototype._addCallbacks=function(t,e,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=null===i?t:i.bind(t)),"function"==typeof e&&(this._rejectionHandler0=null===i?e:i.bind(e));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof t&&(this[s+0]=null===i?t:i.bind(t)),"function"==typeof e&&(this[s+1]=null===i?e:i.bind(e))}return this._setLength(o+1),o},i.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},i.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(c(),!1);var n=k(t,this);if(!(n instanceof i))return this._fulfill(t);e&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(c());var o=r._bitField;if(0==(50397184&o)){var s=this._length();s>0&&r._migrateCallback0(this);for(var a=1;s>a;++a)r._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&o))this._fulfill(r._value());else if(0!=(16777216&o))this._reject(r._reason());else{var l=new m("late cancellation observer");r._attachExtraTrace(l),this._reject(l)}}},i.prototype._rejectCallback=function(t,e,n){var r=f.ensureErrorObject(t),i=r===t;if(!i&&!n&&O.warnings()){var o="a promise was rejected with a non-error: "+f.classString(t);this._warn(o,!0)}this._attachExtraTrace(r,!!e&&i),this._reject(t)},i.prototype._resolveFromExecutor=function(t){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,n)});n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)},i.prototype._settlePromiseFromHandler=function(t,e,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;e===w?n&&"number"==typeof n.length?o=x(t).apply(this._boundValue(),n):(o=R,o.e=new g("cannot .spread() a non-array: "+f.classString(n))):o=x(t).call(e,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===E?r._reject(n):o===R?r._rejectCallback(o.e,!1):(O.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},i.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(t){this._rejectionHandler0=t},i.prototype._settlePromise=function(t,e,r,o){var s=t instanceof i,a=this._bitField,l=0!=(134217728&a);0!=(65536&a)?(s&&t._invokeInternalOnCancel(),r instanceof T&&r.isFinallyHandler()?(r.cancelPromise=t,x(e).call(r,o)===R&&t._reject(R.e)):e===u?t._fulfill(u.call(r)):r instanceof n?r._promiseCancelled(t):s||t instanceof C?t._cancel():r.cancel()):"function"==typeof e?s?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,r,o,t)):e.call(r,o,t):r instanceof n?r._isResolved()||(0!=(33554432&a)?r._promiseFulfilled(o,t):r._promiseRejected(o,t)):s&&(l&&t._setAsyncGuaranteed(),0!=(33554432&a)?t._fulfill(o):t._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,o=t.value;"function"==typeof e?n instanceof i?this._settlePromiseFromHandler(e,r,o,n):e.call(r,o,n):n instanceof i&&n._reject(o)},i.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},i.prototype._settlePromise0=function(t,e,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,i,e)},i.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},i.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var n=c();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():v.settlePromises(this))}},i.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?v.fatalError(t,f.isNode):void((65535&e)>0?v.settlePromises(this):this._ensurePossibleRejectionHandled())},i.prototype._fulfillPromises=function(t,e){for(var n=1;t>n;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},i.prototype._rejectPromises=function(t,e){for(var n=1;t>n;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},i.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){return O.deprecated("Promise.defer","new Promise"),{promise:new i(b),resolve:o,reject:s}},f.notEnumerableProp(i,"_makeSelfResolutionError",c),t("./method")(i,b,k,h,O),t("./bind")(i,b,k,O),t("./cancel")(i,C,h,O),t("./direct_resolve")(i),t("./synchronous_inspection")(i),t("./join")(i,C,k,b,O),i.Promise=i,i.version="3.4.0",t("./map.js")(i,C,h,k,b,O),t("./call_get.js")(i),t("./using.js")(i,h,k,S,b,O),t("./timers.js")(i,b,O),t("./generators.js")(i,h,b,k,n,O),t("./nodeify.js")(i),t("./promisify.js")(i,b),t("./props.js")(i,C,k,h),t("./race.js")(i,b,k,h),t("./reduce.js")(i,C,h,k,b,O),t("./settle.js")(i,C,O),t("./some.js")(i,C,h),t("./filter.js")(i,b),t("./each.js")(i,b),t("./any.js")(i),f.toFastProperties(i),f.toFastProperties(i.prototype),a({a:1}),a({b:2}),a({c:3}),a(1),a(function(){}),a(void 0),a(!1),a(new i(b)),O.setBounds(_.firstLineError,f.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(t,e,n){e.exports=function(e,n,r,i,o){function s(t){switch(t){case-2:return[];case-3:return{}}}function a(t){var r=this._promise=new e(n);t instanceof e&&r._propagateFrom(t,3),r._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=t("./util");return l.isArray,l.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function t(n,o){var a=r(this._values,this._promise);if(a instanceof e){a=a._target();var c=a._bitField;if(this._values=a,0==(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(t,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(null===(a=l.asArray(a))){var u=i("expecting an array or an iterable object but got "+l.classString(a)).reason();return void this._promise._rejectCallback(u,!1)}return 0===a.length?void(-5===o?this._resolveEmptyArray():this._resolve(s(o))):void this._iterate(a)},a.prototype._iterate=function(t){var n=this.getActualLength(t.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;n>a;++a){var l=r(t[a],i);l instanceof e?(l=l._target(),s=l._bitField):s=null,o?null!==s&&l.suppressUnhandledRejections():null!==s?0==(50397184&s)?(l._proxy(this,a),this._values[a]=l):o=0!=(33554432&s)?this._promiseFulfilled(l._value(),a):0!=(16777216&s)?this._promiseRejected(l._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(l,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},{"./util":36}],24:[function(t,e,n){e.exports=function(e,n){function r(t){return!b.test(t)}function i(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function o(t,e,n){var r=p.getDataPropertyOrDefault(t,e+n,g);return!!r&&i(r)}function s(t,e,n){for(var r=0;r<t.length;r+=2){var i=t[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}function a(t,e,n,r){for(var a=p.inheritedDataKeys(t),l=[],c=0;c<a.length;++c){var u=a[c],h=t[u],f=r===w||w(u,h,t);"function"!=typeof h||i(h)||o(t,u,e)||!r(u,h,t,f)||l.push(u,h)}return s(l,e,n),l}function l(t,r,i,o,s,a){function l(){var i=r;r===h&&(i=this);var o=new e(n);o._captureStackTrace();var s="string"==typeof u&&this!==c?this[u]:t,l=f(o,a);try{s.apply(i,d(arguments,l))}catch(t){o._rejectCallback(_(t),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),u=t;return"string"==typeof u&&(t=o),p.notEnumerableProp(l,"__isPromisified__",!0),l}function c(t,e,n,r,i){for(var o=new RegExp(E(e)+"$"),s=a(t,e,o,n),l=0,c=s.length;c>l;l+=2){var u=s[l],f=s[l+1],d=u+e;if(r===k)t[d]=k(u,h,u,f,e,i);else{var _=r(f,function(){return k(u,h,u,f,e,i)});p.notEnumerableProp(_,"__isPromisified__",!0),t[d]=_}}return p.toFastProperties(t),t}function u(t,e,n){return k(t,e,void 0,t,null,n)}var h={},p=t("./util"),f=t("./nodeback"),d=p.withAppended,_=p.maybeWrapAsError,v=p.canEvaluate,y=t("./errors").TypeError,g={__isPromisified__:!0},m=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],b=new RegExp("^(?:"+m.join("|")+")$"),w=function(t){return p.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},E=function(t){return t.replace(/([$])/,"\\$")},k=v?void 0:l;e.promisify=function(t,e){if("function"!=typeof t)throw new y("expecting a function but got "+p.classString(t));if(i(t))return t;e=Object(e);var n=void 0===e.context?h:e.context,o=!!e.multiArgs,s=u(t,n,o);return p.copyDescriptors(t,s,r),s},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");e=Object(e);var n=!!e.multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var i=e.filter;"function"!=typeof i&&(i=w);var o=e.promisifier;if("function"!=typeof o&&(o=k),!p.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=p.inheritedDataKeys(t),a=0;a<s.length;++a){var l=t[s[a]];"constructor"!==s[a]&&p.isClass(l)&&(c(l.prototype,r,i,o,n),c(l,r,i,o,n))}return c(t,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,n){e.exports=function(e,n,r,i){function o(t){var e,n=!1;if(void 0!==a&&t instanceof a)e=h(t),n=!0;else{var r=u.keys(t),i=r.length;e=new Array(2*i);for(var o=0;i>o;++o){var s=r[o];e[o]=t[s],e[o+i]=s}}this.constructor$(e),this._isMap=n,this._init$(void 0,-3)}function s(t){var n,s=r(t);return c(s)?(n=s instanceof e?s._then(e.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof e&&n._propagateFrom(s,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,l=t("./util"),c=l.isObject,u=t("./es5");"function"==typeof Map&&(a=Map);var h=function(){function t(t,r){this[e]=t,this[e+n]=r,e++}var e=0,n=0;return function(r){n=r.size,e=0;var i=new Array(2*r.size);return r.forEach(t,i),i}}(),p=function(t){for(var e=new a,n=t.length/2|0,r=0;n>r;++r){var i=t[n+r],o=t[r];e.set(i,o)}return e};l.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var n;if(this._isMap)n=p(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();o>i;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return s(this)},e.props=function(t){return s(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,n){function r(t,e,n,r,i){for(var o=0;i>o;++o)n[o+r]=t[o+e],t[o+e]=void 0}function i(t){this._capacity=t,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},i.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);var n=this._front,r=(n-1&e-1^e)-e;this[r]=t,this._front=r,this._length=this.length()+1},i.prototype.unshift=function(t,e,n){this._unshiftOne(n),this._unshiftOne(e),this._unshiftOne(t)},i.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,r(this,0,this,e,this._front+this._length&e-1)},e.exports=i},{}],27:[function(t,e,n){e.exports=function(e,n,r,i){function o(t,o){var l=r(t);if(l instanceof e)return a(l);if(null===(t=s.asArray(t)))return i("expecting an array or an iterable object but got "+s.classString(t));var c=new e(n);void 0!==o&&c._propagateFrom(o,3);for(var u=c._fulfill,h=c._reject,p=0,f=t.length;f>p;++p){var d=t[p];(void 0!==d||p in t)&&e.cast(d)._then(u,h,void 0,c,null)}return c}var s=t("./util"),a=function(t){return t.then(function(e){return o(e,t)})};e.race=function(t){return o(t,void 0)},e.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(t,e,n){e.exports=function(e,n,r,i,o,s){function a(t,n,r,i){this.constructor$(t);var s=p();this._fn=null===s?n:s.bind(n),void 0!==r&&(r=e.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function c(t,e,n,i){return"function"!=typeof e?r("expecting a function but got "+f.classString(e)):new a(t,e,n,i).promise()}function u(t){this.accum=t,this.array._gotAccum(t);var n=i(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(h,void 0,void 0,this,void 0)):h.call(this,n)}function h(t){var n=this.array,r=n._promise,i=d(n._fn);r._pushContext();var o;(o=void 0!==n._eachValues?i.call(r._boundValue(),t,this.index,this.length):i.call(r._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(n._currentCancellable=o);var a=r._popContext();return s.checkForgottenReturns(o,a,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var p=e._getDomain,f=t("./util"),d=f.tryCatch;f.inherits(a,n),a.prototype._gotAccum=function(t){void 0!==this._eachValues&&t!==o&&this._eachValues.push(t)},a.prototype._eachComplete=function(t){return this._eachValues.push(t),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},a.prototype._resultCancelled=function(t){return t===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel()))},a.prototype._iterate=function(t){this._values=t;var n,r,i=t.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=e.resolve(t[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;i>r;++r){var o={accum:null,value:t[r],index:r,length:i,array:this};n=n._then(u,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(l,l,void 0,n,this)},e.prototype.reduce=function(t,e){return c(this,t,e,null)},e.reduce=function(t,e,n,r){return c(t,e,n,r)}}},{"./util":36}],29:[function(t,e,n){var r,i=t("./util"),o=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},s=i.getNativePromise();if(i.isNode&&"undefined"==typeof MutationObserver){var a=global.setImmediate,l=process.nextTick;r=i.isRecentNode?function(t){a.call(global,t)}:function(t){l.call(process,t)}}else if("function"==typeof s){var c=s.resolve();r=function(t){c.then(t)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:o:function(){var t=document.createElement("div"),e={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){t.classList.toggle("foo"),n=!1}).observe(r,e);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(t,e),i()}}();e.exports=r},{"./util":36}],30:[function(t,e,n){e.exports=function(e,n,r){function i(t){this.constructor$(t)}var o=e.PromiseInspection;t("./util").inherits(i,n),i.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(t,e){var n=new o;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},i.prototype._promiseRejected=function(t,e){var n=new o;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},e.settle=function(t){return r.deprecated(".settle()",".reflect()"),new i(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,n){e.exports=function(e,n,r){function i(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||0>e)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(t),o=n.promise();return n.setHowMany(e),n.init(),o}var s=t("./util"),a=t("./errors").RangeError,l=t("./errors").AggregateError,c=s.isArray,u={};s.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=c(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){
this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(t){this._howMany=t},i.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new l,e=this.length();e<this._values.length;++e)this._values[e]!==u&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(t){this._values.push(t)},i.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return o(t,e)},e.prototype.some=function(t){return o(this,t)},e._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(t,e,n){e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=t.prototype._isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype.isCancelled=function(){return this._target()._isCancelled()},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,n){e.exports=function(e,n){function r(t,r){if(u(t)){if(t instanceof e)return t;var i=o(t);if(i===c){r&&r._pushContext();var l=e.reject(i.e);return r&&r._popContext(),l}if("function"==typeof i){if(s(t)){var l=new e(n);return t._then(l._fulfill,l._reject,void 0,l,null),l}return a(t,i,r)}}return t}function i(t){return t.then}function o(t){try{return i(t)}catch(t){return c.e=t,c}}function s(t){try{return h.call(t,"_promise0")}catch(t){return!1}}function a(t,r,i){function o(t){a&&(a._resolveCallback(t),a=null)}function s(t){a&&(a._rejectCallback(t,h,!0),a=null)}var a=new e(n),u=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var h=!0,p=l.tryCatch(r).call(t,o,s);return h=!1,a&&p===c&&(a._rejectCallback(p.e,!0,!0),a=null),u}var l=t("./util"),c=l.errorObj,u=l.isObject,h={}.hasOwnProperty;return r}},{"./util":36}],34:[function(t,e,n){e.exports=function(e,n,r){function i(t){this.handle=t}function o(t){return clearTimeout(this.handle),t}function s(t){throw clearTimeout(this.handle),t}var a=t("./util"),l=e.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(t){return u(+this).thenReturn(t)},u=e.delay=function(t,o){var s,a;return void 0!==o?(s=e.resolve(o)._then(c,null,null,t,void 0),r.cancellation()&&o instanceof e&&s._setOnCancel(o)):(s=new e(n),a=setTimeout(function(){s._fulfill()},+t),r.cancellation()&&s._setOnCancel(new i(a))),s._setAsyncGuaranteed(),s};e.prototype.delay=function(t){return u(t,this)};var h=function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new l("operation timed out"):new l(e),a.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()};e.prototype.timeout=function(t,e){t=+t;var n,a,l=new i(setTimeout(function(){n.isPending()&&h(n,e,a)},t));return r.cancellation()?(a=this.then(),n=a._then(o,s,void 0,l,void 0),n._setOnCancel(l)):n=this._then(o,s,void 0,l,void 0),n}}},{"./util":36}],35:[function(t,e,n){e.exports=function(e,n,r,i,o,s){function a(t){setTimeout(function(){throw t},0)}function l(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function c(t,n){function i(){if(s>=c)return u._fulfill();var o=l(t[s++]);if(o instanceof e&&o._isDisposable()){try{o=r(o._getDisposer().tryDispose(n),t.promise)}catch(t){return a(t)}if(o instanceof e)return o._then(i,a,null,null,null)}i()}var s=0,c=t.length,u=new e(o);return i(),u}function u(t,e,n){this._data=t,this._promise=e,this._context=n}function h(t,e,n){this.constructor$(t,e,n)}function p(t){return u.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function f(t){this.length=t,this.promise=null,this[t-1]=null}var d=t("./util"),_=t("./errors").TypeError,v=t("./util").inherits,y=d.errorObj,g=d.tryCatch,m={};u.prototype.data=function(){return this._data},u.prototype.promise=function(){return this._promise},u.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():m},u.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=e!==m?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},u.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},v(h,u),h.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},f.prototype._resultCancelled=function(){for(var t=this.length,n=0;t>n;++n){var r=this[n];r instanceof e&&r.cancel()}},e.using=function(){var t=arguments.length;if(2>t)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[t-1];if("function"!=typeof i)return n("expecting a function but got "+d.classString(i));var o,a=!0;2===t&&Array.isArray(arguments[0])?(o=arguments[0],t=o.length,a=!1):(o=arguments,t--);for(var l=new f(t),h=0;t>h;++h){var _=o[h];if(u.isDisposer(_)){var v=_;_=_.promise(),_._setDisposable(v)}else{var m=r(_);m instanceof e&&(_=m._then(p,null,null,{resources:l,index:h},void 0))}l[h]=_}for(var b=new Array(l.length),h=0;h<b.length;++h)b[h]=e.resolve(l[h]).reflect();var w=e.all(b).then(function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return y.e=n.error(),y;if(!n.isFulfilled())return void w.cancel();t[e]=n.value()}E._pushContext(),i=g(i);var r=a?i.apply(void 0,t):i(t),o=E._popContext();return s.checkForgottenReturns(r,o,"Promise.using",E),r}),E=w.lastly(function(){var t=new e.PromiseInspection(w);return c(l,t)});return l.promise=E,E._setOnCancel(l),E},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new h(t,this,i());throw new _}}},{"./errors":12,"./util":36}],36:[function(t,e,n){function r(){try{var t=A;return A=null,t.apply(this,arguments)}catch(t){return T.e=t,T}}function i(t){return A=t,r}function o(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function s(t){return"function"==typeof t||"object"==typeof t&&null!==t}function a(t){return o(t)?new Error(v(t)):t}function l(t,e){var n,r=t.length,i=new Array(r+1);for(n=0;r>n;++n)i[n]=t[n];return i[n]=e,i}function c(t,e,n){if(!S.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function u(t,e,n){if(o(t))return t;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return S.defineProperty(t,e,r),t}function h(t){throw t}function p(t){try{if("function"==typeof t){var e=S.names(t.prototype),n=S.isES5&&e.length>1,r=e.length>0&&!(1===e.length&&"constructor"===e[0]),i=x.test(t+"")&&S.names(t).length>0;if(n||r||i)return!0}return!1}catch(t){return!1}}function f(t){function e(){}e.prototype=t;for(var n=8;n--;)new e;return t}function d(t){return F.test(t)}function _(t,e,n){for(var r=new Array(t),i=0;t>i;++i)r[i]=e+i+n;return r}function v(t){try{return t+""}catch(t){return"[no string representation]"}}function y(t){return null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function g(t){try{u(t,"isOperational",!0)}catch(t){}}function m(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function b(t){return y(t)&&S.propertyIsWritable(t,"stack")}function w(t){return{}.toString.call(t)}function E(t,e,n){for(var r=S.names(t),i=0;i<r.length;++i){var o=r[i];if(n(o))try{S.defineProperty(e,o,S.getDescriptor(t,o))}catch(t){}}}function k(t,e){return L?process.env[t]:e}function C(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}var A,S=t("./es5"),O="undefined"==typeof navigator,T={e:{}},P="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,j=function(t,e){function n(){this.constructor=t,this.constructor$=e;for(var n in e.prototype)r.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}var r={}.hasOwnProperty;return n.prototype=e.prototype,t.prototype=new n,t.prototype},R=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(S.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var r=[],i=Object.create(null);null!=t&&!e(t);){var o;try{o=n(t)}catch(t){return r}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var l=Object.getOwnPropertyDescriptor(t,a);null!=l&&null==l.get&&null==l.set&&r.push(a)}}t=S.getPrototypeOf(t)}return r}}var r={}.hasOwnProperty;return function(n){if(e(n))return[];var i=[];t:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<t.length;++s)if(r.call(t[s],o))continue t;i.push(o)}return i}}(),x=/this\s*\.\s*\S+\s*=/,F=/^[a-z$_][a-z$_0-9]*$/i,I=function(){return"stack"in new Error?function(t){return b(t)?t:new Error(v(t))}:function(t){if(b(t))return t;try{throw new Error(v(t))}catch(t){return t}}}(),U=function(t){return S.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var D="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};U=function(t){return S.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?D(t):null}}var L="undefined"!=typeof process&&"[object process]"===w(process).toLowerCase(),M={isClass:p,isIdentifier:d,inheritedDataKeys:R,getDataPropertyOrDefault:c,thrower:h,isArray:S.isArray,asArray:U,notEnumerableProp:u,isPrimitive:o,isObject:s,isError:y,canEvaluate:O,errorObj:T,tryCatch:i,inherits:j,withAppended:l,maybeWrapAsError:a,toFastProperties:f,filledRange:_,toString:v,canAttachTrace:b,ensureErrorObject:I,originatesFromRejection:m,markAsOriginatingFromRejection:g,classString:w,copyDescriptors:E,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:L,env:k,global:P,getNativePromise:C};M.isRecentNode=M.isNode&&function(){var t=process.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),M.isNode&&M.toFastProperties(process);try{throw new Error}catch(t){M.lastLineError=t}e.exports=M},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise),Array.from||(Array.from=function(){var t=Object.prototype.toString,e=function(e){return"function"==typeof e||"[object Function]"===t.call(e)},n=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e},r=Math.pow(2,53)-1,i=function(t){var e=n(t);return Math.min(Math.max(e,0),r)};return function(t){var n=this,r=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!e(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}for(var a,l=i(r.length),c=e(n)?Object(new n(l)):new Array(l),u=0;u<l;)a=r[u],c[u]=s?void 0===o?s(a,u):s.call(o,a,u):a,u+=1;return c.length=l,c}}()),"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var n=arguments[e];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}),String.prototype.contains=String.prototype.contains||function(t){return this.indexOf(t)>=0},String.prototype.includes||(String.prototype.includes=function(t,e){return"number"!=typeof e&&(e=0),!(e+t.length>this.length)&&-1!==this.indexOf(t,e)}),String.prototype.startsWith=String.prototype.startsWith||function(t){return 0===this.indexOf(t)},String.prototype.endsWith=String.prototype.endsWith||function(t){return this.indexOf(t,this.length-t.length)>=0},Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,i=arguments[1],o=0;o<r;o++)if(e=n[o],t.call(i,e,o,n))return e}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.some||(Array.prototype.some=function(t){if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof t)throw new TypeError;for(var e=Object(this),n=e.length>>>0,r=arguments.length>=2?arguments[1]:void 0,i=0;i<n;i++)if(i in e&&t.call(r,e[i],i,e))return!0;return!1}),function(t,e,n){var r=this,i=arguments;n.Promise=Promise.noConflict(),n.CLASSES={},n.lib={getGlobal:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return n?(t.BAMX.GLOBALS[e]=t.BAMX.GLOBALS[e]||{},t.BAMX.GLOBALS[e][n]):t.BAMX.GLOBALS[e]},setGlobal:function(e,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n?(t.BAMX.GLOBALS[e]=t.BAMX.GLOBALS[e]||{},t.BAMX.GLOBALS[e][n]=r):t.BAMX.GLOBALS[e]=r},getClass:function(t){return n.CLASSES[t]},setClass:function(t,e){n.CLASSES[t]=e},getReadyState:function(){return e.readyState},getCurrentDate:function(){return new Date},getReferer:function(){return e.referrer.trim()||null},getEmbedType:function(){return n.IS_IFRAME?"IFrame":"JS"},getClickIds:function(){try{var t=localStorage.getItem("nrtv_cids").split(",");return t.splice(t.length-63).join(",")}catch(t){return null}},random:function(){var e=t.crypto||t.msCrypto||{};if(e.getRandomValues)return e.getRandomValues(new Uint32Array(1))[0]/4294967296;if(Math.seedrandom&&!n.lib.getGlobal("HAS_RESEEDED"))try{Math.seedrandom((new Date).getTime()+navigator.userAgent,!0),n.lib.setGlobal("HAS_RESEEDED")}catch(t){}return Math.random()},getRandomId:function(){return n.lib.random().toString(36).substring(2)},getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*n.lib.random()|0;return("x"===t?e:3&e|8).toString(16)})},getQueryParameter:function(e,n){var r=e.split("?").slice(1);if(r.length){var i=r[0].split("&").map(function(t){var e=t.split("=");return e.length>2?[e[0],e.slice(1).join("=")]:e});r.length>1&&(i[i.length-1][1]+="?"+r.slice(1).join("?"));var o=i.find(function(t){return t[0]===n});return o=o?o[1]||!0:void 0,"string"==typeof o?t.decodeURIComponent(o):o}},isMobile:function(){return!!new MobileDetect(navigator.userAgent||navigator.vendor||t.opera).mobile()},isPhone:function(){var e=navigator.userAgent||navigator.vendor||t.opera;return!!new MobileDetect(e,600).phone()},isValidUrl:function(t){return function(t){return"string"==typeof t&&""!==t}(t)&&/^https?:\/\//i.test(t)},log:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];if(n.DEBUG){var i=Array.prototype.slice.call(e);i.unshift("BAMX DEBUG",(new Date).toTimeString()),console.log.apply(console,i)}},extract:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r={};return e.forEach(function(t){"object"==typeof t&&Object.assign(r,t)}),r},safe:function(t){try{return t.apply(null,Array.prototype.slice.call(arguments,1))}catch(t){return null}},debounce:function(e,n){var o=null;return function(){var s=r,a=i;o&&t.clearTimeout(o),o=t.setTimeout(function(){o=null,e.apply(s,a)},n)}},defer:function(){var t=void 0,e=void 0,r=new n.Promise(function(n,r){t=n,e=r});return{resolve:t,reject:e,promise:r}},runOnce:function(t){var e=!1;return function(){if(!e)return e=!0,t.apply(r,Array.prototype.slice.call(i))}},addEventListenerTo:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={useCapture:!0};return Object.assign(i,r),t.addEventListener?t.addEventListener(e,n,i):t.attachEvent&&t.attachEvent("on"+e,n),n},addEventListenerSafelyTo:function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n.lib.addEventListenerTo(t,e,function(){try{r.apply(this,Array.prototype.slice.call(arguments))}catch(t){return null}},i)},removeEventListenerFrom:function(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!0):t.attachEvent&&t.detachEvent("on"+e,n)},onDomContentLoaded:function(r){r=n.lib.runOnce(r),n.lib.addEventListenerTo(e,"DOMContentLoaded",r),n.lib.addEventListenerTo(t,"load",r);var i=function(){"interactive"!==e.readyState&&"complete"!==e.readyState||r()};e.onreadystatechange=i,i()},localStorage:{setItem:function(e,n){if(t.localStorage&&t.localStorage.setItem)try{t.localStorage.setItem(e,n)}catch(t){console.warn("NRTV: Failed to set "+e+" to "+n+" in localStorage: "+t)}},getItem:function(e){try{return t.localStorage&&t.localStorage.getItem?t.localStorage.getItem(e):null}catch(t){return null}}},getCookie:function(t){var n=e.cookie.match(t+"=([^ ;]+)");return n&&n.length>1?n[1]:null},setCookie:function(t,n,r,i){e.cookie=t+"="+n+"; expires="+r+"; path="+i},toDecimal:function(t){var e=parseFloat(t);if(isNaN(e))throw"Cannot convert '"+t+"' to decimal";return e.toFixed(2)},decimalSeparatorForLocale:function(){try{return.5.toLocaleString()[1]}catch(t){return"."}},formatPrice:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof t){if(e){var i=Math.round(parseFloat(t));t=isNaN(i)?t:i.toFixed(2)}try{var o=t.split(".");if(2!==o.length||isNaN(parseInt(o[0]))||isNaN(parseInt(o[1])))return t;var s=parseInt(o[0]).toLocaleString(),a=void 0;return a=r?n.lib.decimalSeparatorForLocale()+o[1]:"00"===o[1]?"":n.lib.decimalSeparatorForLocale()+o[1],s+a}catch(e){return t}}return t},easeOutQuart:function(t,e,n,r){return t=Math.max(Math.min(t,r),0),-n*((t=t/r-1)*t*t*t-1)+e},effectiveBrowserWidth:function(){try{return t.outerWidth||t.innerWidth}catch(t){return null}},ellipsify:function(t,e,n){if(t){var r=t.getAttribute("data-full-text");r||(r=t.textContent,t.setAttribute("data-full-text",r)),t.textContent=r;var i=function(){var r=getComputedStyle(t);return parseInt(r.height)-(parseInt(r.paddingTop)+parseInt(r.paddingBottom))<=e*n};i()||function e(n,r,o){var s=Math.floor((r+o)/2),a=n.substr(0,s);t.textContent=a+"...";var l=i();l&&o-r>1?e(n,s,o):l||e(n,r,s)}(r,0,r.length)}},hasClass:function(t,e){return(" "+t.className+" ").indexOf(" "+e+" ")>-1},findAncestorWithClass:function(t,e){for(;t&&(t=t.parentElement)&&!n.lib.hasClass(t,e););return t},redirect:function(e){t.location=e},getAuctionUrlParams:function(t){var e=["a="+encodeURIComponent(t.auctionId),"t="+encodeURIComponent(n.core.getTimestamp()),"uuid="+t.sessionUuid];return t.u1Param&&e.push("u1="+t.u1Param),e},apiRunAuction:function(t){var e=n.Api.destination+"/api/v0/auction/?"+t.urlParams.join("&");return n.Request.get(e).then(function(e){return n.lib.getGlobal("AUCTION_MAP")[t.auctionId].endTime=n.lib.getCurrentDate(),n.Promise.resolve(e.data[0])},function(t){n.timer.logEvent("Auction error "+JSON.stringify(t))})},runAuction:function(t){if(!n.lib.getGlobal("AUCTION_MAP")[t]){n.timer.logEvent("auction_start");var e={auctionId:t,urlParams:n.lib.getAuctionUrlParams({auctionId:t,sessionUuid:n.lib.getGlobal("PAGE_SESSION_UUID")})};n.lib.getGlobal("AUCTION_MAP")[t]={startTime:n.lib.getCurrentDate(),endTime:null,response:n.lib.apiRunAuction(e)}}},getTightAuctionUpdates:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};if(!t.auction_result||!t.auction_result.product)return e;var n=t.auction_result.product,r=n.merchant;if(r&&(r.name&&(e.merchantName=r.name),"string"==typeof r.url)){var i=r.url;-1===i.search(/(^\/\/)|(.:\/\/)/)&&(i="http://"+i),e.merchantUrl=i}return n.price&&!isNaN(parseFloat(n.price))&&(e.price=n.price),e.is_in_stock=n.is_in_stock,e}},n.DEBUG=n.DEBUG_MODE||!!n.lib.localStorage.getItem("BAMX_DEBUG");var o=function(){var t=this;this._events=[],this.printEvent=function(e){var n=t._events[e],r=n.event;if("object"==typeof r&&(r=JSON.stringify(n.event)),e>0){var i=n.date.getTime()-t._events[e-1].date.getTime();console.warn("BAMX: "+r+" +"+i)}else console.warn("BAMX: "+r)},this.logEvent=function(e){t._events.push({event:e,date:new Date}),n.DEBUG&&t.printEvent(t._events.length-1)},this.getTimeBetween=function(e,n){for(var r=null,i=null,o=0;o<t._events.length&&(null===r&&t._events[o].event===e&&(r=event.date.getTime()),null===i&&event.event===n&&(i=event.date.getTime()),null===r||null===i);o++);return null===r||(null===i?null:i-r)},this.getTimeToFirstRewrite=function(){return t.getTimeBetween("start","bam_link_rewrite")},this.report=function(){for(var e=0;e<t._events.length;e++)t.printEvent(e);console.warn("BAMX: Time to first link rewrite: "+t.getTimeToFirstRewrite()+"ms")}};try{n.timer=new o,n.timer.logEvent("start")}catch(t){n.timer=null,n.DEBUG&&console.warn(t)}}(window,document,CONTAINED_BAMX_OBJ),function(t,e){e.Api=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"getEventEndpointUrl",value:function(t,e){return this.destination+"/api/v0/events/"+t+"/"+e+"/"}},{key:"getEventLogUrl",value:function(t,e){return this.destination+"/api/v0/logs/"+t+"/"+e+"/"}},{key:"_destinationHost",get:function(){switch(e.ENV){case"local":return"api.bam-x.site";case"dev":return"dev-api.bam-x.com";case"staging":return"staging-api.bam-x.com";case"test":return"localhost:12222";default:return"api.bam-x.com"}}},{key:"destination",get:function(){return"https://"+this._destinationHost}}]),t}()}(window,CONTAINED_BAMX_OBJ),function(t,e){e._MOCKED_REQUESTS=[],e._REQUESTS={},e.Request=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"dependencies",value:function(){return e.lib.getGlobal("PROMISE","USER_SESSION_TRACKING")}},{key:"setBamHeaders",value:function(n,r){var i={};i[e.UID_BAM_KEY]=t.BAMX.UID_BAM,i[e.OPT_OUT_KEY]=t.BAMX.OPT_OUT_VALUE;var o=JSON.stringify(i);try{var s=t.BAMX.GLOBALS.PIXEL_VERSION.split("/tags/")[1].split(".js")[0]||"";n.setRequestHeader("X-Howl-Pixel-Version",s)}catch(t){}n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept",o),n.setRequestHeader("X-BAM-Params",o),r.headers={Accept:o,"X-Bam-Params":o}}},{key:"mockRequest",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o={method:t,url:n,data:r,headers:i};return e._MOCKED_REQUESTS.push(o),e.Promise.resolve(this.responseTemplate)}},{key:"updateRequestLog",value:function(t,e){Object.keys(e).forEach(function(n){t[n]=e[n]})}},{key:"logRequest",value:function(t,n){e.DEBUG&&(e._REQUESTS[t]||(e._REQUESTS[t]=[]),e._REQUESTS[t].push(n))}},{key:"addXhrHandlers",value:function(t,n,r,i){var o=this;t.onload=function(){if(o.updateRequestLog(i,{status:t.status,responseText:t.responseText}),t.status>=200&&t.status<300)try{n(JSON.parse(t.responseText))}catch(r){e.timer.logEvent("Status "+t.status+" for request "+t.responseURL),n(o.responseTemplate)}else r({status:t.status})},t.onerror=function(){o.updateRequestLog(i,{status:t.status,responseText:t.responseText}),r({status:t.status})}}},{key:"request",value:function(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o={};return this.dependencies().then(function(){return new e.Promise(function(e,s){var a=new XMLHttpRequest;a.open(t,n,!0),r.updateRequestLog(o,{method:t,url:n,data:i}),r.setBamHeaders(a,o),r.addXhrHandlers(a,e,s,o),a.send(JSON.stringify(i)),r.logRequest(n,o)})})}},{key:"makeRequest",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.CORE_CONFIG.isPreview?this.mockRequest(t,n,r,i):this.request(t,n,r,i)}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.makeRequest("GET",t,e,n)}},{key:"post",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.makeRequest("POST",t,e,n)}},{key:"responseTemplate",get:function(){return{info:{},data:[]}}}]),n}(),e.HappyRequest=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),_createClass(e,null,[{key:"request",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=-1===n.indexOf("?")?n+"?_suppress_http_errors=1":n+"&_suppress_http_errors=1",_get(e.__proto__||Object.getPrototypeOf(e),"request",this).call(this,t,n,r)}}]),e}(e.Request),e.lib.setClass("Request",e.Request)}(window,CONTAINED_BAMX_OBJ),function(t,e,n){var r,i={get:function(t){return n.lib.getCookie(t)},set:function(t,e){var r=new Date;r.setMonth(r.getMonth()+18);var i=r.toUTCString();n.lib.setCookie(t,e,i,"/")}},o={get:function(e){var n=t.name.match(e+"=([^;]+)");return n&&n.length>1?n[1]:null},set:function(e,n){t.name=e+"="+n+";"}};n.UID_BAM_KEY="uid_bam",n.OPT_OUT_KEY="BAMX_Opt_Out",n.UID_BAM_STORAGES=(r={},_defineProperty(r,n.UID_BAM_KEY,i),_defineProperty(r,n.OPT_OUT_KEY,o),r);var s=function(){var e=this;this.init=function(){e.isChrome=t.navigator.userAgent.indexOf("Chrome/")>-1,n.lib.getGlobal("PROMISE","SESSION_PIXEL")||n.lib.setGlobal("PROMISE","SESSION_PIXEL",e.loadSessionPixel()),n.lib.getGlobal("PAGE_SESSION_UUID")||e.initPageSession(),n.lib.getGlobal("PROMISE","USER_SESSION_TRACKING")||e.initUserSession()},this.initPageSession=function(){n.lib.setGlobal("PAGE_SESSION_UUID_OLD","",n.lib.getGlobal("PAGE_SESSION_UUID")),n.lib.setGlobal("PAGE_SESSION_UUID","",n.lib.getUUID());var t=n.Promise.resolve(n.lib.getGlobal("PAGE_SESSION_UUID"));n.lib.setGlobal("PROMISE","PAGE_SESSION_UUID",t)},this.initUserSession=function(){var t=n.Promise.props({session_pixel:n.lib.getGlobal("PROMISE","SESSION_PIXEL"),session_uuid:n.lib.getGlobal("PROMISE","PAGE_SESSION_UUID")});n.lib.setGlobal("PROMISE","USER_SESSION_TRACKING",t)},this.init()};s.prototype.loadSessionIFrameData=function(){var r=this;return new n.Promise(function(i){n.lib.addEventListenerSafelyTo(t,"message",function(e){if("https://events.release.narrativ.com"===e.origin&&e.data){n.timer.logEvent("iframe_loaded");var o,s,a=!1;try{var l=JSON.parse(e.data);o=l.uid_bam,s=l[n.OPT_OUT_KEY],a=l.uid_is_new}catch(t){o=e.data,s="",a=!1}t.BAMX.OPT_OUT_VALUE=s,a&&(t.BAMX.UID_BAM=r.loadUidBamCookie()),t.BAMX.UID_BAM||(t.BAMX.UID_BAM=o),r.setUidBamCookie(),i({uidBam:o,optOutValue:s,uidIsNew:a})}}),n.lib.onDomContentLoaded(function(){var t=e.createElement("iframe");t.sandbox="allow-same-origin allow-scripts",t.style.display="none",t.src="https://events.release.narrativ.com/api/v0/session.html",e.body.appendChild(t),n.timer.logEvent("iframe_load")})})},s.prototype.loadSessionPixel=function(){return n.CORE_CONFIG.isPreview?n.Promise.resolve({uidBam:"PREVIEW_UID_BAM",optOutValue:"PREVIEW_OPT_OUT_VALUE",uidIsNew:!1}):this.loadSessionIFrameData().then(function(e){return new n.Promise(function(r){var i=n.lib.runOnce(function(){n.timer.logEvent("pixel_loaded"),r()}),o=new t.Image;n.lib.addEventListenerSafelyTo(o,"load",i);var s=e.uidBam?"?"+n.UID_BAM_KEY+"="+e.uidBam:"";o.src="https://events.release.narrativ.com/api/v0/session.gif"+s,n.timer.logEvent("pixel_load");var a=0;!function t(){o.complete||a>9?i():(a++,setTimeout(t,25))}()})})},s.prototype.loadUidBamCookie=function(){for(var e=0;e<n.UID_BAM_STORAGES.length&&!t.BAMX.UID_BAM;e++)t.BAMX.UID_BAM=n.UID_BAM_STORAGES[e].get(n.UID_BAM_KEY);return t.BAMX.UID_BAM},s.prototype.setUidBamCookie=function(){for(var e=0;e<n.UID_BAM_STORAGES.length;e++)n.UID_BAM_STORAGES[e].set(n.UID_BAM_KEY,t.BAMX.UID_BAM)},s.prototype.triggerEvent=function(e,r,i,o,s){var a=n.Api.getEventEndpointUrl(e,r);return 1048===s&&"publisher"===o?void 0:("impressions"===e?a="https://events.release.narrativ.com/api/v0/"+o+"s/"+s+"/impressions/"+r+"/?uid_bam="+t.BAMX.UID_BAM:"checkout"!==r&&"bam_link_hover"!==r||(a="https://events.release.narrativ.com/api/v0/"+o+"s/"+s+"/interactions/"+r+"/?uid_bam="+t.BAMX.UID_BAM),n.lib.getClass("Request").post(a,i).catch(function(t){n.timer.logEvent({message:"Event failed",error:t})}))},s.prototype.getGoogleAnalyticsTracker=function(){return n.lib.getCookie("_ga")},s.prototype.getOmnitureTracker=function(){try{return n.lib.getCookie("s_vi").match(/^\[CS\]v1\|([0-9a-zA-Z]+-[0-9a-zA-Z]+)\[CE\]$/)[1]||null}catch(t){return null}},s.prototype.getQuantcastTracker=function(){return n.lib.getCookie("__qca")},s.prototype.getBurstnetTracker=function(){return n.lib.getCookie("bn_u")},s.prototype.getGoogleAnalyticsUtmaTracker=function(){return n.lib.getCookie("__utma")},s.prototype.getOptimizelyTracker=function(){return n.lib.getCookie("optimizelyEndUserId")},s.prototype.getUserAgent=function(){return t.navigator.userAgent},s.prototype.getUserEmail=function(){return t.BAMX_EVENT_DATA?t.BAMX_EVENT_DATA.user_email||null:null},s.prototype.anonymizeProperties=function(t,e){var n={};return e.forEach(function(e){"object"==typeof t&&"string"==typeof t[e]&&(n[e]=t[e].replace(/[^@.\s]/g,"*"))}),n},s.prototype.loadImpressionPixelWithUrl=function(e){if(e){var r=new t.Image;try{r.src=e.replace("{RAND}",n.lib.getRandomId())}catch(t){}}},s.prototype.getTimestamp=function(){return Date.now()},n._Core=s,n.core=new s
}(window,document,CONTAINED_BAMX_OBJ),function(t,e,n){var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.el=t,this.visibleOpts=n.lib.extract({minPixelsOnPageRatio:1,minVisiblePointsRatio:.6,minVisibleOpacityRatio:.5},e)};r.prototype.getBoundingClientRect=function(){return this.el?this.el.getBoundingClientRect():null},r.prototype.isElementReallyVisible=function(){return this.elementIsOnTheScreen()&&this.elementIsOpaque()&&this.elementIsOnTop()&&this.allAncestorsAreDisplayed()},r.prototype.elementIsOnTheScreen=function(){var t=this.getBoundingClientRect();if(!t||t.bottom<0||t.right<0)return!1;var n=t.height*t.width,r=e.body.scrollWidth,i=e.documentElement.clientHeight;return(n-((t.top<0?Math.abs(t.top)*t.width:0)+(t.bottom>i?(t.bottom-i)*t.width:0)+(t.left<0?Math.abs(t.left)*t.height:0)+(t.right>r?(t.right-r)*t.height:0)))/n>=this.visibleOpts.minPixelsOnPageRatio},r.prototype.elementIsOpaque=function(){var e=t.getComputedStyle(this.el),n=e.opacity;return""===n||parseFloat(n)>=this.visibleOpts.minVisibleOpacityRatio},r.prototype.elementIsOnTop=function(){var t=this,n=function(n){for(;n&&n!==e;){if(n===t.el)return!0;n=n.parentNode}return!1},r=this.getBoundingClientRect(),i=r.width/4,o=r.height/4,s=r.height/2,a=r.width/2,l=[{y:r.top+o,x:r.left+i},{y:r.top+o,x:r.right-i},{y:r.bottom-o,x:r.left+i},{y:r.bottom-o,x:r.right-i},{y:r.top+a,x:r.left+s}],c=l.map(function(t){return e.elementFromPoint(t.x,t.y)}),u=c.map(function(t){return n(t)}).reduce(function(t,e){return t+e});return Math.round(100*u)/100/l.length>=this.visibleOpts.minVisiblePointsRatio},r.prototype.allAncestorsAreDisplayed=function(){for(var t=this.el;t!==e;){if(!this.elementIsDisplayed(t))return!1;t=t.parentNode}return!0},r.prototype.elementHeight=function(){var t=this.getBoundingClientRect();return t?t.height:0},r.prototype.elementWidth=function(){var t=this.getBoundingClientRect();return t?t.width:0},r.prototype.elementIsDisplayed=function(e){var n=t.getComputedStyle(e);return!("none"===n.display||"hidden"===n.visibility)},n.ElementViewer=r}(window,document,CONTAINED_BAMX_OBJ),function(t,e){e.Widget=function(){function n(){_classCallCheck(this,n),this.elementViewer=null,this.elementViewerOpts={},this.elementSelector=null,this.LOADED=!1,this.VIEWED=!1,this.deferWidgetLoaded=null,this.deferWidgetViewed=null,this.widgetLoaded=null,this.widgetViewed=null,this.debounceMs=20,this.observer=null,this.observerTimeout=null,this._listeners=[],this._viewableListeners=[],this.isSinglePage=!1}return _createClass(n,[{key:"formatField",value:function(t,e){return t?(t.length>e&&(t=t.substring(0,e)),t):null}},{key:"getOrganizationType",value:function(){return null}},{key:"getOrganizationId",value:function(){return null}},{key:"getEventData",value:function(){return{}}},{key:"getCurrentUrl",value:function(){var e=document.querySelector('link[rel="canonical"]');return e&&!this.isSinglePage?e.href:t.location.href}},{key:"getUserEventData",value:function(t,n){var r=this;return"impressions"===t||"checkout"===n||"bam_link_hover"===n?e.lib.getGlobal("PROMISE","USER_SESSION_TRACKING").then(function(t){return{page_session_uuid:r.sessionUuid||t.session_uuid,source_url:r.formatField(r.getCurrentUrl(),2048),previous_url:r.formatField(e.lib.getReferer(),2048)}}):e.lib.getGlobal("PROMISE","USER_SESSION_TRACKING").then(function(t){return{page_session_uuid:r.sessionUuid||t.session_uuid,source_url:r.formatField(r.getCurrentUrl(),2048),previous_url:r.formatField(e.lib.getReferer(),2048),source_user_id:r.formatField(e.core.loadUidBamCookie(),254),uid_google_analytics:r.formatField(e.core.getGoogleAnalyticsTracker(),50),uid_omniture:r.formatField(e.core.getOmnitureTracker(),50),uid_quantcast:r.formatField(e.core.getQuantcastTracker(),50),uid_burstnet:r.formatField(e.core.getBurstnetTracker(),50),user_agent:r.formatField(e.core.getUserAgent(),512),email:r.formatField(e.core.getUserEmail(),254)}})}},{key:"getEventPayload",value:function(t,e){var n=this;return"impressions"===t||"checkout"===e||"bam_link_hover"===e?this.getUserEventData(t,e).then(function(t){return{user:t,events:[]}}):this.getUserEventData(t,e).then(function(t){return{organization_type:n.getOrganizationType(),organization_id:n.getOrganizationId(),user:t,events:[]}})}},{key:"triggerEvent",value:function(t,n,r){var i=this.getOrganizationId(),o=this.getOrganizationType();return this.getEventPayload(t,n).then(function(s){return s.events.push(r),e.core.triggerEvent(t,n,s,o,i)})}},{key:"triggerImpressionEvent",value:function(t,e){return e=e||this.getEventData(),this.triggerEvent("impressions",t,e)}},{key:"triggerInteractionEvent",value:function(t,e){return e=e||this.getEventData(),this.triggerEvent("interactions",t,e)}},{key:"getPageImpressionKey",value:function(){return"PAGE_IMPRESSION-"+this.getOrganizationType()+"-"+this.getOrganizationId()}},{key:"resetPageImpression",value:function(){var t=this.getPageImpressionKey();e.lib.setGlobal(t,"",null),this.triggerPageImpression()}},{key:"triggerPageImpression",value:function(){var t=this.getPageImpressionKey();if(!e.lib.getGlobal(t)){var n=this.triggerImpressionEvent("page_impression",{});e.lib.setGlobal(t,"",!0),e.lib.setGlobal("PROMISE",t,n)}}},{key:"shouldInitializeObserver",value:function(){return!!this.getElement()}},{key:"initializeMutationObserver",value:function(){var e=this;if(this.shouldInitializeObserver()){this.observer=new t.MutationObserver(function(){e.observerTimeout&&t.clearTimeout(e.observerTimeout),e.observerTimeout=t.setTimeout(function(){e.onDomMutation()},e.debounceMs)});var n={attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0};this.observer.observe(this.getElement(),n)}}},{key:"initializePromises",value:function(){var t=this;this.deferDomLoaded=e.lib.defer(),this.deferWidgetLoaded=e.lib.defer(),this.deferWidgetViewed=e.lib.defer(),this.deferDomLoaded.promise.catch(function(){e.timer.logEvent("deferDomLoaded was rejected",t)}),this.deferWidgetLoaded.promise.catch(function(){e.timer.logEvent("deferWidgetLoaded was rejected",t)}),this.deferWidgetViewed.promise.catch(function(){e.timer.logEvent("deferWidgetViewed was rejected",t)}),this.domLoaded=this.deferDomLoaded.promise,this.widgetLoaded=this.domLoaded.then(function(){return t.deferWidgetLoaded.promise}),this.widgetViewed=this.widgetLoaded.then(function(){return t.deferWidgetViewed.promise}),this.domLoaded.then(function(){return t.onDomLoad()}).catch(function(n){e.timer.logEvent("DOM failed to load",t,n)}),this.widgetLoaded.then(function(){return t.onWidgetLoad()}).catch(function(n){e.timer.logEvent("widget failed to load",t,n)}),this.widgetViewed.then(function(){return t.onWidgetView()}).catch(function(t){e.timer.logEvent("widget failed to be viewed",t)})}},{key:"checkDomLoaded",value:function(){var t=this;if(document.addEventListener("DOMContentLoaded",function(){t.deferDomLoaded.resolve()}),["complete","loaded","interactive"].indexOf(e.lib.getReadyState())>=0)return this.deferDomLoaded.resolve()}},{key:"checkLoaded",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e4;if(this.getElement())return this.deferWidgetLoaded.resolve();var i=Date.now(),o=i,s=null,a=function a(){var l=e.getElement();if(l)return clearTimeout(s),e.deferWidgetLoaded.resolve(l);var c=Date.now(),u=c-o;if(c-i>r)return clearTimeout(s),e.deferWidgetLoaded.reject();u>n&&(t*=2,o=c),s=setTimeout(a,t)};s=setTimeout(a,t)}},{key:"checkViewable",value:function(){!this.VIEWED&&this.isViewable()&&(this.deferWidgetViewed.resolve(),this.removeViewableListeners())}},{key:"getElement",value:function(){return document.querySelector(this.elementSelector)}},{key:"getElementLink",value:function(){return this.getElement()}},{key:"onClick",value:function(){}},{key:"onResize",value:function(){this.checkViewable()}},{key:"onScroll",value:function(){this.checkViewable()}},{key:"update",value:function(){this.checkViewable()}},{key:"addListener",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.constructor.addListener(t,e,n,r,this._listeners)}},{key:"addViewableListener",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.constructor.addListener(t,e,n,r,this._viewableListeners)}},{key:"addListeners",value:function(){var n=this;this.addViewableListener(t,"scroll",e.lib.debounce(function(){return n.onScroll()},50))}},{key:"removeListeners",value:function(){this.constructor.removeListeners(this._listeners)}},{key:"removeViewableListeners",value:function(){this.constructor.removeListeners(this._viewableListeners)}},{key:"addElementViewer",value:function(){this.elementViewer=new e.ElementViewer(this.getElement(),this.elementViewerOpts)}},{key:"pageChanged",value:function(){var t=this.getCurrentUrl();return t!==this.location&&(this.location=t,!0)}},{key:"onDomMutation",value:function(){}},{key:"onDomLoad",value:function(){this.checkLoaded()}},{key:"onWidgetLoad",value:function(){this.addListeners(),this.addElementViewer(),this.triggerPageImpression(),this.LOADED=!0,this.location=this.getCurrentUrl()}},{key:"onWidgetView",value:function(){this.VIEWED=!0,this.removeViewableListeners()}},{key:"isViewable",value:function(){return!!this.elementViewer&&this.elementViewer.isElementReallyVisible()}},{key:"destroy",value:function(){this.getElement().remove(),this.removeListeners()}},{key:"run",value:function(){return this.initializePromises(),this.initializeMutationObserver(),this.checkDomLoaded(),this.checkLoaded(),this.checkViewable(),this}}],[{key:"addListener",value:function(t,n,r,i,o){i=i||{};var s=e.lib.addEventListenerSafelyTo(t,n,r,i);o.push({element:t,event:n,listener:s,options:i})}},{key:"removeListeners",value:function(t){for(var n=0;n<t.length;n++){var r=t[n];e.lib.removeEventListenerFrom(r.element,r.event,r.listener)}}}]),n}()}(window,CONTAINED_BAMX_OBJ),function(t,e){e.PublisherWidget=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.pubId=t,n}return _inherits(e,t),_createClass(e,[{key:"getOrganizationType",value:function(){return"publisher"}},{key:"getOrganizationId",value:function(){return this.pubId}}]),e}(e.Widget)}(window,CONTAINED_BAMX_OBJ),function(t,e){e.MerchantWidget=function(t){function e(t,n){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.element=t,r.merchId=n,r}return _inherits(e,t),_createClass(e,[{key:"getOrganizationType",value:function(){return"merchant"}},{key:"getOrganizationId",value:function(){return this.merchId}},{key:"getElement",value:function(){return this.element}}]),e}(e.Widget)}(window,CONTAINED_BAMX_OBJ),function(t,e,n){n.Link=function(e){function r(t,e){_classCallCheck(this,r);var i=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return i.elementSelector=t,i.auctionId=null,i.redirectUrl=null,i.displayUrl=null,i.productMouseHoverTimer=null,i.sessionUuid=null,i.u1Param=null,i._auctionHasStartedPromise=new n.Promise(function(t,e){i._auctionHasStartedResolve=t,i._auctionHasStartedReject=e}),i}return _inherits(r,e),_createClass(r,[{key:"getEventData",value:function(){return{auction_id:this.auctionId}}},{key:"setSessionUuid",value:function(){this.sessionUuid=n.lib.getGlobal("PAGE_SESSION_UUID")}},{key:"parseAuctionUrl",value:function(){var t=this.getElementLink(),e=/^https?:\/\/.*?shop-links.[^/]+\/(\d{19}|affiliate|[a-zA-Z0-9]{11})/,n=/^https?:\/\/.*?howl.[^/]+\/(\d{19}|affiliate|[a-zA-Z0-9]{11})/;try{var r=t.href.match(e),i=t.href.match(n);if(r){this.auctionId=r[1];var o=t.href.match(/u1=([^&]*)/);o&&(this.u1Param=o[1])}else if(i){this.auctionId=i[1];var s=t.href.match(/u1=([^&]*)/);s&&(this.u1Param=s[1])}else this.auctionId=t.hash.substring("#bamx-".length).match(/^(?:\d+|affiliate)$/)[0]}catch(t){}}},{key:"getAuction",value:function(){return n.lib.getGlobal("AUCTION_MAP")[this.auctionId]}},{key:"setAuction",value:function(t){n.lib.getGlobal("AUCTION_MAP")[this.auctionId]=t,this._auctionHasStartedResolve()}},{key:"auctionHasStarted",value:function(){return this._auctionHasStartedPromise}},{key:"getPreviewAuctionResponse",value:function(){return{auction_result:{redirect_url:"http://isPreview.example/",tracker_urls:{impression:[],viewable_impression:[]}}}}},{key:"getAuctionResponse",value:function(){return n.CORE_CONFIG.isPreview?Promise.resolve(this.getPreviewAuctionResponse()):this.getAuction().response}},{key:"getAuctionUrlParams",value:function(){var t={auctionId:this.auctionId,sessionUuid:this.sessionUuid,u1Param:this.getU1Param()};return n.lib.getAuctionUrlParams(t)}},{key:"getU1Param",value:function(){return t.BAMX_EVENT_DATA&&t.BAMX_EVENT_DATA.u1Param?t.BAMX_EVENT_DATA.u1Param:this.u1Param}},{key:"apiRunAuction",value:function(){var t={auctionId:this.auctionId,urlParams:this.getAuctionUrlParams()};return n.lib.apiRunAuction(t)}},{key:"runAuction",value:function(){var t=this;this.getAuction()||(n.timer.logEvent("auction_start"),this.setAuction({startTime:n.lib.getCurrentDate(),endTime:null,response:this.apiRunAuction()})),this.getElementLink().setAttribute("data-bamx-auction-start",this.getAuction().startTime.toString()),this.getAuctionResponse().then(function(e){t.postAuction(e)})}},{key:"postAuction",value:function(t){var e=this.getElementLink();n.timer.logEvent("bam_link_rewrite");var r=t.auction_result;this.redirectUrl=this.getRedirectUrl(r),this.displayUrl=this.constructor.getDisplayUrl(this.redirectUrl);var i=r.product&&r.product.merchant,o=i&&i.canonical_host||"";new URL(this.displayUrl).hostname.split(".").slice(1).join(".")!==o&&(this.displayUrl=this.constructor.getDisplayUrl(this.displayUrl));var s={"data-bamx-auction":JSON.stringify(t),"data-bamx-auction-end":this.getAuction().endTime.toString(),href:this.displayUrl,rel:"nofollow noskim",target:"_blank"};Object.keys(s).forEach(function(t){e.setAttribute(t,s[t])}),n.timer.logEvent("Rewriting link with auction ID "+this.auctionId+" to "+this.redirectUrl+" and showing "+this.displayUrl),n.timer.logEvent("postAuction",t,this.displayUrl,this.redirectUrl)}},{key:"getRedirectUrl",value:function(t){return t.redirect_url}},{key:"addListeners",value:function(){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"addListeners",this).call(this);var t=this.getElementLink();this.addListener(t,"click",this.onClick.bind(this)),this.addListener(t,"contextmenu",this.onClick.bind(this)),this.addListener(t,"auxclick",this.onClick.bind(this)),this.addListener(t,"touchend",this.onClick.bind(this)),this.addListener(t,"mouseenter",this.onProductMouseEnter.bind(this)),this.addListener(t,"mouseleave",this.onProductMouseLeave.bind(this))}},{key:"onClick",value:function(){var t=this;this.getAuctionResponse().then(function(e){var n=t.getElementLink();n.setAttribute("href",t.redirectUrl),setTimeout(function(){n.setAttribute("href",t.displayUrl)},10)})}},{key:"onProductMouseEnter",value:function(){var t=this;this.productMouseHoverTimer=setTimeout(function(){t.triggerInteractionEvent("bam_link_hover")},1e3)}},{key:"onProductMouseLeave",value:function(){clearTimeout(this.productMouseHoverTimer)}},{key:"onWidgetLoad",value:function(){var t=this;_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"onWidgetLoad",this).call(this),this.setSessionUuid(),this.parseAuctionUrl(),this.runAuction(),this.getAuctionResponse().then(function(e){t.triggerImpressionEvent("bam_link_impression"),t.checkViewable(),t.constructor.loadImpressionTrackers(e.auction_result.tracker_urls)})}},{key:"onWidgetView",value:function(){var t=this;_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"onWidgetView",this).call(this),this.getAuctionResponse().then(function(e){t.triggerImpressionEvent("bam_link_viewable_impression"),t.constructor.loadViewableImpressionTrackers(e.auction_result.tracker_urls)})}},{key:"hasUpdates",value:function(t){return t.price||t.merchantName}}],[{key:"getDisplayUrl",value:function(e){var r=null;try{r=decodeURIComponent(e.match(/[?&]url=([^&#]*)/i)[1])}catch(t){}r=r||e;var i=null,o=new Set(["(ulta.7eer.net)","(sjv.io)","(rfvk.net)","(bn5x.net)","(vzew.net)","(uikc.net)","(goto.walmart.com)","(goto.target.com)","(7tiv.net)","(ztk5.net)","(adidas.njih.net)","(dsw.am3t9s.net)","(levis.pfm4.net)","(proactiv.rw9xb6.net)","(goop.6noy.net)","(gap.igs4ds.net)","(surlatable.aiy7.net)","(mynuface.pxf.io)"]),s={brooklinen:/https?:\/\/brooklinen\.pxf\.io\//i,viglink:/https?:\/\/redirect\.viglink\.com/i,doubleclick:/https?:\/\/ad\.doubleclick\.net\/ddm\/(track)?clk\//i,atlas:/https?:\/\/ad\.atdmt\.com\/c\//i,linkshareLink:/https?:\/\/click\.linksynergy\.com\/link/i,linkshareClick:/https?:\/\/click\.linksynergy\.com\/fs-bin\/click/i,linkshareDeeplink:/https?:\/\/click\.linksynergy\.com\/deeplink/i,skimlinks:/https?:\/\/go\.redirectingat\.com\//i,impactRadius:[].concat(_toConsumableArray(o)).join("|"),connexity:/https?:\/\/rd\.bizrate\.com\/rd/i,connexityGeneric:/https?:\/\/link\.sylikes\.com/i,connexityWalmart:/http?:\/\/c\.affil\.walmart\.com\/t\/csebr03/i,connexityClickserve:/http?:\/\/clickserve\.dartsearch\.net\/link\/click/i,connexityRandomClick:/https?:\/\/www\.\w|.{9,13}\/click-8114875-13419515/i,connexityAdlucent:/https?:\/\/tracking\.deepsearch\.adlucent\.com\/adlucent\/Redirector/i,yesStyle:/https?:\/\/www\.yesstyle\.com\/associate-referral\.html\?\w+\+/i,nordstrom:/https?:\/\/shop\.nordstrom\.com\//i,amazon:/https?:\/\/www\.amazon\.com\//i,subid:/https?:\/\/www\.(homedepot|bestbuy|ulta)\.com\/?(.*?)\/?&?\\??(subid|irclickid)/i,cj:/https?:\/\/www\.anrdoezrs\.net\//i,fave:/https?:\/\/fave.co\//i,shareasale:/https?:\/\/(www.)?shareasale\.com/i,pepperjam:/https?:\/\/(www.)?(pjtra\.com)|(pjatr\.com)|(gopjn\.com)|(pntrac\.com)|(pntrs\.com)|(pntra\.com)\//i,partnerize:/https?:\/\/prf\.hn\//i,businessinsider:/.*\/reviews\/out?/i};try{if(0===r.search(s.viglink))i=decodeURIComponent(r.match(/[?&]u=([^&#]*)/i)[1]);else if(0===r.search(s.doubleclick)){var a=r.split("?");a.shift(),i=a.join("?")}else if(0===r.search(s.atlas)){var l=r.split("?h=");l.shift(),i=l.join("?h=")}else if(0===r.search(s.yesStyle)){var c=r.split("+");c.shift(),i=c.join("+")}else if(0===r.search(s.nordstrom))i=0===r.search(/https?:\/\/shop\.nordstrom\.com\/(.*?)origin=keywordsearch-personalizedsort/i)?r.split("?origin=keywordsearch")[0]:r.split("&")[0];else if(0===r.search(s.amazon))i=0===r.search(/https?:\/\/www\.amazon\.com\/(.*)\/ref=/i)?r.split("ref=")[0]:0===r.search(/https?:\/\/www\.amazon\.com\/(.*)\?tag=/i)?r.split("?tag=")[0]:0===r.search(/https?:\/\/www\.amazon\.com\/dp/i)||0===r.search(/https?:\/\/www\.amazon\.com\/(.*\/)dp/i)||0===r.search(/https?:\/\/www\.amazon\.com\/gp\/product\//i)?r.split("?")[0]:r.split("&")[0];else if(0===r.search(s.linkshareLink))i=t.decodeURIComponent(n.lib.getQueryParameter(r,"murl"));else if(0===r.search(s.linkshareClick))i=n.lib.getQueryParameter(r,"RD_PARM1");else if(0===r.search(s.linkshareDeeplink))i=n.lib.getQueryParameter(r,"murl");else if(0===r.search(s.skimlinks))i=n.lib.getQueryParameter(r.split("%https://go.skimresources.com")[0],"url");else if(r.search(s.impactRadius)>=0)if(n.lib.getQueryParameter(r,"u")&&n.lib.getQueryParameter(r,"u")!=r)i=decodeURIComponent(n.lib.getQueryParameter(r,"u")),i.includes("product.do?pid=")||i.includes("p/?variant_id=")?i=i.split("&")[0]:i.includes("productId=")||i.includes("cgid=")||(i=i.split("?")[0]);else if(r.includes("u=http")){var u="%3F";r.split(u).length<2&&(u="%26"),i=unescape(r.split("u=")[1].split(u)[0])}else r.includes("u=http")||(i=r.split("?")[0]);else if(0===r.search(s.connexity)){var h=n.lib.getQueryParameter(r,"t");i=0===h.search(s.connexityWalmart)?n.lib.getQueryParameter(h,"l"):0===h.search(s.connexityClickserve)?n.lib.getQueryParameter(h,"ds_dest_url"):0===h.search(s.connexityAdlucent)?n.lib.getQueryParameter(h,"url"):0===h.search(s.connexityRandomClick)?n.lib.getQueryParameter(h,"url"):n.lib.getQueryParameter(r,"t"),i=i||h}else 0===r.search(s.connexityGeneric)?i=n.lib.getQueryParameter(r,"url"):0===r.search(s.subid)?i=r.split(/&subid|&subId|\?subid|\?subId|&irclickid|\?irclickid/)[0]:0===r.search(s.cj)?i="https"+r.split("/https")[1].split("?")[0]:0===r.search(s.fave)?i=r.split(/&xcust|\?xcust/)[0]:0===r.search(s.amazon)?i=r.split("?")[0]:0===r.search(s.shareasale)?i=r.includes("urllink")?"https://"+n.lib.getQueryParameter(r,"urllink"):r.split("&afftrack")[0]:0===r.search(s.pepperjam)?i="https://"+n.lib.getQueryParameter(r,"url"):0===r.search(s.partnerize)?decodeURIComponent(r).includes("destination")?(i=decodeURIComponent(decodeURIComponent(r).split("destination:")[decodeURIComponent(r).split("destination:").length-1]),i.includes("?")&&(i=i.split("?")[0])):i=r:0===r.search(s.businessinsider)?(i=decodeURIComponent(n.lib.getQueryParameter(r,"u")),i.includes("&")&&(i=i.split("&")[0]),i.includes("?")&&(i=i.split("?")[0])):0===r.search(s.brooklinen)&&(i=decodeURIComponent(n.lib.getQueryParameter(r,"u")))}catch(t){}return i=i||r}},{key:"loadImpressionTrackers",value:function(t){for(var e=0;e<t.impression.length;e++){var r=t.impression[e];n.core.loadImpressionPixelWithUrl(r)}}},{key:"loadViewableImpressionTrackers",value:function(t){for(var e=0;e<t.viewable_impression.length;e++){var r=t.viewable_impression[e];n.core.loadImpressionPixelWithUrl(r)}}}]),r}(n.PublisherWidget)}(window,document,CONTAINED_BAMX_OBJ);!function(){var n="object"==typeof self&&self.self===self&&self,t=function(n){return"string"==typeof n},r=function(n){return"number"==typeof n},e=function(n){return"function"==typeof n},o=function(n){return Array.isArray?Array.isArray(n):"[object Array]"===Object.prototype.toString.call(n)},u=function(n){return"[object NodeList]"===Object.prototype.toString.call(n)},i=function(n){return/^\/(?:\S|\s)*\/[gimy]{0,4}$/.test(n)},l=function(n){var t=n.split("/"),r=t[t.length-1],e=n.slice(1,-1*(r.length+1));return new RegExp(e,r)},a=function(n,t){var r,e={};for(r in n)n.hasOwnProperty(r)&&(e[r]=t(r,n[r]));return e},f=function(n,t){var r,e={};for(r in n)n.hasOwnProperty(r)&&t(r,n[r])&&(e[r]=n[r]);return e},c={window:function(){return n},document:function(){return n.document},querySelectorAll:function(n){return function(t){return t?t.querySelectorAll(n):null}},querySelector:function(n){return function(t){return t?t.querySelector(n):null}},innerHTML:function(n){return n?n.innerHTML:null},innerText:function(n){return n?n.innerText||n.textContent:null},rootInnerText:function(n){if(!n)return null;for(var t=[],r=0;r<n.childNodes.length;r++)n.childNodes[r].nodeType===n.TEXT_NODE&&t.push(p.T.trim(p.T.innerText(n.childNodes[r])));return p.T.trim(t.join(" "))},value:function(n){return n?n.value:null},getAttribute:function(n){return function(t){return t&&t.getAttribute?t.getAttribute(n):null}},toInt:function(n){return t(n)||r(n)?parseInt(n,10):null},toFloat:function(n){return t(n)||r(n)?parseFloat(n):null},round:function(n){return r(n)?Math.round(n):null},multiplyBy:function(n){return function(t){return r(t)?n*t:null}},htmlToText:function(t){var r=n.document.createElement("div");r.innerHTML=t;var e=r.firstChild;return e?e.nodeValue+String():""},reverse:function(n){return t(n)?n.split("").reverse().join(""):o(n)?n.reverse():null},toString:function(n){return n?n+String():null},trim:function(n){return t(n)?n.trim():null},split:function(n,r){var e=[n];return void 0!==r&&e.push(parseInt(r,10)),function(n){return t(n)?n.split.apply(n,e):null}},join:function(n){return function(t){return o(t)?t.join(n):null}},replace:function(n,r){return n=t(n)&&i(n)?l(n):n,function(e){return t(e)?e.replace(n,r):null}},match:function(n){return n=t(n)&&i(n)?l(n):n,function(r){return t(r)?r.match(n):null}},getIndex:function(n){return n=parseInt(n,10),function(t){return o(t)&&t.length>n?t[n]:null}},slice:function(n,r){var e=[parseInt(n,10)];return void 0!==r&&e.push(parseInt(r,10)),function(n){var r;return t(n)?r=n?String.prototype.slice.apply(n,e):null:(o(n)||u(n))&&(r=n?Array.prototype.slice.apply(n,e):null),r}},getProperty:function(n){return function(t){return t?t[n]:null}},getProperties:function(n){return function(t){if(!t)return null;for(var r,e=n.split(".");e.length;)r=e.shift(),t=t?t[r]:null;return t}}},s={map:function(n){return function(t){return o(t)||u(t)?Array.prototype.map.call(t,n):null}}},p=function(n){return this instanceof p?this.extract(n):new p(n)};p.__objectMerge=function(){for(var n={},t=0;t<arguments.length;t++)if("object"==typeof arguments[t])for(var r in arguments[t])arguments[t].hasOwnProperty(r)&&(n[r]=arguments[t][r]);return n},p.prototype.T=p.T=p.__objectMerge(c,s),p.prototype.extract=function(n){var t=this,r=f(n,function(n,t){return o(t)});return a(r,function(n,r){var e,o=null;for(e=0;e<r.length;e+=1)o=t.applyTransformation(o,r[e]);return o})},p.prototype.applyTransformation=function(n,t){var r=this.getTransformation(t);if(!r)throw'Transformation "'+t+'" invalid';return r(n)},p.prototype.getTransformation=function(n){if(e(n))return n;if(!o(n)&&!t(n))throw"Invalid Input Type: "+typeof n;if(!n||!n.length)return null;var r;if(o(n)){if(1===n.length&&this.T.hasOwnProperty(n[0]))return this.T[n[0]];r=this.getTransformationForArrayTransformation(n)}else{if(this.T.hasOwnProperty(n))return this.T[n];r=this.getTransformationForStringTransformation(n)}return r?this.T[r.command].apply(this,r.args):null},p.prototype.getTransformationForArrayTransformation=function(n){var t=n[0];if(!this.T.hasOwnProperty(t))return null;var r=n.slice(1);if(s.hasOwnProperty(t)){var e=this.getTransformation(r);e&&(r=[e])}return{command:t,args:r}},p.prototype.getTransformationForStringTransformation=function(n){var t=n.split(":"),r=t.shift();if(!this.T.hasOwnProperty(r))return null;var e,o=t.join(":");return s.hasOwnProperty(r)&&(e=this.getTransformation(o)),{command:r,args:e?[e]:p.extractArgs(o)}},p.extractArgs=function(n){n=n||"";var t=n.match(/^(\/.*?(?:(?:\\\\)+|[^\\])\/[gimy]{0,4})(?:,|$)/i),r=[];if(t&&t.length){var e=n.slice(0,t[1].length);r.push(e);var o=t[0].length;n=n.slice(o),r=r.concat(n.split(","))}else n.length&&(r=r.concat(n.split(",")));return r},p.VERSION="0.4.5",n.Composable=p,"function"==typeof define&&define.amd&&define("composable",[],function(){return p})}();"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var i=[],r=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){n=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_get=function t(e,i,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();!function(t,e){var i=function(){function t(i){_classCallCheck(this,t),this.config=i,this.customerKey=this.config.slug.toUpperCase(),this.MerchantJsTag=e.lib.getClass("MerchantJsTag"),this.PublisherJsTag=e.lib.getClass("PublisherJsTag"),this.customClass=e.lib.getClass(this.config.jstagClass)}return _createClass(t,[{key:"getCustomerType",value:function(){return this.config.merchant&&this.config.publisher?"merch_pub":this.config.merchant?"merchant":"publisher"}},{key:"initializeAndRun",value:function(t,i){var r=void 0;return r="merchant"===i?new t(this.config.merchant,e.lib.getClass(this.config.dataLayerClass),this.config.componentClass):new t(this.config.publisher,e.lib.getClass(this.config.linkClass)),r.run(),r}},{key:"run",value:function(){var t=this.getCustomerType(),i=void 0;if("merch_pub"===t){i={MERCHANT:this.initializeAndRun(this.MerchantJsTag,"merchant"),PUBLISHER:this.initializeAndRun(this.PublisherJsTag,"publisher")},e.lib.getGlobal("PIXEL_VERSION")||document&&document.currentScript&&e.lib.setGlobal("PIXEL_VERSION","",document.currentScript.getAttribute("src"))}else{var r=void 0,n=void 0;"merchant"===t?(n=this.customClass||this.MerchantJsTag,r=this.initializeAndRun(n,"merchant")):(n=this.customClass||this.PublisherJsTag,r=this.initializeAndRun(n,"publisher")),e.lib.getGlobal("PIXEL_VERSION")||document&&document.currentScript&&e.lib.setGlobal("PIXEL_VERSION","",document.currentScript.getAttribute("src")),i=r}e.lib.setGlobal(this.customerKey,"",i)}}]),t}();e.JsTagLib=i,e.lib.setClass("JsTagLib",e.JsTagLib)}(window,CONTAINED_BAMX_OBJ),function(t,e,i){var r=function(r){function n(e,r){_classCallCheck(this,n);var a=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return a.config=e,a.elementSelector="body",t.NRTV_EVENT_DATA=t.NRTV_EVENT_DATA||{},a.defaultLinkmateData={executed:!1,payload:null,response:null,smartlinks:[]},a.linkmateKey="NRTV_LINKMATE_DATA",t.NRTV_LINKMATE_DATA=t.NRTV_LINKMATE_DATA||{},Object.assign(t.NRTV_LINKMATE_DATA,a.defaultLinkmateData),a.clickmateKey="NRTV_CLICKMATE_DATA",t.NRTV_CLICKMATE_DATA=t.NRTV_CLICKMATE_DATA||{},Object.assign(t.NRTV_CLICKMATE_DATA,a.defaultLinkmateData),a.Link=r||i.Link,a.bamlinks=[],a.linkmateLinks=[],a.clickmateData=[],a.linkmateEndpoint="https://links.release.narrativ.com/api/v2/smart_links/"+a.config.pub_id,a.clickReportingEndpoint=i.Api.destination+"/api/v0/links/click/",a.validDomains=a.config.widget_options.domains||[],a.linkmateExcludedHosts="adclick.g.doubleclick.net|w1.buysub.com|exoclick.com|facebook.com|instagram.com|pinterest.com|tumblr.com|twitter.com|youtube.com|zergnet.com|linkedin.com|pinterest.ca|t.me|telegram.me|paypal.com|reddit.com|podcasts.apple.com|itunes.apple.com",a.excludedStrings="#donotlink|mailto:",a.clickmateLinkPattern="shop-links.co/link",a.howlClickmateLinkPattern="howl.me/link",a.blacklistedElements=new Set,a.linkAttribute="href",a.noAuctionSet=new Set,a.host=t.location.host,a.originalURLs={},a.urlExclusiveKeywords=["sale","deal","clearance","promotion","percent-off","percentoff"],a.titleExclusiveKeywords=["sale","deal","clearance","percent off","% off","promotion"],a.titleExclusiveMerchants=["24 sevres","24 sèvres","aquis","asos","bed bath & beyond","bed bath and beyond","bergdorf goodman","best buy","bloomingdales","buy buy baby","caraway","cariuma","chewy","credo","credo beauty","dermstore","diane von furstenberg","dvf","everlane","farfetch","gap","goop","h&m","hanacure","huda","huda beauty","ilia","ilia beauty","kenneth cole","kosas","la roche-posay","lookfantastic","lord & taylor","lord and taylor","lovely skin","lucky vitamin","macy","macy's","macys","matches fashion","matchesfashion","michael kors","moda operandi","moda","mr porter","mr. porter","mytheresa","my theresa","neiman marcus","net-a-porter","nordstrom","revolve","revolve clothing","saks","saks fifth avenue","sephora","skinceuticals","skinstore","ssense","superdown","the outnet","ulta","ulta beauty","verishop","versed skin","versedskin","vichy","violet grey","yesstyle","yes style","yoox"],a}return _inherits(n,r),_createClass(n,[{key:"getOrganizationId",value:function(){return this.config.pub_id}},{key:"getAllBamLinkEls",value:function(){var t=['a[href*="bamx-"]','a[href*="bamx:"]','a[href*="shop-links.co/"]','a[href*="shop-links.site/"]','area[href*="shop-links.co/"]','area[href*="shop-links.site/"]','a[href*="howl.me/"]','area[href*="howl.me/"]'],i=/^https?:\/\/.*?shop-links.[^/]+\/(\d{19}|affiliate|[a-zA-Z0-9]{11})/,r=/^https?:\/\/.*?howl.[^/]+\/(\d{19}|affiliate|[a-zA-Z0-9]{11})/,n=/^#bamx(:|-)(\d+|affiliate)$/;return Array.from(e.querySelectorAll(t.join(","))).filter(function(t){return i.test(t.href)||n.test(t.hash)||r.test(t.href)})}},{key:"runBamLink",value:function(t){if(!t.getAttribute("data-bamx-link")){var e=i.lib.getRandomId();t.setAttribute("data-bamx-link",e);var r=new this.Link('[data-bamx-link="'+e+'"]',this.config.pub_id);r.run(),this.bamlinks.push(r)}}},{key:"loadAndRunAllBamLinks",value:function(){var t=this;this.getAllBamLinkEls().forEach(function(e){return t.runBamLink(e)})}},{key:"getLinkmateSelector",value:function(){return"a"}},{key:"addListeners",value:function(){var e=this;if(_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"addListeners",this).call(this),this.externalClickReporterEnabled()){var i=function(t){e.processClick(t)};t.document.addEventListener("click",i,!0),t.document.addEventListener("auxclick",i,!0)}}},{key:"processClick",value:function(t){var e=t.target.closest("a");if(e&&e.href){var i=e.href;this.isReportableDestination(e)&&this.reportClick(i)}}},{key:"scanForUrls",value:function(){var t=this;return this.linkmateLinks=[],this.clickmateData=[],new i.Promise(function(i){for(var r=e.querySelectorAll(t.getLinkmateSelector()),n=0;n<r.length;n++){var a=t.getLinkmateLink(r[n]),o=r[n].rel.includes("noauction");if(t.linkmateEligible(r[n])&&-1===t.linkmateLinks.indexOf(a)){var s=t.getClickmateData(a);s?t.clickmateData.push(s):(a=t.cleanLinkmateLinks(a),t.linkmateLinks.push(a),o&&t.noAuctionSet.add(a))}}i()})}},{key:"getLinkmateLink",value:function(t){return t[this.linkAttribute]}},{key:"cleanLinkmateLinks",value:function(t){return t}},{key:"runAllClickmateLinks",value:function(){var e=this;this.scanForClickmate().then(function(){return e.postToLinkmate()}).then(function(){e.rewriteLinks(e.linkmateKey),e.rewriteLinks(e.clickmateKey)}).then(function(){e.loadAndRunAllBamLinks(),t.NRTV_CLICKMATE_DATA.linkMapping=e.originalURLs})}},{key:"getClickmateElems",value:function(){var t=['a[href*="shop-links.co/link/"]','a[href*="shop-links.site/link/"]','a[href*="howl.me/link/"]'];return Array.from(e.querySelectorAll(t.join(",")))}},{key:"scanForClickmate",value:function(){var t=this;return this.clickmateData=[],new i.Promise(function(e){for(var i=t.getClickmateElems(),r=0;r<i.length;r++){var n=i[r][t.linkAttribute];if(t.linkmateEligible(i[r])&&-1===t.clickmateData.indexOf(n)){var a=t.getClickmateData(n);a&&t.clickmateData.push(a)}}e()})}},{key:"isReportableDestination",value:function(t){var e=t.href,r=t.host,n=t.getAttribute("data-bamx-auction"),a=null;if(n){try{a=JSON.parse(n)}catch(t){}if(a&&a.auction_result&&"string"==typeof a.auction_result.redirect_url)return!this.isNrtvTech(a.auction_result.redirect_url)}return!(!i.lib.isValidUrl(e)||this.sameHostAsPage(r)||this.isNrtvTech(e)||e.match(new RegExp(this.linkmateExcludedHosts)))}},{key:"isNrtvTech",value:function(t){if(t.includes(".nrtv_plchldr.")||t.includes("bam_box"))return!0;for(var e=["events.release.narrativ.com","api.bam-x.com","api.narrativ.com","shop-links.co","events.staging.narrativ.com","staging-api.bam-x.com","staging-api.narrativ.com","staging.shop-links.co","api.bam-x.site","api.narrativ.site","shop-links.site","howl.me","staging.howl.me"],i=0;i<e.length;i++)if(t.match(new RegExp("https?://"+e[i]+"/")))return!0;return!1}},{key:"isBamLink",value:function(t){var e=/^https?:\/\/.*?shop-links.[^/]+\/(\d{19}|affiliate|[a-zA-Z0-9]{11})/,i=/^https?:\/\/.*?howl.[^/]+\/(\d{19}|affiliate|[a-zA-Z0-9]{11})/;return!!(t.href.indexOf("#bamx-")>-1||t.href.indexOf("#bamx:")>-1||t.href.match(new RegExp("(api.bam-x.com|shop-links.site|staging-api.bam-x.com|shop-links.co|howl.me)\\/\\d+"))||e.test(t.href)||i.test(t.href))}},{key:"sameHostAsPage",value:function(t){return t.match(new RegExp(this.host.replace("www.","")))}},{key:"linkmateEligible",value:function(t){var e=this;return i.lib.isValidUrl(t.href)&&!this.sameHostAsPage(t.host)&&!this.isBamLink(t)&&!function(i){if(i.host.match(new RegExp(e.linkmateExcludedHosts))||i.href.match(new RegExp(e.excludedStrings)))return!0;if(e.blacklistedElements.size>0)for(var r=t.parentNode;r;){if(e.blacklistedElements.has(r.className))return!0;r=r.parentNode}return!1}(t)&&!function(t){return!!t.getAttribute("data-bamx-auction")}(t)&&!function(t){return"viglink"===t.getAttribute("data-hl")||"Link added by VigLink"===t.getAttribute("title")}(t)}},{key:"getEditInfo",value:function(){return{page_url:this.getCurrentUrl(),page_title:e.title||null}}},{key:"getClickmateData",value:function(t){if(!t.match(new RegExp("(api.bam-x.com|shop-links.site|staging-api.bam-x.com|shop-links.co)\\/link"))&&!t.match(new RegExp("(api.bam-x.com|staging-api.bam-x.com|howl.me)\\/link")))return null;var e=i.lib.getQueryParameter(t,"url");if(!e||!i.lib.isValidUrl(e))return null;var r=i.lib.getQueryParameter(t,"article_name"),n=i.lib.getQueryParameter(t,"article_url"),a="1"===i.lib.getQueryParameter(t,"exclusive"),o=i.lib.getQueryParameter(t,"u1"),s={page_title:r,page_url:n,url:e,exclusive_match_requested:a,link_source:"clickmate"};return o&&(s.u1=o),s}},{key:"hasExclusiveFlag",value:function(){return void 0===t.NRTV_EVENT_DATA.exclusiveLinks&&(t.NRTV_EVENT_DATA.exclusiveLinks=this.isExclusiveContent()),t.NRTV_EVENT_DATA.exclusiveLinks}},{key:"isExclusiveContent",value:function(){for(var e=t.location.href.toLowerCase(),i=0;i<this.urlExclusiveKeywords.length;i++)if(e.includes(this.urlExclusiveKeywords[i]))return!0;for(var r=t.document.title.toLowerCase(),n=0;n<this.titleExclusiveKeywords.length;n++)if(r.includes(this.titleExclusiveKeywords[n]))return!0;for(var a=0;a<this.titleExclusiveMerchants.length;a++)if(r.includes(this.titleExclusiveMerchants[a]))return!0;return!1}},{key:"shouldUnwrapLinks",value:function(){return!0}},{key:"buildLinkmatePayloads",value:function(){var t=this,e=[];this.linkmateLinks.forEach(function(i){var r=t.hasExclusiveFlag()||/#locklink$/.test(i)||t.noAuctionSet.has(i),n={raw_url:i,exclusive_match_requested:r,link_source:"linkmate"};e.push(n)});var i={edit:this.getEditInfo(),links:e};this.shouldUnwrapLinks()||(i.unwrap_links=!1);var r={};this.clickmateData.forEach(function(t,e){if(t.page_title===i.edit.page_title&&t.page_url===i.edit.page_url){var n={raw_url:t.url,exclusive_match_requested:t.exclusive_match_requested,link_source:t.link_source};i.links.find(function(t){return t.raw_url===n.raw_url})||i.links.push(n)}else{var a=t.page_title+t.page_url;r[a]||(r[a]={edit:{page_title:t.page_title,page_url:t.page_url},links:[]}),r[a].links.push({raw_url:t.url,exclusive_match_requested:t.exclusive_match_requested,link_source:t.link_source})}});var n=Object.keys(r).map(function(t){return r[t]});return[i,n]}},{key:"isNewPayload",value:function(e,i){if(Array.isArray(e)&&!e.length||e.links&&!e.links.length)return!1;var r=t[i].payload;return JSON.stringify(e)===JSON.stringify(r)?(t[i].executed=!0,!1):(Object.assign(t[i],{executed:!0,payload:e,response:null,smartlinks:[]}),!0)}},{key:"postForSmartlinks",value:function(e,r){var n=this;return i.Request.post(this.linkmateEndpoint,e).then(function(e){var i=[],r=[],a=e.data.smart_links;a&&(a.forEach(function(t){"clickmate"===t.link_source?r.push(t):i.push(t)}),i.length>0&&(t[n.linkmateKey].response={bam_links:i}),r.length>0&&(t[n.clickmateKey].response={bam_links:r}))},function(e){t[r].response=e})}},{key:"postToLinkmate",value:function(){var t=this;return new i.Promise(function(e){if(!t.linkmateLinks.length&&!t.clickmateData.length)return void e(null);var r=t.buildLinkmatePayloads(),n=_slicedToArray(r,2),a=n[0],o=n[1],s=t.isNewPayload(a,t.linkmateKey),l=t.isNewPayload(o,t.clickmateKey);if(!s&&!l)return void e(null);var u=[];return s&&u.push(t.postForSmartlinks(a,t.linkmateKey)),l&&o.forEach(function(e){u.push(t.postForSmartlinks(e,t.clickmateKey))}),i.Promise.all(u).then(function(){(s||l)&&t.cacheLinkmateResp(),e()})})}},{key:"cacheLinkmateResp",value:function(){[this.linkmateKey,this.clickmateKey].forEach(function(e){if(t[e].response){var i=t[e].smartlinks,r=[].concat(_toConsumableArray(new Set(i.map(function(t){return t.url}))));t[e].response.bam_links.forEach(function(t){r.includes(t.url)||i.push(t)}),t[e].smartlinks=i}})}},{key:"rewriteLinks",value:function(e){var r=this;return new i.Promise(function(i){if(!t[e].smartlinks.length)return void i(null);var n=r.getRewriteData(e);r.rewriteEncodedLinks(n),i()})}},{key:"getRewriteData",value:function(e){var i={};return t[e].smartlinks.forEach(function(t){i[t.url]="https://shop-links.co/"+t.auction_id}),i}},{key:"rewriteEncodedLinks",value:function(t){var i=this,r=this.getOriginalLinks(t),n=Object.keys(r);Array.from(e.querySelectorAll(this.getLinkmateSelector())).forEach(function(t){var e=i.getLinkmateLink(t);(e.includes(i.clickmateLinkPattern)||e.includes(i.howlClickmateLinkPattern))&&(e=new URL(t.href).searchParams.get("url")),n.indexOf(e)>-1?i.updateSmartlinkElement(t,r[e]):e&&"?"===e.charAt(e.length-1)&&n.indexOf(e.substring(0,e.length-1))>-1&&i.updateSmartlinkElement(t,r[e.substring(0,e.length-1)])})}},{key:"getOriginalLinks",value:function(t){return t}},{key:"updateSmartlinkElement",value:function(t,e){var i=new URL(t.href).searchParams.get("u1");i&&(e=e+"/?u1="+i),this.originalURLs[e]=t.href,t.setAttribute("href",e),t.setAttribute("rel","nofollow noskim"),t.setAttribute("linkmate","true")}},{key:"reportClick",value:function(t){var r=this;this.getEventPayload().then(function(n){n.events.push({page_title:e.title,target_url:t}),i.Request.post(r.clickReportingEndpoint,n)})}},{key:"isValidDomain",value:function(t){var e=!1;if(null!=this.config.url){var i=this.config.url.replace(/^https?:\/\/(www.)?/,"");this.validDomains.push(i)}for(var r=0;r<this.validDomains.length;r++){var n="";n="*"===this.validDomains[r].charAt(0)?"."+this.validDomains[r]:this.validDomains[r];if(new RegExp("^https?:\\/\\/(www.)?"+n).test(t)){e=!0;break}}return e}},{key:"linkmateEnabled",value:function(){return!t.NRTV_EVENT_DATA.donotlink&&(void 0!==t.NRTV_EVENT_DATA.linkmate?t.NRTV_EVENT_DATA.linkmate:this.config.widget_options.linkmate)}},{key:"externalClickReporterEnabled",value:function(){var e=t.NRTV_EVENT_DATA.recordExternalClicks,i=this.config.widget_options.record_external_clicks;return!1!==i&&!(!e&&!i)}},{key:"executeLinkmate",value:function(){var e=this;Object.assign(t.NRTV_LINKMATE_DATA,this.defaultLinkmateData),this.scanForUrls().then(function(){return e.scanForClickmate()}).then(function(){return e.postToLinkmate()}).then(function(){e.rewriteLinks(e.linkmateKey),e.rewriteLinks(e.clickmateKey)}).then(function(){e.loadAndRunAllBamLinks(),t.NRTV_LINKMATE_DATA.linkMapping=e.originalURLs})}},{key:"onDomMutation",value:function(){this.linkmateEnabled()||(this.loadAndRunAllBamLinks(),this.runAllClickmateLinks()),this.pageChanged()&&(i.core.initPageSession(),i.core.initUserSession(),this.resetPageImpression(),this.executeLinkmate())}},{key:"checkForAddedLinks",value:function(t,e){for(var i=0;i<t.length;i++){var r=t[i];if("childList"===r.type&&r.addedNodes.length)for(var n=r.addedNodes,a=0;a<n.length;a++){var o=n[a];if(null!=o.className&&o.className.includes("gallery-module"))return void this.executeLinkmate()}}}},{key:"setupObservers",value:function(){var t=this;if(this.dynamicDiv)for(var i=[].concat(_toConsumableArray(e.querySelectorAll(this.dynamicDiv))),r={childList:!0,subtree:!0},n={},a=0;a<i.length;a++){var o=i[a];if(!n[o.parentNode]){var s=new MutationObserver(function(e,i){return t.checkForAddedLinks(e,i)});s.observe(o.parentNode,r),n[o.parentNode]=!0}}}},{key:"run",value:function(){if(this.isValidDomain(t.location.href))return _get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"run",this).call(this),this.linkmateEnabled()?this.executeLinkmate():(this.loadAndRunAllBamLinks(),this.runAllClickmateLinks()),i.lib.setGlobal("LOADED","PUBLISHER_JSTAG"),this}}]),n}(i.PublisherWidget);i.PublisherJsTag=r,i.lib.setClass("PublisherJsTag",i.PublisherJsTag)}(window,document,CONTAINED_BAMX_OBJ),function(t,e,i){var r=function(r){function n(t,e,r){_classCallCheck(this,n);var a=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return a.config=t||a.constructor.config,e=e||i.DataLayer,a.dataLayer=new e,a.components=new Map,r&&(r=i.lib.getClass(r),a.componentConfig=new r),a.localStorageCheckoutKey="bamx_trigger_checkout",a.localStorageClickIdKey="nrtv_cids",a.elementSelector="body",a.currentPageClickId=null,a.previousPageClickId=null,a.isLanding=!1,a}return _inherits(n,r),_createClass(n,[{key:"getOrganizationId",value:function(){return this.config.merch_id}},{key:"getElement",value:function(){return e.querySelector(this.elementSelector)}},{key:"getCurrentUrl",value:function(){return t.location.href}},{key:"getCheckoutsFired",value:function(){try{return JSON.parse(i.lib.localStorage.getItem(this.localStorageCheckoutKey))||{}}catch(t){return{}}}},{key:"setCheckoutsFired",value:function(t){var e=this.getCheckoutsFired();e[t]=!0,i.lib.localStorage.setItem(this.localStorageCheckoutKey,JSON.stringify(e))}},{key:"parseClickIdFromUrl",value:function(t){var e=t.split("nrtv_cid=");return e.length>1&&e[1]&&e[1].length>=64?this.validateCid(e[1].substring(0,64)):null}},{key:"validateCid",value:function(t){var e=/^[a-zA-Z0-9]*$/;return t&&e.test(t.substring(0,64))?t.substring(0,64):null}},{key:"getClickIdFromURL",value:function(){var t=this.getClickIdFromCurrentUrl(),e=!1;if(t?this.currentPageClickId=t:(t=this.getClickIdFromPreviousUrl(),e=!!t),t&&".nrtv_plchldr."!==t)if(this.getClickIdsFromLocalStorage()){var r=this.getClickIdsFromLocalStorage();r.includes(t)||(r.push(t),e&&(this.previousPageClickId=t)),r.length>1e4&&r.splice(0,1),this.setClickIds(r)}else i.lib.localStorage.setItem(this.localStorageClickIdKey,t)}},{key:"getClickIdsFromLocalStorage",value:function(){try{return i.lib.localStorage.getItem(this.localStorageClickIdKey).split(",")}catch(t){return null}}},{key:"setClickIds",value:function(t){i.lib.localStorage.setItem(this.localStorageClickIdKey,t.join(","))}},{key:"getClickIdFromCurrentUrl",value:function(){var e=new URL(t.location.href);return this.validateCid(e.searchParams.get("nrtv_cid"))||this.parseClickIdFromUrl(decodeURIComponent(t.location.href))}},{key:"getClickIdFromPreviousUrl",value:function(){var t=void 0,e=i.lib.getReferer();if(e){var r=new URL(e);t=this.validateCid(r.searchParams.get("nrtv_cid"))||this.parseClickIdFromUrl(decodeURIComponent(e))}return t}},{key:"checkLandingReferrer",value:function(){var t=i.lib.getReferer();t&&(this.isLanding=t.includes("narrativ.com"))}},{key:"triggerEvent",value:function(t,e,r){var n=this,a=!1,o=null;this.currentPageClickId?o=this.currentPageClickId:this.previousPageClickId&&(o=this.previousPageClickId,a=!0);var s=!(!o&&!this.isLanding);if(!o){var l=this.getClickIdsFromLocalStorage();l&&l.length>0&&(o=l[l.length-1])}var u=this.getOrganizationId(),c=this.getOrganizationType();return this.getEventPayload(t,e).then(function(l){return"page_impression"===e&&o&&(l.user.cids=o,l.user.is_landing=s,a&&(l.user.cid_from_referrer=a)),l.events.push(r),"page_impression"===e&&s&&n.sendImpressionsToInngest(l,u),i.core.triggerEvent(t,e,l,c,u)})}},{key:"sendImpressionsToInngest",value:function(e,r){var n=Object.assign({},e);return n.branch="test"===i.ENV?"preview":"main",n.merchant_id=r,n.uidBam=t.BAMX.UID_BAM,fetch("https://inngest.narrativ.com/e/GtiBJxrO2V2MLP2mlTYk6e9ltTKshf_oDCvm7MwSjksbaToHlbBGSw7El1js7UUITicQ_3FC7oTuco7YTF1TdQ",{method:"POST",body:JSON.stringify({data:n})})}},{key:"getIpOrFingerprint",value:function(){return Promise.any([new Promise(function(t,e){return fetch("https://howl-partners.vercel.app/api/fp").then(function(t){return t.json()}).then(function(i){i&&i.fp?t({ip:"",fp:i.fp}):e("api/fp not found")}).catch(function(t){return e(t)})}),new Promise(function(t,e){return fetch("https://events.release.narrativ.com/ip").then(function(t){return t.json()}).then(function(i){i&&i.ip?t({ip:i.ip,fp:""}):e("events.release.narrativ not found")}).catch(function(t){return e(t)})}),new Promise(function(t,e){return fetch("https://api.ipify.org/?format=json").then(function(t){return t.json()}).then(function(i){i&&i.ip?t({ip:i.ip,fp:""}):e("ipify not found")}).catch(function(t){return e(t)})})])}},{key:"sendToNext",value:function(t,e){var r=e;r.branch="test"===i.ENV?"preview":"main";try{Promise.allSettled([this.nextToInngest(t,r)])}catch(t){console.error("sendToNext error",t)}}},{key:"nextToInngest",value:function(t,e){var i=this;return new Promise(function(r,n){i.getIpOrFingerprint().then(function(i){return i&&i.ip&&(e.ip=i.ip),i&&i.fp&&(e.fp=i.fp),fetch("https://inngest.narrativ.com/e/W4FRV_AXbn34mZO01ZIAFrr6A24BjEGVPBO2x-gTnTio23BIQ9jDyaWYQC5Jg-BDTkVSN7zxykgu3yjuMr3z2g",{method:"POST",body:JSON.stringify({id:"checkout.created-"+t,data:e})})}).then(function(t){return t.json()}).then(function(t){r(t)}).catch(function(t){console.error("hfp error",t),console.error("inn.gs error",t),n(t)})})}},{key:"triggerCheckoutEvent",value:function(){var t=this,e=this.getOrganizationId()+"-"+this.dataLayer.getOrderId();if(this.getCheckoutsFired()[e])return void console.warn("Suppressing duplicate checkout event for key: "+e);var i=this.dataLayer.getCheckoutEventData();return this.triggerInteractionEvent("checkout",i).then(function(){var r={merchant_id:t.getOrganizationId(),checkoutData:i};t.sendToNext(e,r),t.setCheckoutsFired(e)})}},{key:"onWidgetLoad",value:function(){this.addListeners(),this.addElementViewer(),this.checkLandingReferrer(),this.getClickIdFromURL(),this.triggerPageImpression(),this.LOADED=!0,this.location=this.getCurrentUrl()}},{key:"onDomLoad",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"onDomLoad",this).call(this),t.BAMX_EVENT_DATA||(t.BAMX_EVENT_DATA={}),this.dataLayer.shouldTriggerCheckout()&&this.triggerCheckoutEvent(),this.checkForComponents()}},{key:"onDomMutation",value:function(){this.checkForComponents()}},{key:"instantiateComponents",value:function(t){var i=this;Object.keys(t).map(function(r){var n=t[r];Array.from(e.querySelectorAll(r)).map(function(t){if(!i.components.get(t)){var e=new n(t,i.getOrganizationId(),i.dataLayer);i.components.set(t,e.run())}})})}},{key:"checkForComponents",value:function(){if(this.componentConfig)for(var t=["add_to_cart","add_to_favorite","newsletter_signup"],e=0;e<t.length;e++)this.componentConfig[t[e]]&&this.instantiateComponents(this.componentConfig[t[e]])}},{key:"run",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"run",this).call(this),i.lib.setGlobal("LOADED","MERCHANT_JSTAG")}}]),n}(i.MerchantWidget);i.MerchantJsTag=r,i.lib.setClass("MerchantJsTag",i.MerchantJsTag)}(window,document,CONTAINED_BAMX_OBJ),function(t,e){t.BAMX_EVENT_DATA=t.BAMX_EVENT_DATA||{};var i=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"optional",value:function(t){return t||null}},{key:"parseQuantity",value:function(t){return parseInt(t,10)||1}},{key:"parsePrice",value:function(t){var e=(""+t).replace(/\$|,/g,""),i=parseFloat(e);return isNaN(i)?"0.00":i.toFixed(2)}},{key:"parseCentsToPrice",value:function(t){var e=(""+t).replace(/,/g,"");return this.parsePrice(e/100)}},{key:"formatField",value:function(t,e){return t?(t.length>e&&(t=t.substring(0,e)),t):null}},{key:"getOrderId",value:function(){return t.BAMX_EVENT_DATA.order_id}},{key:"getOrderValue",value:function(){return this.parsePrice(t.BAMX_EVENT_DATA.order_value)}},{key:"getCurrency",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"USD";return t.BAMX_EVENT_DATA.currency&&(t.BAMX_EVENT_DATA.currency=t.BAMX_EVENT_DATA.currency.toUpperCase().replace(/[()#_]/g,""),"US"===t.BAMX_EVENT_DATA.currency&&(t.BAMX_EVENT_DATA.currency="USD")),t.BAMX_EVENT_DATA.currency||e}},{key:"getProductData",value:function(){var e=t.BAMX_EVENT_DATA;return[{quantity:this.parseQuantity(this.formatField(e.product_quantity,1e4)),price:this.parsePrice(e.product_price),currency:this.getCurrency(),id:this.formatField(e.product_id?e.product_id.toString():null,100),name:this.formatField(this.optional(e.product_name),255),brand:this.formatField(this.optional(e.product_brand),255),image_url:this.formatField(this.optional(e.product_image),2048),size:this.formatField(this.optional(e.product_size),20),color:this.formatField(this.optional(e.product_color),20)}]}},{key:"getPurchasedProduct",value:function(i){var r=t.BAMX_EVENT_DATA.products_purchased;return Array.isArray(r)||(r=e.lib.safe(JSON.parse,r)),Array.isArray(r)?r[i]:{}}},{key:"getPurchasedProductData",value:function(t){var e=this.getPurchasedProduct(t);return{quantity:this.parseQuantity(this.formatField(e.product_quantity,1e4)),price:this.parsePrice(e.product_price),currency:this.formatField(this.getCurrency(),3),id:this.formatField(e.product_id?e.product_id.toString():null,100),name:this.formatField(this.optional(e.product_name),255),brand:this.formatField(this.optional(e.product_brand),100),image_url:this.formatField(this.optional(e.product_image),2048),size:this.formatField(this.optional(e.product_size),20),color:this.formatField(this.optional(e.product_color),20)}}},{key:"getPurchasedProducts",value:function(){var i=this,r=t.BAMX_EVENT_DATA.products_purchased;return Array.isArray(r)||(r=e.lib.safe(JSON.parse,r)),r=Array.isArray(r)?r:[],r.map(function(t,e){return i.getPurchasedProductData(e)})}},{key:"getCheckoutEventData",value:function(){return{order:{id:this.formatField(this.getOrderId()?this.getOrderId().toString():this.getOrderId(),50),value:this.getOrderValue(),currency:this.formatField(this.getCurrency(),3),cids:this.formatField(e.lib.getClickIds(),4096)},products:this.getPurchasedProducts()}}},{key:"shouldTriggerCheckout",value:function(){return!(!this.getOrderId()||!this.getOrderValue())}}]),i}();e.DataLayer=i}(window,CONTAINED_BAMX_OBJ),function(t,e){t.BAMX_EVENT_DATA=t.BAMX_EVENT_DATA||{};var i=function(){function i(){_classCallCheck(this,i),this.type="utag",this.orderValueKey="order_total"}return _createClass(i,[{key:"optional",value:function(t){return t||null}},{key:"parsePrice",value:function(t){var e=(""+t).replace(/\$|,/g,""),i=parseFloat(e);return isNaN(i)?"0.00":i.toFixed(2)}},{key:"parseQuantity",value:function(t){return parseInt(t,10)||1}},{key:"formatField",value:function(t,e){return t?(t.length>e&&(t=t.substring(0,e)),t):null}},{key:"getProductQuantity",value:function(){return this.productQuantity||this.parseQuantity(t.BAMX_EVENT_DATA.product_quantity)}},{key:"getValueFromUtag",value:function(e,i){var r=t.utag_data.hasOwnProperty(e)?t.utag_data[e]:null;return void 0===i?r:r&&r[i]?r[i]:null}},{key:"getCurrency",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"USD",e=this.getValueFromUtag("order_currency_code");return e&&"US"===(e=e.toUpperCase().replace(/[()#_]/g,""))&&(e="USD"),e||t}},{key:"getOrderId",value:function(){return this.getValueFromUtag("order_id")}},{key:"getPurchasedProduct",value:function(t){return{product_id:this.getValueFromUtag("product_id",t),product_name:this.getValueFromUtag("product_name",t),product_quantity:this.getValueFromUtag("product_quantity",t),product_price:this.getValueFromUtag("product_price",t),product_brand:this.optional(this.getValueFromUtag("product_brand",t)),product_image:this.optional(this.getValueFromUtag("product_image",t)),product_size:this.optional(this.getValueFromUtag("product_size",t)),product_color:this.optional(this.getValueFromUtag("product_color",t))}}},{key:"getPurchasedProductData",value:function(t){var e=this.getPurchasedProduct(t)||{},i=e.product_id?e.product_id.toString():e.product_id;return{quantity:this.parseQuantity(this.formatField(e.product_quantity,1e4)),price:this.parsePrice(e.product_price),currency:this.formatField(this.getCurrency(),3),id:this.formatField(i,255),name:this.formatField(this.optional(e.product_name),255),brand:this.formatField(this.optional(e.product_brand),255),image_url:this.formatField(this.optional(e.product_image),2048),size:this.formatField(this.optional(e.product_size),20),color:this.formatField(this.optional(e.product_color),20)}}},{key:"getPurchasedProducts",value:function(){var e=[];if(!t.utag_data.order_merchandise_price)return e;for(var i=0;i<t.utag_data.order_merchandise_price.length;i++)e.push(this.getPurchasedProductData(i));return e}},{key:"getProductData",value:function(){return[{id:this.formatField(this.optional(this.getValueFromUtag("product_id",0)),255),name:this.formatField(this.optional(this.getValueFromUtag("product_name",0)),255),brand:this.formatField(this.optional(this.getValueFromUtag("product_brand",0)),255),image_url:this.formatField(this.optional(this.getValueFromUtag("product_image",0)),2048),size:this.formatField(this.optional(this.getValueFromUtag("product_size",0)),20),color:this.formatField(this.optional(this.getValueFromUtag("product_color",0)),20),quantity:this.parseQuantity(this.formatField(this.getProductQuantity(),1e4)),price:this.parsePrice(this.getValueFromUtag("product_price",0)),currency:this.getCurrency()}]}},{key:"getCheckoutEventData",value:function(){return{order:{id:this.formatField(this.getValueFromUtag("order_id")?this.getValueFromUtag("order_id").toString():this.getValueFromUtag("order_id"),50),value:this.parsePrice(this.getValueFromUtag(this.orderValueKey)),currency:this.formatField(this.getCurrency(),3),cids:this.formatField(e.lib.getClickIds(),4096)},products:this.getPurchasedProducts()}}},{key:"shouldTriggerCheckout",value:function(){return!(!this.getValueFromUtag("order_id")||!this.getValueFromUtag(this.orderValueKey))}}]),i}();e.UtagDataLayer=i}(window,CONTAINED_BAMX_OBJ),function(t,e){e.AddToCartBtn=function(t){function i(t,r,n){_classCallCheck(this,i);var a=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,r))
;return a.dataLayer=n||new e.DataLayer,a}return _inherits(i,t),_createClass(i,[{key:"getProductData",value:function(){return{products:this.dataLayer.getProductData()}}},{key:"addListeners",value:function(){this.addListener(this.getElement(),"click",this.onClick.bind(this))}},{key:"triggerAddToCartEvent",value:function(){var t=this.getProductData();t.products&&0===t.products.length||this.triggerInteractionEvent("add_to_cart",t)}},{key:"onClick",value:function(){this.triggerAddToCartEvent()}},{key:"onWidgetLoad",value:function(){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"onWidgetLoad",this).call(this)}}]),i}(e.MerchantWidget)}(window,CONTAINED_BAMX_OBJ),function(t,e){e.AddToFavoriteBtn=function(t){function i(t,r,n){_classCallCheck(this,i);var a=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,r));return a.dataLayer=n||new e.DataLayer,a}return _inherits(i,t),_createClass(i,[{key:"addListeners",value:function(){this.addListener(this.getElement(),"click",this.onClick.bind(this))}},{key:"getProductData",value:function(){var t=this.dataLayer.getProductData();return delete t[0].quantity,{products:t}}},{key:"onClick",value:function(){this.triggerAddToFavoriteEvent()}},{key:"triggerAddToFavoriteEvent",value:function(){var t=this.getProductData();t.products&&0===t.products.length||this.triggerInteractionEvent("add_to_favorite",t)}}]),i}(e.MerchantWidget)}(window,CONTAINED_BAMX_OBJ),function(t,e){e.NewsletterSignup=function(t){function i(t,r,n){_classCallCheck(this,i);var a=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,r));return a.dataLayer=n||new e.DataLayer,a}return _inherits(i,t),_createClass(i,[{key:"getTargetEmail",value:function(){var t=this.getElement().querySelector('input[name="user[email]"]');return t&&t.value}},{key:"getEventData",value:function(){return{target_email:this.getTargetEmail()}}},{key:"addListeners",value:function(){this.addListener(this.getElement(),"click",this.onClick.bind(this)),this.addListener(this.getElement(),"submit",this.onSubmit.bind(this))}},{key:"triggerNewsletterSignupEvent",value:function(){this.triggerInteractionEvent("newsletter_signup")}},{key:"onClick",value:function(){}},{key:"onSubmit",value:function(){this.triggerNewsletterSignupEvent()}},{key:"onWidgetLoad",value:function(){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"onWidgetLoad",this).call(this)}}]),i}(e.MerchantWidget)}(window,CONTAINED_BAMX_OBJ);"use strict";!function(s,e){var a={merchant:{is_pilot:!1,merchant_type:1,merch_id:1242,widget_options:{amp:!1,linkmate:!1,enable_verbose_logging:!1},commission_rate:null,logo_url:"https://static.bam-x.com/assets/logos/merchants/samsung.1687802231.png",full_name:"Samsung",url:"https://www.samsung.com/us/",subscription_info:{sub_tier:"free",sub_end_date:1685653551,sub_amount_usd:0,sub_start_date:1685653551,sub_gmv_capacity:0,sub_payment_frequency:"quarterly"},cpc_fee_rate:null,slug:"samsung",short_name:"Samsung",deduct_returns:!1,cover_image_url:"https://static.bam-x.com/assets/cover_images/merchants/samsung.png",epp_fee_rate:null,is_feed_importer_enabled:!0,goal_take_rate:null,is_active:!0,show_in_dashboard:!0,pricing_model:"EPP",ssu_config:{ssu_title:"Earn with Samsung through Howl",ssu_subtitle:"Howl is a new marketplace designed for creators and brands who crave transparent collaboration",ssu_bullet_points:["Learn first about new releases across smartphones, laptops, tablets, appliances, TVs and more epic tech","Earn commissions on every sale","Easily track your performance and get paid with Howl"],ssu_logo_image_url:"https://static.bam-x.com/assets/ssu_logos/merchants/samsung.png",ssu_header_image_url:"https://static.bam-x.com/assets/ssu_header_images/merchants/samsung.png"},expected_import_frequency:36,fee_model:null},publisher:{is_pilot:!1,widget_options:{amp:!1,domains:[],linkmate:!1,jstag_disabled:!1,enable_external_script:!1,enable_verbose_logging:!1,record_external_clicks:!1},billing_platform:1,tier_type:20,referral_type:null,logo_url:null,acquisition_type:2,reserve_cpc:"0.01",full_name:"Samsung",url:"https://twitter.com/walidadell?t=CJt-4VgysfMIEXyXw4e-pg&s=09",publisher_type:2,pub_id:4260,slug:"samsung",short_name:"Samsung",onboarding_status:5,instant_pay_access:1,referral_code:null,show_in_dashboard:!0},slug:"samsung"};new(e.lib.getClass("JsTagLib"))(a).run()}(window,CONTAINED_BAMX_OBJ);

		if (window._bamDefine) {
			window.define = window._bamDefine;
		}

		window.BAMX.VERSION = window.BAMX.VERSION || {};
		window.BAMX.VERSION['7062f75303a127fa71d674a3a89dbf00d0e0dd4e'] = CONTAINED_BAMX_OBJ;
		window.BAMX.GITHASH = '7062f75303a127fa71d674a3a89dbf00d0e0dd4e';
		window.BAMX.get = function() {
			return window.BAMX.VERSION[window.BAMX.GITHASH];
		};
	} catch (e) {
		try {
			if (CONTAINED_BAMX_OBJ.DEBUG) {
				console.error(e);
			}

		} catch (e2) {}
	}

})(window);
