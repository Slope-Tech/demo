!function(){"use strict";let c=null;const u=["debug","info","warn","error"];let a=u.reduce((e,d,a)=>(e[d]=function(){var e="debug"===d?"log":d;if(c&&console&&"function"==typeof console[e]){var t=u.indexOf(c.toString().toLocaleLowerCase());if(!0===c||-1<t&&t<=a){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];const[a,...r]=[...i];console[e](d.toUpperCase()+" - (TTD) "+a,...r)}}},e),{});function e(e){c=e}let o=null,n=null,r=[],d=[];function t(e){var t=e[0],e=e[1];if("setIdentifier"!==t)throw"method not implemented";f(e)}function l(){i();{let n=o.detectionEventType,e=(r=m(o.triggerElements),m(o.cssSelectors)),i=[];for(var t of e)t&&t.tagName&&"INPUT"===t.tagName&&i.push(t);a.debug("triggers ",r),a.debug("validInputs ",e),d=[],r.forEach(e=>{d.push(e[n])});for(let t=0;t<r.length;t++)r[t][n]=function(){a.debug("Detect event: ",n,"on element, ",r[t]);for(var e of i){e=e.value.trim();if(function(e){var t=/((([^<>()\[\].,;:\s@"]+(\.[^<>()\[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,}))/i;if(o.detectionSubject.includes("email")&&t.test(e))return e=e.match(t)[0].toLowerCase().trim(),a.debug("We detected email: "+e),p(e,"email"),1;return}(e)){a.debug("We detected: ",e),s();break}}d[t]&&d[t](...arguments)}}}function s(){a.debug("Detection stopped."),o.detectDynamicNodes&&(a.debug("Checking for dynamically added elements is turned off."),n)&&(n.disconnect(),n=null),i()}function i(){for(let e=0;e<r.length;e++)r[e][o.detectionEventType]=d[e];r=[],d=[]}function f(e){e&&e.type&&e.identifier?"email"!==e.type?a.error("Identifier type is not supported, ",detailsdetails.type):(p(e.identifier,e.type),s()):a.error("wrong identifier format")}function p(e,t){var n;e&&t&&(n=new CustomEvent("detected-identifier",{detail:{identifier:e,type:t}}),a.info("Dispatched event with identifier: ",e," and type: ",t),window.dispatchEvent(n))}function m(t){let n=[];for(var e of t)0<e.length&&document.querySelectorAll(e).forEach(e=>{n.includes(e)||n.push(e)});var i=window.location.hostname,o=document.getElementsByTagName("iframe");for(let e=0;e<o.length;e++){var r=o[e];if(function(e,t){if(t.src)try{var n=e===new URL(t.src).hostname;return n&&a.debug("Iframe "+t.src+" can be accessed"),n}catch(e){a.debug("error: ",e)}}(i,r)&&(r.removeEventListener("load",l),r.addEventListener("load",l),r.contentDocument))for(var d of t)0<d.length&&r.contentDocument.querySelectorAll(d).forEach(e=>{n.includes(e)||n.push(e)})}return n}window.ttdPixel={},window.ttdPixel.startDetection=function(e){o=e,a.info("Detection started! Library is configured to detect: ",o.detectionSubject),a.info("Detection event type is ",o.detectionEventType),a.debug("Full config: ",o),"onsubmit"===o.detectionEventType||"onclick"===o.detectionEventType?(l(),o.detectDynamicNodes&&o.detectDynamicNodes&&new MutationObserver(function(e,t){a.debug("Detected dynamically added nodes."),n=t,l()}).observe(document.querySelector("body"),{childList:!0,subtree:!0})):a.debug("Detection type not supported! We will not start auto detection."),window.ttdPixelEventsLayer=window.ttdPixelEventsLayer||[],window.ttdPixelEventsLayer.forEach(t),window.ttdPixelEventsLayer.push=function(e){return Array.prototype.push.call(window.ttdPixelEventsLayer,e),t(e),this.length}},window.ttdPixel.setIdentifier=f,window.ttdPixel.enableDebug=()=>e("debug"),window.ttdPixel.disableLog=()=>e(null)}();var ttd_dom_ready=function(){var t,n,i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},l={isReady:!1,readyWait:1,holdReady:function(e){e?l.readyWait++:l.ready(!0)},ready:function(e){if(!0===e&&!--l.readyWait||!0!==e&&!l.isReady){if(!document.body)return setTimeout(l.ready,1);(l.isReady=!0)!==e&&0<--l.readyWait||t.resolveWith(document,[l])}},bindReady:function(){if(!t){if(t=l._Deferred(),"complete"===document.readyState)return setTimeout(l.ready,1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",l.ready,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",n),window.attachEvent("onload",l.ready);var e=!1;try{e=null==window.frameElement}catch(e){}document.documentElement.doScroll&&e&&o()}}},_Deferred:function(){var d,n,a,c=[],u={done:function(){if(!a){var e,t,n,i,o,r=arguments;for(d&&(o=d,d=0),e=0,t=r.length;e<t;e++)"array"===(i=l.type(n=r[e]))?u.done.apply(u,n):"function"===i&&c.push(n);o&&u.resolveWith(o[0],o[1])}return this},resolveWith:function(e,t){if(!a&&!d&&!n){t=t||[],n=1;try{for(;c[0];)c.shift().apply(e,t)}finally{d=[e,t],n=0}}return this},resolve:function(){return u.resolveWith(this,arguments),this},isResolved:function(){return!(!n&&!d)},cancel:function(){return a=1,c=[],this}};return u},type:function(e){return null==e?String(e):i[Object.prototype.toString.call(e)]||"object"}};function o(){if(!l.isReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(o,1)}l.ready()}}return document.addEventListener?n=function(){document.removeEventListener("DOMContentLoaded",n,!1),l.ready()}:document.attachEvent&&(n=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",n),l.ready())}),function(e){l.bindReady(),l.type(e),t.done(e)}}();function TTDUniversalPixelApi(B){this.getVersion=function(){return"1.1.0"},this.setupUid2Sdk=function(e,t){var n;void 0===window.__uid2?((n=document.createElement("script")).setAttribute("defer",!0),n.setAttribute("src","https://cdn.prod.uidapi.com/uid2-sdk-3.2.0.js"),n.addEventListener("load",()=>{e()}),n.addEventListener("error",e=>{t()}),document.body.appendChild(n)):e()},this.init=function(e,t,o,r,d){if("string"==typeof arguments[3]&&(arguments[3]=null,4<arguments.length))for(var a=4;a<arguments.length;a++)arguments[a-1]=arguments[a];if(e&&""!=e&&t&&!(t.length<=0)){var c=document.getElementsByTagName("body")[0];if(c){var u="",l={MonetaryValue:"v",MonetaryValueFormat:"vf"},s=[];if("undefined"!=typeof _pixelParams)for(var a in _pixelParams){var f=_pixelParams[a],p=l[a];p&&f&&!/%%.*%%/i.test(f)&&s.push(p+"="+encodeURIComponent(f))}var m="adv="+e,g="upid="+t.join(","),v=B||function(){var e=window,t="",n=!1;try{top.location.href&&(t=top.location.href)}catch(e){n=!0}if(n)for(;;)try{if(t=e.document.referrer,window.parent==e)break;e=window.parent}catch(e){break}-1<t.indexOf("cloudfront.net")&&(t=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}(t,"url")||t);return t}(),u=o+"?"+m+"&ref="+encodeURIComponent(v)+"&"+g+"&upv="+this.getVersion();if(r)for(var y in r)u=u+"&"+y+"="+r[y];0<s.length&&(u=u+"&"+s.join("&"));let n;const W=new Promise((e,t)=>{n=e});var w=null,h=!1,b=null;"function"==typeof __tcfapi?(D=setTimeout(N,1e3),__tcfapi("addEventListener",2,O)):"function"==typeof __cmp?(w=setTimeout(j,1e3),__cmp("ping",null,I)):"function"==typeof __gpp?void 0!==(m=T()).gppString?R(m.gppString,m.gppSid):(_=setTimeout(P,1e3),__gpp("addEventListener",x)):k();let i=void 0!==d?!0:!1;i&&this.setupUid2Sdk(()=>S(d),()=>{console.warn("UID2 enabled but failed to register hooks.")}),window.addEventListener("message",e=>{var t=new URL(e.origin);if(t.hostname.endsWith(".adsrvr.org")&&!i&&"string"==typeof e.data){const n=JSON.parse(e.data);this.setupUid2Sdk(()=>S(n),()=>{console.warn("UID2 enabled but failed to register hooks.")})}});var _=null,E=!1,D=null,L=!1;function S(i){let o=new Promise(t=>{window.addEventListener("detected-identifier",function(e){t(e.detail.identifier)}),window.ttdPixel.startDetection(i)});window.__uid2=window.__uid2||{},window.__uid2.callbacks=window.__uid2.callbacks||[],window.__uid2.callbacks.push(async(e,t)=>{switch(e){case"SdkLoaded":__uid2.init({baseUrl:i.baseUrl});break;case"InitCompleted":var n;t.identity?await A(t.identity.advertising_token):(n=await o,await __uid2.setIdentityFromEmail(n,i));break;case"IdentityUpdated":await A(t.identity.advertising_token)}})}function T(){var e,t=__gpp("getGPPData"),t={gppString:t?.gppString,gppSid:t?.applicableSections?.join(",")};return void 0===t.gppString&&(e=__gpp("ping"),t.gppString=e?.gppString,t.gppSid=e?.applicableSections?.join(",")),t}function x(e,t){var n;E?__gpp("removeEventListener",function(){},e.listenerId):"signalStatus"===e.eventName&&"ready"===e.data&&(n=T(),clearTimeout(_),b=new Date,R(n.gppString,n.gppSid),__gpp("removeEventListener",function(){},e.listenerId))}function P(){E=!0,k()}function j(){h=!0,k()}function I(e){h||(e.cmpLoaded||e.gdprAppliesGlobally?(clearTimeout(w),b=new Date,__cmp("getConsentData",null,k)):setTimeout(function(){__cmp("ping",null,I)},200))}function k(e){null!=b&&(u=u+"&ret="+(new Date-b)),h&&(u+="&pto=1"),null!=e&&(u=u+"&gdpr="+(e.gdprApplies?"1":"0")+"&gdpr_consent="+e.consentData),U()}function U(){var e="universal_pixel_"+t.join("_");n(u),C(u,e,"TTD Universal Pixel")}async function A(e){C(await W+"&uiddt="+e,"universal_pixel_"+t.join("_")+"_uid","TTD Universal Pixel with UID")}function C(e,t,n){let i=document.getElementById(t);for(;i&&i.parentElement.removeChild(i),i=document.getElementById(t););let o=document.createElement("iframe");function r(){c.appendChild(o)}o.setAttribute("id",t),o.setAttribute("height",0),o.setAttribute("width",0),o.setAttribute("style","display:none;"),o.setAttribute("src",e),o.setAttribute("title",n),"complete"===document.readyState?setTimeout(r,0):window.addEventListener?window.addEventListener("load",r):window.attachEvent?window.attachEvent("onload",r):r()}function N(){L=!0,k()}function O(e,t){L?__tcfapi("removeEventListener",2,function(e){},e.listenerId):t&&(clearTimeout(D),t=e,null!=b&&(u=u+"&ret="+(new Date-b)),L&&(u+="&pto=1"),null!=t&&(u=u+"&gdpr="+function(e){return e?"1":"0"}(t.gdprApplies)+"&gdpr_consent="+t.tcString),U(),b=new Date,__tcfapi("removeEventListener",2,function(e){},e.listenerId))}function R(e,t){null!=b&&(u=u+"&ret="+(new Date-b)),null!=e&&(u=u+"&gpp_consent="+e),null!=t&&(u=u+"&gpp_sid="+t),U()}}}}}
