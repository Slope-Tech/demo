window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.taglets.lightbox=function(){function a(){var a={css:j},b=lpTag.taglets.lpJsonToDom.convert({containers:a})[0];return b.className=b.className+" LPMlightbox",lpTag.taglets.utils.appendToPage(b),b.id}function b(){var a=lpTag.taglets.utils.geObjById(i);if("undefined"!=typeof a&&null!=a)try{a.parentNode.removeChild(a)}catch(b){a.style.display="none"}}function c(){var a=lpTag.taglets.utils.geObjById(i),b={name:"opacity",targetVal:.7};lpTag.taglets.lpAnimate.animate(a,b,{easing:"easeOutQuart",duration:1e3})}function d(a){var b=lpTag.taglets.utils.geObjById(i),c={name:"opacity",targetVal:0};lpTag.taglets.lpAnimate.animate(b,c,{easing:"easeOutQuart",duration:1e3,callback:a})}function e(){i=a(),c()}function f(){d(function(){b()})}var g="1.3",h="lightbox",i="",j={backgroundColor:"#000000",backgroundImage:"",opacity:0,filter:"alpha(opacity=0)",position:"fixed",top:0,left:0,bottom:0,right:0,zIndex:107108};return{_V:g,name:h,init:function(){},show:e,remove:f}},window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},function(){function a(a,b){this.start(a,b)}function b(){function b(){this.mainContainer.innerHTML=this.activeState.html;var a,b=this.mainContainer.querySelectorAll('[data-LP-event="click"]'),c=this.mainContainer.querySelectorAll('[data-LP-event="close"]');for(a=0;a<b.length;a++)this.setEngagementClickEvent(b[a],this.offerClick,this);if(this.engData.engagementType!==m)for(a=0;a<c.length;a++)this.setCloseEvents(c[a]);this.showOffer()}function c(a){var b,c=/(?:img[^>]+src=["|'])([^["|']+)(?:["|'])/gim,e=/(?:background-image:[^)]url\()([^\)]+)(?:\))/gim,f=/^["|']|["|']$/g;b=d(c,a),Array.prototype.push.apply(b,d(e,a));for(var g=0;g<b.length;g++)b[g]=b[g].replace(f,"");return b}function d(a,b){var c,d=[];do c=a.exec(b),c&&c[1]&&c[1].length>0&&d.push(c[1]);while(null!==c);return d}function e(a,b,c){var d=a&&a.marginTop,e=a&&a.marginLeft,f={top:{top:0,bottom:"auto",marginTop:d?a.marginTop:"auto"},middle:{top:"50%",bottom:"auto",marginTop:d?a.marginTop:0},bottom:{top:"auto",bottom:0,marginTop:d?a.marginTop:"auto"},custom:{top:parseInt(b.top,10),bottom:"auto",marginTop:d?a.marginTop:"auto"}},g={left:{left:0,right:"auto",marginLeft:e?a.marginLeft:"auto"},center:{left:"50%",right:"auto",marginLeft:e?a.marginLeft:0},right:{left:"auto",right:0,marginLeft:e?a.marginLeft:"auto"},custom:{left:parseInt(b.left,10),right:"auto",marginLeft:e?a.marginLeft:"auto"}};a.position="fixed",j.extendObj(a,f[c.vertical]),j.extendObj(a,g[c.horizontal])}function f(a,b){var c=b&&b.horizontal||"",d=b&&b.vertical||"";("0px"===a.style.marginTop||"auto"===a.style.marginTop&&("right"===c&&"middle"===d||"left"===c&&"middle"===d))&&(a.style.marginTop=-parseInt(a.offsetHeight/2,10)+"px"),("0px"===a.style.marginLeft||"auto"===a.style.marginLeft&&("center"===c&&"top"===d||"center"===c&&"bottom"===d))&&(a.style.marginLeft=-parseInt(a.offsetWidth/2,10)+"px")}function g(a){if(4===lpTag.device.os()){var b=getComputedStyle(a).getPropertyValue("font-family"),c=getComputedStyle(a).left,d="bold"===a.style.fontWeight||a.style.fontWeight>500,e=a.style.transform;if(d&&e){b.indexOf("Verdana")>=0&&(a.style.left=parseInt(c,10)+8+"px"),(b.indexOf("Arial Black")>=0||b.indexOf("Impact")>=0)&&(a.style.left=parseInt(c,10)+6+"px");for(var f=["Comic Sans MS","Tahoma","Georgia","Courier New","Symbol","MS Sans Serif","Lucida Sans Unicode","Arial"],g=0;g<f.length;g++)b.indexOf(f[g])>=0&&(a.style.left=parseInt(c,10)+4+"px")}}}var h=a,i="prototype",j=lpTag.taglets.utils,k=1,l=6,m=5,n=1,o={MESSAGING:1,CHAT:0};"undefined"!=typeof lpTag.taglets.baseUIOffer&&h[i].extended!==!0&&(h[i]=lpTag.taglets.baseUIOffer.createInstance(),h[i].extended=!0,h[i].constructor=h,h[i].start=function(a,b){this.init(a,b),this.setParentContainer(),this.setConfig(b),this.run()},h[i].setParentContainer=function(){this.debugLog("in setParentContainer.."),this.parentContainer=null,-1!==this.engData.zoneId&&(lpTag.taglets.scraper?this.parentContainer=lpTag.taglets.scraper.getElmId(this.engData.zoneId)||null:this.parentContainer=document.getElementById(this.engData.zoneId))},h[i].setConfig=function(a){this.setEngagementConf(a),this.conf.useLightBox=a.effects&&a.effects.useLightBox},h[i].closeOffer=function(a){if(this.offerClose(),"keyup"===a.type){var b=document.querySelectorAll("a[href]:not([tabindex='-1']),area[href]:not([tabindex='-1']),input:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),textarea:not([disabled]):not([tabindex='-1']),button:not([disabled]):not([tabindex='-1']),iframe:not([tabindex='-1']),[tabindex]:not([tabindex='-1']),[contentEditable=true]:not([tabindex='-1'])");b.length>0&&b[0].focus()}j.stopEventBubble(a.htmlEvent)},h[i].createOffer=function(){this.debugLog("in createOffer..");var a=this.getOfferContainer();if(a&&(null!==a.parentDom||this.engData.engagementType!==m)){if(this.appendToPage(this.setupOffer,a.containerDom,a.parentDom),this.engData.engagementType!==m&&this.engData.engagementType!==l){var b=a.containerDom;document.body.prepend(b)}var c=this.engData&&this.engData.engagementId?this.engData.engagementId:"",d=this.engData.engagementType,e=a.containerDom.querySelectorAll(".LPMlabel")[0];e&&g(e);var f=a.containerDom,h=this;lpTag.lastClosedEngagementID===c&&setTimeout(function(){f&&(1===d?f.firstChild.focus():5===d&&1===h.conf.renderingType?f.firstChild.focus():f.focus()),lpTag.lastClosedEngagementID=null},200)}},h[i].setupOffer=function(a){this.containerId=a,this.mainContainer=this.getObj(this.containerId),this.conf.renderingType===n?this.buildHtmlOverlay(this.mainContainer):(this.buildJsonOverlay(this.mainContainer),this.showOffer())},h[i].getOfferContainer=function(){this.debugLog("in getOfferContainer..");var a={},b=this.getContainerDom();return"undefined"==typeof b?(this.errorLog("Error creating offer container"),a=null):(a.parentDom=this.parentContainer?document.getElementById(this.parentContainer):null,a.containerDom=b),a},h[i].getContainerDom=function(){var a={css:this.getContainerCss()};return a.engagementType="LPM"+this.getEngagementTypeName(this.conf.type),a.isClickable=!0,this.convertJsonToDom({containers:a})[0]},h[i].getContainerCss=function(){this.debugLog("in getContainerConf..");var a=this.extractCssProps(this.activeState,["background","border","margin"]);return a.display="none",a&&a.marginTop||a&&a.marginBottom||a&&a.marginLeft||a&&a.marginRight||(a.margin="1px"),null!==this.parentContainer?(a.position="relative",a.top=0,a.left=0):(a.zIndex=this.conf.zIndex,e(a,this.conf.position,this.location)),a},h[i].buildHtmlOverlay=function(){this.debugLog("in buildCustomOffer.."),this.preloadImages(c(this.activeState.html),b,this.onError)},h[i].addA11yAttr=function(){var a=this.mainContainer.querySelector('[role="button"]');if(a)for(var b=a.querySelectorAll(".LPMlabel"),c=1,d=0;d<b.length;d++)b[d].setAttribute("role","heading"),b[d].setAttribute("aria-level",c++)},h[i].enhanceOverlayAccesibility=function(a,b){var c=a;if(b&&b.labels&&b.labels.length){var d=b.labels[0].text;c.setAttribute("aria-label",d),this.isOfferNonConversational()&&(c.setAttribute("role","dialog"),c.setAttribute("aria-modal","true"))}},h[i].captureTabFocusOnBlurEvent=function(a){var b=this.mainContainer.querySelectorAll("a[href]:not([tabindex='-1']),area[href]:not([tabindex='-1']),input:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),textarea:not([disabled]):not([tabindex='-1']),button:not([disabled]):not([tabindex='-1']),iframe:not([tabindex='-1']),[tabindex]:not([tabindex='-1']),[contentEditable=true]:not([tabindex='-1'])");if(null!=a){var c=!1,d=a.relatedTarget;null==d&&(c=!0),null!=d&&null==d.parentNode&&(c=!0);var e=!0;if(null!=d&&null!=d.parentNode)for(;null!==d;)d==this.mainContainer&&(e=!1),d=d.parentNode;e&&(c=!0),e&&(b[b.length-1]==a.target?b[0].focus():b[b.length-1].focus())}},h[i].addA11y=function(){var a=this.mainContainer.querySelector(".LPMcloseButton");a&&(a.setAttribute("aria-label",a.alt),a.setAttribute("tabindex","1"))},h[i].buildJsonOverlay=function(){this.debugLog("in attachEvents.."),this.conf&&this.conf.accessible&&this.mainContainer?(this.createAccessibleContainer(this.mainContainer),this.addElements(this.mainContainer.firstChild,this.activeState.elements),this.repositionCloseBtn(this.mainContainer),this.setEngagementClickEvent(this.mainContainer.firstChild,this.offerClick,this)):(this.addElements(this.mainContainer,this.activeState.elements),this.setEngagementClickEvent(this.mainContainer,this.offerClick,this)),this.enhanceOverlayAccesibility(this.mainContainer,this.activeState.elements)},h[i].showOffer=function(){if(this.debugLog("in showOffer.."),this.conf.useLightBox&&(this.lightbox=new lpTag.taglets.lightbox,this.lightbox.show({zIndex:this.conf.zIndex-1})),this.addA11y(),this.addA11yAttr(),this.show(),this.onImpression(),this.setTimeout(this.offerTimeout),this.isOfferNonConversational()){var a=this.mainContainer.querySelector('[role="button"]');null!=a&&a.focus()}null===this.parentContainer&&f(this.mainContainer,this.location)},h[i].cleanupOffer=function(a){this.debugLog("in cleanupOffer.."),j.clearTimeout(this.offerTimeoutId),this.conf.useLightBox&&this.lightbox.remove(),this.remove(a)},h[i].offerClick=function(){this.click(),this.engData.engagementType===k&&this.cleanupOffer()},h[i].offerClose=function(a){a=a||{},a.silent||this.onClose(this.offerId),this.cleanupOffer(a)},h[i].offerTimeout=function(){this.onTimeout(this.offerId),this.cleanupOffer()},h[i].isOfferNonConversational=function(){var a=this.engData&&this.engData.hasOwnProperty("conversationType"),b=a&&this.engData.conversationType;return!a||b!==o.CHAT&&b!==o.MESSAGING})}lpTag.taglets.overlay=function(){function c(){}function d(c,d){return(1===d.type||1===d.renderingType)&&(d.accessible=!0),b(),new a(c,d)}var e="0.1",f="overlay";return{v:e,name:f,init:c,createInstance:d}}()}();