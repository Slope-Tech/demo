!function(t){var e;"function"==typeof define&&define.amd?define("jquery-typeahead",["jquery"],t):"object"==typeof module&&module.exports?module.exports=(void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(void 0)),t(e)):t(jQuery)}(function(j){"use strict";function r(t,e){this.rawQuery=t.val()||"",this.query=t.val()||"",this.selector=t[0].selector,this.deferred=null,this.tmpSource={},this.source={},this.dynamicGroups=[],this.hasDynamicGroups=!1,this.generatedGroupCount=0,this.groupBy="group",this.groups=[],this.searchGroups=[],this.generateGroups=[],this.requestGroups=[],this.result=[],this.tmpResult={},this.groupTemplate="",this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=e,this.node=t,this.namespace="."+this.helper.slugify.call(this,this.selector)+".typeahead",this.isContentEditable=void 0!==this.node.attr("contenteditable")&&"false"!==this.node.attr("contenteditable"),this.container=null,this.resultContainer=null,this.item=null,this.items=null,this.comparedItems=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.dropdownFilter={static:[],dynamic:[]},this.dropdownFilterAll=null,this.isDropdownEvent=!1,this.requests={},this.backdrop={},this.hint={},this.label={},this.hasDragged=!1,this.focusOnly=!1,this.displayEmptyTemplate,this.__construct()}var i,o={input:null,minLength:2,maxLength:!(window.Typeahead={version:"2.10.6"}),maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,multiselect:null,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,searchOnFocus:!1,blurOnTab:!0,blurOnItemClick:!0,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,templateValue:null,groupTemplate:null,correlativeTemplate:!1,emptyTemplate:!1,cancelButton:!0,loadingAnimation:!0,filter:!0,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onEnter:null,onLeave:null,onClickBefore:null,onClickAfter:null,onDropdownFilter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null,onCancel:null},selector:{container:"typeahead__container",result:"typeahead__result",list:"typeahead__list",group:"typeahead__group",item:"typeahead__item",empty:"typeahead__empty",display:"typeahead__display",query:"typeahead__query",filter:"typeahead__filter",filterButton:"typeahead__filter-button",dropdown:"typeahead__dropdown",dropdownItem:"typeahead__dropdown-item",labelContainer:"typeahead__label-container",label:"typeahead__label",button:"typeahead__button",backdrop:"typeahead__backdrop",hint:"typeahead__hint",cancelButton:"typeahead__cancel-button"},debug:!1},s={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"},n=~window.navigator.appVersion.indexOf("MSIE 9."),a=~window.navigator.appVersion.indexOf("MSIE 10"),l=!!~window.navigator.userAgent.indexOf("Trident")&&~window.navigator.userAgent.indexOf("rv:11");r.prototype={_validateCacheMethod:function(t){var e;if(!0===t)t="localStorage";else if("string"==typeof t&&!~["localStorage","sessionStorage"].indexOf(t))return this.options.debug&&(I.log({node:this.selector,function:"extendOptions()",message:'Invalid options.cache, possible options are "localStorage" or "sessionStorage"'}),I.print()),!1;e=void 0!==window[t];try{window[t].setItem("typeahead","typeahead"),window[t].removeItem("typeahead")}catch(t){e=!1}return e&&t||!1},extendOptions:function(){if(this.options.cache=this._validateCacheMethod(this.options.cache),this.options.compression&&("object"==typeof LZString&&this.options.cache||(this.options.debug&&(I.log({node:this.selector,function:"extendOptions()",message:"Missing LZString Library or options.cache, no compression will occur."}),I.print()),this.options.compression=!1)),this.options.maxLength&&!isNaN(this.options.maxLength)||(this.options.maxLength=1/0),void 0!==this.options.maxItem&&~[0,!1].indexOf(this.options.maxItem)&&(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),this.options.display&&!Array.isArray(this.options.display)&&(this.options.display=[this.options.display]),this.options.multiselect&&(this.items=[],this.comparedItems=[],"string"==typeof this.options.multiselect.matchOn&&(this.options.multiselect.matchOn=[this.options.multiselect.matchOn])),this.options.group&&(Array.isArray(this.options.group)?this.options.debug&&(I.log({node:this.selector,function:"extendOptions()",message:"options.group must be a boolean|string|object as of 2.5.0"}),I.print()):("string"==typeof this.options.group?this.options.group={key:this.options.group}:"boolean"==typeof this.options.group&&(this.options.group={key:"group"}),this.options.group.key=this.options.group.key||"group")),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),this.options.dropdownFilter&&this.options.dropdownFilter instanceof Object){Array.isArray(this.options.dropdownFilter)||(this.options.dropdownFilter=[this.options.dropdownFilter]);for(var t=0,e=this.options.dropdownFilter.length;t<e;++t)this.dropdownFilter[this.options.dropdownFilter[t].value?"static":"dynamic"].push(this.options.dropdownFilter[t])}this.options.dynamicFilter&&!Array.isArray(this.options.dynamicFilter)&&(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"==typeof this.options.accent?this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length!==this.options.accent.to.length&&this.options.debug&&(I.log({node:this.selector,function:"extendOptions()",message:'Invalid "options.accent", from and to must be defined and same length.'}),I.print()):this.options.accent=s),this.options.groupTemplate&&(this.groupTemplate=this.options.groupTemplate),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=j(this.options.resultContainer)),this.options.resultContainer instanceof j&&this.options.resultContainer[0]?this.resultContainer=this.options.resultContainer:this.options.debug&&(I.log({node:this.selector,function:"extendOptions()",message:'Invalid jQuery selector or jQuery Object for "options.resultContainer".'}),I.print())),this.options.group&&this.options.group.key&&(this.groupBy=this.options.group.key),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=j.extend(!0,{},o,this.options)},unifySourceFormat:function(){var t,e,i;for(t in this.dynamicGroups=[],Array.isArray(this.options.source)&&(this.options.source={group:{data:this.options.source}}),"string"==typeof this.options.source&&(this.options.source={group:{ajax:{url:this.options.source}}}),this.options.source.ajax&&(this.options.source={group:{ajax:this.options.source.ajax}}),(this.options.source.url||this.options.source.data)&&(this.options.source={group:this.options.source}),this.options.source)if(this.options.source.hasOwnProperty(t)){if(i=(e="string"==typeof(e=this.options.source[t])?{ajax:{url:e}}:e).url||e.ajax,Array.isArray(i)?(e.ajax="string"==typeof i[0]?{url:i[0]}:i[0],e.ajax.path=e.ajax.path||i[1]||null):"object"==typeof e.url?e.ajax=e.url:"string"==typeof e.url&&(e.ajax={url:e.url}),delete e.url,!e.data&&!e.ajax)return this.options.debug&&(I.log({node:this.selector,function:"unifySourceFormat()",arguments:JSON.stringify(this.options.source),message:'Undefined "options.source.'+t+'.[data|ajax]" is Missing - Typeahead dropped'}),I.print()),!1;e.display&&!Array.isArray(e.display)&&(e.display=[e.display]),e.minLength=("number"==typeof e.minLength?e:this.options).minLength,e.maxLength=("number"==typeof e.maxLength?e:this.options).maxLength,e.dynamic="boolean"==typeof e.dynamic||this.options.dynamic,e.minLength>e.maxLength&&(e.minLength=e.maxLength),this.options.source[t]=e,this.options.source[t].dynamic&&this.dynamicGroups.push(t),e.cache=void 0!==e.cache?this._validateCacheMethod(e.cache):this.options.cache,e.compression&&("object"==typeof LZString&&e.cache||(this.options.debug&&(I.log({node:this.selector,function:"unifySourceFormat()",message:"Missing LZString Library or group.cache, no compression will occur on group: "+t}),I.print()),e.compression=!1))}return this.hasDynamicGroups=this.options.dynamic||!!this.dynamicGroups.length,!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container),this.options.debug&&(I.log({node:this.selector,function:"init()",message:"OK - Typeahead activated on "+this.selector}),I.print())},delegateEvents:function(){var i=this,t=["focus"+this.namespace,"input"+this.namespace,"propertychange"+this.namespace,"keydown"+this.namespace,"keyup"+this.namespace,"search"+this.namespace,"generate"+this.namespace];j("html").on("touchmove",function(){i.hasDragged=!0}).on("touchstart",function(){i.hasDragged=!1}),this.node.closest("form").on("submit",function(t){return i.options.mustSelectItem&&i.helper.isEmpty(i.item)?void t.preventDefault():(i.options.backdropOnFocus||i.hideLayout(),i.options.callback.onSubmit?i.helper.executeCallback.call(i,i.options.callback.onSubmit,[i.node,this,i.item||i.items,t]):void 0)}).on("reset",function(){setTimeout(function(){i.node.trigger("input"+i.namespace),i.hideLayout()})});var e,o=!1;this.node.attr("placeholder")&&(a||l)&&(e=!0,this.node.on("focusin focusout",function(){e=!(this.value||!this.placeholder)}),this.node.on("input",function(t){e&&(t.stopImmediatePropagation(),e=!1)})),this.node.off(this.namespace).on(t.join(" "),function(t,e){switch(t.type){case"generate":i.generateSource(Object.keys(i.options.source));break;case"focus":if(i.focusOnly){i.focusOnly=!1;break}i.options.backdropOnFocus&&(i.buildBackdropLayout(),i.showLayout()),i.options.searchOnFocus&&!i.item&&(i.deferred=j.Deferred(),i.assignQuery(),i.generateSource()),i.options.cancelButton&&i.toggleCancelButtonVisibility(!0);break;case"keydown":8===t.keyCode&&i.options.multiselect&&i.options.multiselect.cancelOnBackspace&&""===i.query&&i.items.length?i.cancelMultiselectItem(i.items.length-1,null,t):t.keyCode&&~[9,13,27,38,39,40].indexOf(t.keyCode)&&(o=!0,i.navigate(t));break;case"keyup":n&&i.node[0].value.replace(/^\s+/,"").toString().length<i.query.length&&i.node.trigger("input"+i.namespace);break;case"propertychange":if(o){o=!1;break}case"input":i.deferred=j.Deferred(),i.assignQuery(),""===i.rawQuery&&""===i.query&&(t.originalEvent=e||{},i.helper.executeCallback.call(i,i.options.callback.onCancel,[i.node,i.item,t]),i.item=null),i.options.cancelButton&&i.toggleCancelButtonVisibility(!0),i.options.hint&&i.hint.container&&""!==i.hint.container.val()&&0!==i.hint.container.val().indexOf(i.rawQuery)&&(i.hint.container.val(""),i.isContentEditable&&i.hint.container.text("")),i.hasDynamicGroups?i.helper.typeWatch(function(){i.generateSource()},i.options.delay):i.generateSource();break;case"search":i.searchResult(),i.buildLayout(),i.result.length||i.searchGroups.length&&i.displayEmptyTemplate?i.showLayout():i.hideLayout(),i.deferred&&i.deferred.resolve()}return i.deferred&&i.deferred.promise()}),this.options.generateOnLoad&&this.node.trigger("generate"+this.namespace)},assignQuery:function(){this.isContentEditable?this.rawQuery=this.node.text():this.rawQuery=this.node.val().toString(),this.rawQuery=this.rawQuery.replace(/^\s+/,""),this.rawQuery!==this.query&&(this.query=this.rawQuery)},filterGenerateSource:function(){if(this.searchGroups=[],this.generateGroups=[],!this.focusOnly||this.options.multiselect)for(var t in this.options.source)this.options.source.hasOwnProperty(t)&&this.query.length>=this.options.source[t].minLength&&this.query.length<=this.options.source[t].maxLength&&(this.filters.dropdown&&"group"===this.filters.dropdown.key&&this.filters.dropdown.value!==t||(this.searchGroups.push(t),!this.options.source[t].dynamic&&this.source[t]||this.generateGroups.push(t)))},generateSource:function(t){if(this.filterGenerateSource(),Array.isArray(t)&&t.length)this.generateGroups=t;else if(!this.generateGroups.length)return void this.node.trigger("search"+this.namespace);if(this.requestGroups=[],this.generatedGroupCount=0,this.options.loadingAnimation&&this.container.addClass("loading"),!this.helper.isEmpty(this.xhr)){for(var e in this.xhr)this.xhr.hasOwnProperty(e)&&this.xhr[e].abort();this.xhr={}}for(var i,o,s,n,r,a,l=this,e=0,c=this.generateGroups.length;e<c;++e){if(i=this.generateGroups[e],n=(s=this.options.source[i]).cache,a=s.compression,n&&(r=window[n].getItem("TYPEAHEAD_"+this.selector+":"+i))){a&&(r=LZString.decompressFromUTF16(r)),a=!1;try{(r=JSON.parse(r+"")).data&&r.ttl>(new Date).getTime()?(this.populateSource(r.data,i),a=!0,this.options.debug&&(I.log({node:this.selector,function:"generateSource()",message:'Source for group "'+i+'" found in '+n}),I.print())):window[n].removeItem("TYPEAHEAD_"+this.selector+":"+i)}catch(t){}if(a)continue}!s.data||s.ajax?s.ajax&&(this.requests[i]||(this.requests[i]=this.generateRequestObject(i)),this.requestGroups.push(i)):"function"==typeof s.data?(o=s.data.call(this),Array.isArray(o)?l.populateSource(o,i):"function"==typeof o.promise&&function(e){j.when(o).then(function(t){t&&Array.isArray(t)&&l.populateSource(t,e)})}(i)):this.populateSource(j.extend(!0,[],s.data),i)}return this.requestGroups.length&&this.handleRequests(),!!this.generateGroups.length},generateRequestObject:function(i){var o=this,s=this.options.source[i],t={request:{url:s.ajax.url||null,dataType:"json",beforeSend:function(t,e){o.xhr[i]=t;t=o.requests[i].callback.beforeSend||s.ajax.beforeSend;"function"==typeof t&&t.apply(null,arguments)}},callback:{beforeSend:null,done:null,fail:null,then:null,always:null},extra:{path:s.ajax.path||null,group:i},validForGroup:[i]};if("function"!=typeof s.ajax&&(s.ajax instanceof Object&&(t=this.extendXhrObject(t,s.ajax)),1<Object.keys(this.options.source).length))for(var e in this.requests)this.requests.hasOwnProperty(e)&&(this.requests[e].isDuplicated||t.request.url&&t.request.url===this.requests[e].request.url&&(this.requests[e].validForGroup.push(i),t.isDuplicated=!0,delete t.validForGroup));return t},extendXhrObject:function(t,e){return"object"==typeof e.callback&&(t.callback=e.callback,delete e.callback),"function"==typeof e.beforeSend&&(t.callback.beforeSend=e.beforeSend,delete e.beforeSend),t.request=j.extend(!0,t.request,e),"jsonp"!==t.request.dataType.toLowerCase()||t.request.jsonpCallback||(t.request.jsonpCallback="callback_"+t.extra.group),t},handleRequests:function(){var t,c=this,h=this.requestGroups.length;if(!1!==this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query]))for(var e=0,i=this.requestGroups.length;e<i;++e)t=this.requestGroups[e],this.requests[t].isDuplicated||function(t,r){if("function"==typeof c.options.source[t].ajax){var e=c.options.source[t].ajax.call(c,c.query);if("object"!=typeof(r=c.extendXhrObject(c.generateRequestObject(t),"object"==typeof e?e:{})).request||!r.request.url)return c.options.debug&&(I.log({node:c.selector,function:"handleRequests",message:'Source function must return an object containing ".url" key for group "'+t+'"'}),I.print()),c.populateSource([],t);c.requests[t]=r}var a,i=!1,l={};if(~r.request.url.indexOf("{{query}}")&&(i||(r=j.extend(!0,{},r),i=!0),r.request.url=r.request.url.replace("{{query}}",encodeURIComponent(c.query))),r.request.data)for(var o in r.request.data)if(r.request.data.hasOwnProperty(o)&&~String(r.request.data[o]).indexOf("{{query}}")){i||(r=j.extend(!0,{},r),i=!0),r.request.data[o]=r.request.data[o].replace("{{query}}",c.query);break}j.ajax(r.request).done(function(t,e,i){for(var o,s=0,n=r.validForGroup.length;s<n;s++)o=r.validForGroup[s],"function"==typeof(a=c.requests[o]).callback.done&&(l[o]=a.callback.done.call(c,t,e,i),Array.isArray(l[o])&&"object"==typeof l[o]||c.options.debug&&(I.log({node:c.selector,function:"Ajax.callback.done()",message:"Invalid returned data has to be an Array"}),I.print()))}).fail(function(t,e,i){for(var o=0,s=r.validForGroup.length;o<s;o++)(a=c.requests[r.validForGroup[o]]).callback.fail instanceof Function&&a.callback.fail.call(c,t,e,i);c.options.debug&&(I.log({node:c.selector,function:"Ajax.callback.fail()",arguments:JSON.stringify(r.request),message:e}),console.log(i),I.print())}).always(function(t,e,i){for(var o,s=0,n=r.validForGroup.length;s<n;s++){if(o=r.validForGroup[s],(a=c.requests[o]).callback.always instanceof Function&&a.callback.always.call(c,t,e,i),"abort"===e)return;c.populateSource((null!==t&&"function"==typeof t.promise?[]:l[o])||t,a.extra.group,a.extra.path||a.request.path),0===--h&&c.helper.executeCallback.call(c,c.options.callback.onReceiveRequest,[c.node,c.query])}}).then(function(t,e){for(var i=0,o=r.validForGroup.length;i<o;i++)(a=c.requests[r.validForGroup[i]]).callback.then instanceof Function&&a.callback.then.call(c,t,e)})}(t,this.requests[t])},populateSource:function(i,t,e){var o=this,s=this.options.source[t],n=s.ajax&&s.data;void 0===(i=e&&"string"==typeof e?this.helper.namespace.call(this,e,i):i)&&this.options.debug&&(I.log({node:this.selector,function:"populateSource()",arguments:e,message:"Invalid data path."}),I.print()),Array.isArray(i)||(this.options.debug&&(I.log({node:this.selector,function:"populateSource()",arguments:JSON.stringify({group:t}),message:"Invalid data type, must be Array type."}),I.print()),i=[]),n&&("function"==typeof n&&(n=n()),Array.isArray(n)?i=i.concat(n):this.options.debug&&(I.log({node:this.selector,function:"populateSource()",arguments:JSON.stringify(n),message:"WARNING - this.options.source."+t+".data Must be an Array or a function that returns an Array."}),I.print()));for(var r,a=s.display?"compiled"===s.display[0]?s.display[1]:s.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],l=0,c=i.length;l<c;l++)null!==i[l]&&"boolean"!=typeof i[l]?("string"==typeof i[l]&&((r={})[a]=i[l],i[l]=r),i[l].group=t):this.options.debug&&(I.log({node:this.selector,function:"populateSource()",message:"WARNING - NULL/BOOLEAN value inside "+t+"! The data was skipped."}),I.print());if(!this.hasDynamicGroups&&this.dropdownFilter.dynamic.length)for(var h,p,u={},l=0,c=i.length;l<c;l++)for(var d=0,f=this.dropdownFilter.dynamic.length;d<f;d++)h=this.dropdownFilter.dynamic[d].key,(p=i[l][h])&&(this.dropdownFilter.dynamic[d].value||(this.dropdownFilter.dynamic[d].value=[]),u[h]||(u[h]=[]),~u[h].indexOf(p.toLowerCase())||(u[h].push(p.toLowerCase()),this.dropdownFilter.dynamic[d].value.push(p)));if(this.options.correlativeTemplate){var g=s.template||this.options.template,m="";if(g="function"==typeof g?g.call(this,"",{}):g){if(Array.isArray(this.options.correlativeTemplate))for(l=0,c=this.options.correlativeTemplate.length;l<c;l++)m+="{{"+this.options.correlativeTemplate[l]+"}} ";else m=g.replace(/<.+?>/g," ").replace(/\s{2,}/," ").trim();for(l=0,c=i.length;l<c;l++)i[l].compiled=j("<textarea />").html(m.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(t,e){return o.helper.namespace.call(o,e,i[l],"get","")}).trim()).text();s.display?~s.display.indexOf("compiled")||s.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}else this.options.debug&&(I.log({node:this.selector,function:"populateSource()",arguments:String(t),message:"WARNING - this.options.correlativeTemplate is enabled but no template was found."}),I.print())}this.options.callback.onPopulateSource&&(i=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,i,t,e]),this.options.debug&&(i&&Array.isArray(i)||(I.log({node:this.selector,function:"callback.populateSource()",message:'callback.onPopulateSource must return the "data" parameter'}),I.print()))),this.tmpSource[t]=Array.isArray(i)&&i||[];n=this.options.source[t].cache,g=this.options.source[t].compression,s=this.options.source[t].ttl||this.options.ttl;n&&!window[n].getItem("TYPEAHEAD_"+this.selector+":"+t)&&(this.options.callback.onCacheSave&&(i=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,i,t,e]),this.options.debug&&(i&&Array.isArray(i)||(I.log({node:this.selector,function:"callback.populateSource()",message:'callback.onCacheSave must return the "data" parameter'}),I.print()))),s=JSON.stringify({data:i,ttl:(new Date).getTime()+s}),g&&(s=LZString.compressToUTF16(s)),window[n].setItem("TYPEAHEAD_"+this.selector+":"+t,s)),this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){if(this.generatedGroupCount++,this.generatedGroupCount===this.generateGroups.length){this.xhr={};for(var t=0,e=this.generateGroups.length;t<e;t++)this.source[this.generateGroups[t]]=this.tmpSource[this.generateGroups[t]];this.hasDynamicGroups||this.buildDropdownItemLayout("dynamic"),this.options.loadingAnimation&&this.container.removeClass("loading"),this.node.trigger("search"+this.namespace)}},navigate:function(t){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,t]),27===t.keyCode)return t.preventDefault(),void(this.query.length?(this.resetInput(),this.node.trigger("input"+this.namespace,[t])):(this.node.blur(),this.hideLayout()));if(this.result.length){var e,i=this.resultContainer.find("."+this.options.selector.item).not("[disabled]"),o=i.filter(".active"),s=o[0]?i.index(o):null,n=o[0]?o.attr("data-index"):null,r=null;if(this.clearActiveItem(),this.helper.executeCallback.call(this,this.options.callback.onLeave,[this.node,null!==s&&i.eq(s)||void 0,null!==n&&this.result[n]||void 0,t]),13===t.keyCode)return t.preventDefault(),void(0<o.length?"javascript:;"===o.find("a:first")[0].href?o.find("a:first").trigger("click",t):o.find("a:first")[0].click():this.node.closest("form").trigger("submit"));39!==t.keyCode?(9===t.keyCode?this.options.blurOnTab?this.hideLayout():0<o.length?s+1<i.length?(t.preventDefault(),this.addActiveItem(i.eq(r=s+1))):this.hideLayout():i.length?(t.preventDefault(),r=0,this.addActiveItem(i.first())):this.hideLayout():38===t.keyCode?(t.preventDefault(),0<o.length?0<=s-1&&this.addActiveItem(i.eq(r=s-1)):i.length&&(r=i.length-1,this.addActiveItem(i.last()))):40===t.keyCode&&(t.preventDefault(),0<o.length?s+1<i.length&&this.addActiveItem(i.eq(r=s+1)):i.length&&(r=0,this.addActiveItem(i.first()))),e=null!==r?i.eq(r).attr("data-index"):null,this.helper.executeCallback.call(this,this.options.callback.onEnter,[this.node,null!==r&&i.eq(r)||void 0,null!==e&&this.result[e]||void 0,t]),t.preventInputChange&&~[38,40].indexOf(t.keyCode)&&this.buildHintLayout(null!==e&&e<this.result.length?[this.result[e]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",t.preventInputChange?this.hint.css.color:null===e&&this.hint.css.color||this.hint.container.css("background-color")||"fff"),o=null===e||t.preventInputChange?this.rawQuery:this.getTemplateValue.call(this,this.result[e]),this.node.val(o),this.isContentEditable&&this.node.text(o),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,i,null!==r&&i.eq(r).find("a:first")||void 0,null!==e&&this.result[e]||void 0,this.query,t])):null!==s?i.eq(s).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&i.filter('[data-index="'+this.hintIndex+'"]').find("a:first")[0].click()}},getTemplateValue:function(i){if(i){var t=i.group&&this.options.source[i.group].templateValue||this.options.templateValue;if(!(t="function"==typeof t?t.call(this):t))return this.helper.namespace.call(this,i.matchedKey,i).toString();var o=this;return t.replace(/\{\{([\w\-.]+)}}/gi,function(t,e){return o.helper.namespace.call(o,e,i,"get","")})}},clearActiveItem:function(){this.resultContainer.find("."+this.options.selector.item).removeClass("active")},addActiveItem:function(t){t.addClass("active")},searchResult:function(){this.resetLayout(),!1!==this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])&&(!this.searchGroups.length||this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit||this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]),this.isDropdownEvent&&(this.helper.executeCallback.call(this,this.options.callback.onDropdownFilter,[this.node,this.query,this.filters.dropdown,this.result]),this.isDropdownEvent=!1))},searchResultData:function(){var t,e,i,o,s,n=this.groupBy,r=this.query.toLowerCase(),a=this.options.maxItem,l=this.options.maxItemPerGroup,c=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),h={},p="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(r=this.helper.removeAccent.call(this,r));for(var u=0,d=this.searchGroups.length;u<d;++u)if(A=this.searchGroups[u],!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===A)for(var f=(void 0!==this.options.source[A].filter?this.options.source[A]:this.options).filter,g="function"==typeof this.options.source[A].matcher&&this.options.source[A].matcher||p,m=0,y=this.source[A].length;m<y&&(!(this.resultItemCount>=a)||this.options.callback.onResult);m++)if((!c||this.dynamicFilter.validate.apply(this,[this.source[A][m]]))&&null!==(e=this.source[A][m])&&"boolean"!=typeof e&&(!this.options.multiselect||this.isMultiselectUniqueData(e))&&(!this.filters.dropdown||(e[this.filters.dropdown.key]||"").toLowerCase()===(this.filters.dropdown.value||"").toLowerCase())){if((t="group"===n?A:e[n]||e.group)&&!this.tmpResult[t]&&(this.tmpResult[t]=[],this.resultCountPerGroup[t]=0),l&&"group"===n&&this.tmpResult[t].length>=l&&!this.options.callback.onResult)break;for(var b=0,v=(O=this.options.source[A].display||this.options.display).length;b<v;++b){if(!1!==f){if(void 0===(o=/\./.test(O[b])?this.helper.namespace.call(this,O[b],e):e[O[b]])||""===o){this.options.debug&&(h[b]={display:O[b],data:e});continue}o=this.helper.cleanStringFromScript(o)}if("function"==typeof f){if(void 0===(s=f.call(this,e,o)))break;if(!s)continue;"object"==typeof s&&(e=s)}if(~[void 0,!0].indexOf(f)){if(null===o)continue;if(i=(i=o).toString().toLowerCase(),s=(i=this.options.accent?this.helper.removeAccent.call(this,i):i).indexOf(r),this.options.correlativeTemplate&&"compiled"===O[b]&&s<0&&/\s/.test(r))for(var k,x=!0,w=i,C=0,S=(k=r.split(" ")).length;C<S;C++)if(""!==k[C]){if(!~w.indexOf(k[C])){x=!1;break}w=w.replace(k[C],"")}if(s<0&&!x)continue;if(this.options.offset&&0!==s)continue;if(g){if(void 0===(s=g.call(this,e,o)))break;if(!s)continue;"object"==typeof s&&(e=s)}}if(this.resultCount++,this.resultCountPerGroup[t]++,this.resultItemCount<a){if(l&&this.tmpResult[t].length>=l)break;this.tmpResult[t].push(j.extend(!0,{matchedKey:O[b]},e)),this.resultItemCount++}break}if(!this.options.callback.onResult){if(this.resultItemCount>=a)break;if(l&&this.tmpResult[t].length>=l&&"group"===n)break}}if(this.options.debug&&(this.helper.isEmpty(h)||(I.log({node:this.selector,function:"searchResult()",arguments:JSON.stringify(h),message:"Missing keys for display, make sure options.display is set properly."}),I.print())),this.options.order){var q,A,O=[];for(A in this.tmpResult)if(this.tmpResult.hasOwnProperty(A)){for(u=0,d=this.tmpResult[A].length;u<d;u++)q=this.options.source[this.tmpResult[A][u].group].display||this.options.display,~O.indexOf(q[0])||O.push(q[0]);this.tmpResult[A].sort(this.helper.sort(O,"asc"===this.options.order,function(t){return t.toString().toUpperCase()}))}}for(var L=[],F=[],u=0,d=(F="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.tmpResult,this.resultCount,this.resultCountPerGroup]):Array.isArray(this.options.groupOrder)?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.tmpResult).sort(this.helper.sort([],"asc"===this.options.groupOrder,function(t){return t.toString().toUpperCase()})):Object.keys(this.tmpResult)).length;u<d;u++)L=L.concat(this.tmpResult[F[u]]||[]);this.groups=JSON.parse(JSON.stringify(F)),this.result=L},buildLayout:function(){this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore&&(this.tmpResultHtml=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml])),this.tmpResultHtml instanceof j?this.resultContainer.html(this.tmpResultHtml):this.resultHtml instanceof j&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(!1!==this.options.resultContainer){var c;if(this.resultContainer||(this.resultContainer=j("<div/>",{class:this.options.selector.result}),this.container.append(this.resultContainer)),!this.result.length)if(this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit)c=this.options.multiselect.limitTemplate?"function"==typeof this.options.multiselect.limitTemplate?this.options.multiselect.limitTemplate.call(this,this.query):this.options.multiselect.limitTemplate.replace(/\{\{query}}/gi,j("<div>").text(this.helper.cleanStringFromScript(this.query)).html()):"Can't select more than "+this.items.length+" items.";else{if(!this.options.emptyTemplate||""===this.query)return;c="function"==typeof this.options.emptyTemplate?this.options.emptyTemplate.call(this,this.query):this.options.emptyTemplate.replace(/\{\{query}}/gi,j("<div>").text(this.helper.cleanStringFromScript(this.query)).html())}this.displayEmptyTemplate=!!c;var s=this.query.toLowerCase();this.options.accent&&(s=this.helper.removeAccent.call(this,s));var h=this,t=this.groupTemplate||"<ul></ul>",p=!1;this.groupTemplate?t=j(t.replace(/<([^>]+)>\{\{(.+?)}}<\/[^>]+>/g,function(t,e,i,o,s){var n="",r="group"===i?h.groups:[i];if(!h.result.length)return!0===p?"":(p=!0,"<"+e+' class="'+h.options.selector.empty+'">'+c+"</"+e+">");for(var a=0,l=r.length;a<l;++a)n+="<"+e+' data-group-template="'+r[a]+'"><ul></ul></'+e+">";return n})):(t=j(t),this.result.length||t.append(c instanceof j?c:'<li class="'+h.options.selector.empty+'">'+c+"</li>")),t.addClass(this.options.selector.list+(this.helper.isEmpty(this.result)?" empty":""));for(var e,i,n,o,r,a,l,u,d,f,g=this.groupTemplate&&this.result.length&&h.groups||[],m=0,y=this.result.length;m<y;++m)e=(n=this.result[m]).group,o=!this.options.multiselect&&this.options.source[n.group].href||this.options.href,l=[],u=this.options.source[n.group].display||this.options.display,this.options.group&&(e=n[this.options.group.key],this.options.group.template&&("function"==typeof this.options.group.template?i=this.options.group.template.call(this,n):"string"==typeof this.options.group.template&&(i=this.options.group.template.replace(/\{\{([\w\-\.]+)}}/gi,function(t,e){return h.helper.namespace.call(h,e,n,"get","")}))),t.find('[data-search-group="'+e+'"]')[0]||(this.groupTemplate?t.find('[data-group-template="'+e+'"] ul'):t).append(j("<li/>",{class:h.options.selector.group,html:j("<a/>",{href:"javascript:;",html:i||e,tabindex:-1}),"data-search-group":e}))),this.groupTemplate&&g.length&&~(f=g.indexOf(e||n.group))&&g.splice(f,1),o=j("<li/>",{class:h.options.selector.item+" "+h.options.selector.group+"-"+this.helper.slugify.call(this,e),disabled:!!n.disabled,"data-group":e,"data-index":m,html:j("<a/>",{href:o&&!n.disabled?n.href=h.generateHref.call(h,o,n):"javascript:;",html:function(){if(r=n.group&&h.options.source[n.group].template||h.options.template)"function"==typeof r&&(r=r.call(h,h.query,n)),a=r.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,i){var o=h.helper.cleanStringFromScript(String(h.helper.namespace.call(h,e,n,"get","")));return~(i=i&&i.split("|")||[]).indexOf("slugify")&&(o=h.helper.slugify.call(h,o)),~i.indexOf("raw")||!0===h.options.highlight&&s&&~u.indexOf(e)&&(o=h.helper.highlight.call(h,o,s.split(" "),h.options.accent)),o});else{for(var t=0,e=u.length;t<e;t++)void 0!==(d=/\./.test(u[t])?h.helper.namespace.call(h,u[t],n,"get",""):n[u[t]])&&""!==d&&l.push(d);a='<span class="'+h.options.selector.display+'">'+h.helper.cleanStringFromScript(String(l.join(" ")))+"</span>"}(!0===h.options.highlight&&s&&!r||"any"===h.options.highlight)&&(a=h.helper.highlight.call(h,a,s.split(" "),h.options.accent)),j(this).append(a)}})}),function(i,t){t.on("click",function(t,e){i.disabled?t.preventDefault():(e&&"object"==typeof e&&(t.originalEvent=e),h.options.mustSelectItem&&h.helper.isEmpty(i)?t.preventDefault():(h.options.multiselect||(h.item=i),!1!==h.helper.executeCallback.call(h,h.options.callback.onClickBefore,[h.node,j(this),i,t])&&(t.originalEvent&&t.originalEvent.defaultPrevented||t.isDefaultPrevented()||(h.options.multiselect?(h.query=h.rawQuery="",h.addMultiselectItemLayout(i)):(h.focusOnly=!0,h.query=h.rawQuery=h.getTemplateValue.call(h,i),h.isContentEditable&&(h.node.text(h.query),h.helper.setCaretAtEnd(h.node[0]))),h.options.blurOnItemClick&&h.hideLayout(),h.node.val(h.query).focus(),h.options.cancelButton&&h.toggleCancelButtonVisibility(),h.helper.executeCallback.call(h,h.options.callback.onClickAfter,[h.node,j(this),i,t])))))}),t.on("mouseenter",function(t){i.disabled||(h.clearActiveItem(),h.addActiveItem(j(this))),h.helper.executeCallback.call(h,h.options.callback.onEnter,[h.node,j(this),i,t])}),t.on("mouseleave",function(t){i.disabled||h.clearActiveItem(),h.helper.executeCallback.call(h,h.options.callback.onLeave,[h.node,j(this),i,t])})}(n,o),(this.groupTemplate?t.find('[data-group-template="'+e+'"] ul'):t).append(o);if(this.result.length&&g.length)for(m=0,y=g.length;m<y;++m)t.find('[data-group-template="'+g[m]+'"]').remove();this.resultHtml=t}},generateHref:function(t,o){var s=this;return"string"==typeof t?t=t.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,i){e=s.helper.namespace.call(s,e,o,"get","");return e=~(i=i&&i.split("|")||[]).indexOf("slugify")?s.helper.slugify.call(s,e):e}):"function"==typeof t&&(t=t.call(this,o)),t},getMultiselectComparedData:function(t){var e="";if(Array.isArray(this.options.multiselect.matchOn))for(var i=0,o=this.options.multiselect.matchOn.length;i<o;++i)e+=void 0!==t[this.options.multiselect.matchOn[i]]?t[this.options.multiselect.matchOn[i]]:"";else{for(var s=JSON.parse(JSON.stringify(t)),n=["group","matchedKey","compiled","href"],i=0,o=n.length;i<o;++i)delete s[n[i]];e=JSON.stringify(s)}return e},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=j.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=j("<div/>",{class:this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(t){if(this.options.hint)if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth()))this.hint.container&&this.hint.container.val("");else{var e=this,i="",t=t||this.result,o=this.query.toLowerCase();if(this.options.accent&&(o=this.helper.removeAccent.call(this,o)),this.hintIndex=null,this.searchGroups.length){if(this.hint.container||(this.hint.css=j.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,float:"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=j("<"+this.node[0].nodeName+"/>",{type:this.node.attr("type"),class:this.node.attr("class"),readonly:!0,unselectable:"on","aria-hidden":"true",tabindex:-1,click:function(){e.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),o)for(var s,n=0,r=t.length;n<r;n++)if(!t[n].disabled){for(var a,l=t[n].group,c=0,h=(a=this.options.source[l].display||this.options.display).length;c<h;c++)if(s=String(t[n][a[c]]).toLowerCase(),0===(s=this.options.accent?this.helper.removeAccent.call(this,s):s).indexOf(o)){i=String(t[n][a[c]]),this.hintIndex=n;break}if(null!==this.hintIndex)break}var p=0<i.length&&this.rawQuery+i.substring(this.query.length)||"";this.hint.container.val(p),this.isContentEditable&&this.hint.container.text(p)}}},buildDropdownLayout:function(){var i;this.options.dropdownFilter&&j("<span/>",{class:(i=this).options.selector.filter,html:function(){j(this).append(j("<button/>",{type:"button",class:i.options.selector.filterButton,style:"display: none;",click:function(){i.container.toggleClass("filter");var e=i.namespace+"-dropdown-filter";j("html").off(e),i.container.hasClass("filter")&&j("html").on("click"+e+" touchend"+e,function(t){j(t.target).closest("."+i.options.selector.filter)[0]&&j(t.target).closest(i.container)[0]||i.hasDragged||(i.container.removeClass("filter"),j("html").off(e))})}})),j(this).append(j("<ul/>",{class:i.options.selector.dropdown}))}}).insertAfter(i.container.find("."+i.options.selector.query))},buildDropdownItemLayout:function(t){if(this.options.dropdownFilter){var e,i,s=this,n="string"==typeof this.options.dropdownFilter&&this.options.dropdownFilter||"All",r=this.container.find("."+this.options.selector.dropdown);"static"!==t||!0!==this.options.dropdownFilter&&"string"!=typeof this.options.dropdownFilter||this.dropdownFilter.static.push({key:"group",template:"{{group}}",all:n,value:Object.keys(this.options.source)});for(var o=0,a=this.dropdownFilter[t].length;o<a;o++){i=this.dropdownFilter[t][o],Array.isArray(i.value)||(i.value=[i.value]),i.all&&(this.dropdownFilterAll=i.all);for(var l=0,c=i.value.length;l<=c;l++)l===c&&o!==a-1||l===c&&o===a-1&&"static"===t&&this.dropdownFilter.dynamic.length||(e=this.dropdownFilterAll||n,i.value[l]?e=i.template?i.template.replace(new RegExp("{{"+i.key+"}}","gi"),i.value[l]):i.value[l]:this.container.find("."+s.options.selector.filterButton).html(e),function(e,i,o){r.append(j("<li/>",{class:s.options.selector.dropdownItem+" "+s.helper.slugify.call(s,i.key+"-"+(i.value[e]||n)),html:j("<a/>",{href:"javascript:;",html:o,click:function(t){t.preventDefault(),h.call(s,{key:i.key,value:i.value[e]||"*",template:o})}})}))}(l,i,e))}this.dropdownFilter[t].length&&this.container.find("."+s.options.selector.filterButton).removeAttr("style")}function h(t){"*"===t.value?delete this.filters.dropdown:this.filters.dropdown=t,this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(t.template),this.isDropdownEvent=!0,this.node.trigger("input"+this.namespace),this.options.multiselect&&this.adjustInputSize(),this.node.focus()}},dynamicFilter:{isEnabled:!1,init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.dynamicFilter.isEnabled=!0)},validate:function(t){var e,i,o,s=null,n=null;for(o in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(o)&&(i=~o.indexOf(".")?this.helper.namespace.call(this,o,t,"get"):t[o],"|"!==this.filters.dynamic[o].modifier||s||(s=i==this.filters.dynamic[o].value||!1),"&"===this.filters.dynamic[o].modifier)){if(i!=this.filters.dynamic[o].value){n=!1;break}n=!0}return e=s,!!(e=null!==n&&!0===(e=n)&&null!==s?s:e)},set:function(t,e){t=t.match(/^([|&])?(.+)/);e?this.filters.dynamic[t[2]]={modifier:t[1]||"|",value:e}:delete this.filters.dynamic[t[2]],this.dynamicFilter.isEnabled&&this.generateSource()},bind:function(){for(var t,e=this,i=0,o=this.options.dynamicFilter.length;i<o;i++)"string"==typeof(t=this.options.dynamicFilter[i]).selector&&(t.selector=j(t.selector)),t.selector instanceof j&&t.selector[0]&&t.key?function(t){t.selector.off(e.namespace).on("change"+e.namespace,function(){e.dynamicFilter.set.apply(e,[t.key,e.dynamicFilter.getValue(this)])}).trigger("change"+e.namespace)}(t):this.options.debug&&(I.log({node:this.selector,function:"buildDynamicLayout()",message:'Invalid jQuery selector or jQuery Object for "filter.selector" or missing filter.key'}),I.print())},getValue:function(t){var e;return"SELECT"===t.tagName?e=t.value:"INPUT"===t.tagName&&("checkbox"===t.type?e=t.checked&&t.getAttribute("value")||t.checked||null:"radio"===t.type&&t.checked&&(e=t.value)),e}},buildMultiselectLayout:function(){var e,t;this.options.multiselect&&((e=this).label.container=j("<span/>",{class:this.options.selector.labelContainer,"data-padding-left":parseFloat(this.node.css("padding-left"))||0,"data-padding-right":parseFloat(this.node.css("padding-right"))||0,"data-padding-top":parseFloat(this.node.css("padding-top"))||0,click:function(t){j(t.target).hasClass(e.options.selector.labelContainer)&&e.node.focus()}}),this.node.closest("."+this.options.selector.query).prepend(this.label.container),this.options.multiselect.data&&(Array.isArray(this.options.multiselect.data)?this.populateMultiselectData(this.options.multiselect.data):"function"==typeof this.options.multiselect.data&&(t=this.options.multiselect.data.call(this),Array.isArray(t)?this.populateMultiselectData(t):"function"==typeof t.promise&&j.when(t).then(function(t){t&&Array.isArray(t)&&e.populateMultiselectData(t)}))))},isMultiselectUniqueData:function(t){for(var e=!0,i=0,o=this.comparedItems.length;i<o;++i)if(this.comparedItems[i]===this.getMultiselectComparedData(t)){e=!1;break}return e},populateMultiselectData:function(t){for(var e=0,i=t.length;e<i;++e)this.addMultiselectItemLayout(t[e]);this.node.trigger("search"+this.namespace,{origin:"populateMultiselectData"})},addMultiselectItemLayout:function(t){if(this.isMultiselectUniqueData(t)){this.items.push(t),this.comparedItems.push(this.getMultiselectComparedData(t));var e,i=this.getTemplateValue(t),o=this,t=this.options.multiselect.href?"a":"span",e=j("<span/>",{class:this.options.selector.label,html:j("<"+t+"/>",{text:i,click:function(t){var e=j(this).closest("."+o.options.selector.label),e=o.label.container.find("."+o.options.selector.label).index(e);o.options.multiselect.callback&&o.helper.executeCallback.call(o,o.options.multiselect.callback.onClick,[o.node,o.items[e],t])},href:this.options.multiselect.href?(e=o.items[o.items.length-1],o.generateHref.call(o,o.options.multiselect.href,e)):null})});return e.append(j("<span/>",{class:this.options.selector.cancelButton,html:"×",click:function(t){var e=j(this).closest("."+o.options.selector.label),i=o.label.container.find("."+o.options.selector.label).index(e);o.cancelMultiselectItem(i,e,t)}})),this.label.container.append(e),this.adjustInputSize(),!0}},cancelMultiselectItem:function(t,e,i){var o=this.items[t];(e=e||this.label.container.find("."+this.options.selector.label).eq(t)).remove(),this.items.splice(t,1),this.comparedItems.splice(t,1),this.options.multiselect.callback&&this.helper.executeCallback.call(this,this.options.multiselect.callback.onCancel,[this.node,o,i]),this.adjustInputSize(),this.focusOnly=!0,this.node.focus().trigger("input"+this.namespace,{origin:"cancelMultiselectItem"})},adjustInputSize:function(){var i,o=this.node[0].getBoundingClientRect().width-(parseFloat(this.label.container.data("padding-right"))||0)-(parseFloat(this.label.container.css("padding-left"))||0),s=0,n=0,r=!1,a=0;this.label.container.find("."+this.options.selector.label).filter(function(t,e){0===t&&(a=j(e)[0].getBoundingClientRect().height+parseFloat(j(e).css("margin-bottom")||0)),i=j(e)[0].getBoundingClientRect().width+parseFloat(j(e).css("margin-right")||0),.7*o<n+i&&!r&&(s++,r=!0),n+i<o?n+=i:(r=!1,n=i)});var t=parseFloat(this.label.container.data("padding-left")||0)+(r?0:n),e=s*a+parseFloat(this.label.container.data("padding-top")||0);this.container.find("."+this.options.selector.query).find("input, textarea, [contenteditable], .typeahead__hint").css({paddingLeft:t,paddingTop:e})},showLayout:function(){!this.container.hasClass("result")&&(this.result.length||this.displayEmptyTemplate||this.options.backdropOnFocus)&&(!function(){var e=this;j("html").off("keydown"+this.namespace).on("keydown"+this.namespace,function(t){t.keyCode&&9===t.keyCode&&setTimeout(function(){j(":focus").closest(e.container).find(e.node)[0]||e.hideLayout()},0)}),j("html").off("click"+this.namespace+" touchend"+this.namespace).on("click"+this.namespace+" touchend"+this.namespace,function(t){j(t.target).closest(e.container)[0]||j(t.target).closest("."+e.options.selector.item)[0]||t.target.className===e.options.selector.cancelButton||e.hasDragged||e.hideLayout()})}.call(this),this.container.addClass([this.result.length||this.searchGroups.length&&this.displayEmptyTemplate?"result ":"",this.options.hint&&this.searchGroups.length?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query]))},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&j(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(j("html").off(this.namespace),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result=[],this.tmpResult={},this.groups=[],this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&(this.hint.container.val(""),this.isContentEditable&&this.hint.container.text(""))},resetInput:function(){this.node.val(""),this.isContentEditable&&this.node.text(""),this.query="",this.rawQuery=""},buildCancelButtonLayout:function(){var e;this.options.cancelButton&&j("<span/>",{class:(e=this).options.selector.cancelButton,html:"×",mousedown:function(t){t.stopImmediatePropagation(),t.preventDefault(),e.resetInput(),e.node.trigger("input"+e.namespace,[t])}}).insertBefore(this.node)},toggleCancelButtonVisibility:function(t){this.container.toggleClass("cancel",null!=t?t:!!this.query.length)},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.buildDropdownLayout(),this.buildDropdownItemLayout("static"),this.buildMultiselectLayout(),this.delegateEvents(),this.buildCancelButtonLayout(),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},removeAccent:function(t){if("string"==typeof t){var e=s;return"object"==typeof this.options.accent&&(e=this.options.accent),t=t.toLowerCase().replace(new RegExp("["+e.from+"]","g"),function(t){return e.to[e.from.indexOf(t)]})}},slugify:function(t){return t=""!==(t=String(t))?(t=this.helper.removeAccent.call(this,t)).replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""):t},sort:function(o,i,s){function n(t){for(var e=0,i=o.length;e<i;e++)if(void 0!==t[o[e]])return s(t[o[e]]);return t}return i=[-1,1][+!!i],function(t,e){return t=n(t),e=n(e),i*((e<t)-(t<e))}},replaceAt:function(t,e,i,o){return t.substring(0,e)+o+t.substring(e+i)},highlight:function(t,e,i){t=String(t);var i=i&&this.helper.removeAccent.call(this,t)||t,o=[];(e=!Array.isArray(e)?[e]:e).sort(function(t,e){return e.length-t.length});for(var s=e.length-1;0<=s;s--)""!==e[s].trim()?e[s]=e[s].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e.splice(s,1);i.replace(new RegExp("(?:"+e.join("|")+")(?!([^<]+)?>)","gi"),function(t,e,i){o.push({offset:i,length:t.length})});for(s=o.length-1;0<=s;s--)t=this.helper.replaceAt(t,o[s].offset,o[s].length,"<strong>"+t.substr(o[s].offset,o[s].length)+"</strong>");return t},getCaret:function(t){var e=0;if(t.selectionStart)return t.selectionStart;if(document.selection){var i=document.selection.createRange();if(null===i)return e;var o=t.createTextRange(),s=o.duplicate();o.moveToBookmark(i.getBookmark()),s.setEndPoint("EndToStart",o),e=s.text.length}else window.getSelection&&(!(s=window.getSelection()).rangeCount||(s=s.getRangeAt(0)).commonAncestorContainer.parentNode==t&&(e=s.endOffset));return e},setCaretAtEnd:function(t){var e,i;void 0!==window.getSelection&&void 0!==document.createRange?((i=document.createRange()).selectNodeContents(t),i.collapse(!1),(e=window.getSelection()).removeAllRanges(),e.addRange(i)):void 0!==document.body.createTextRange&&((i=document.body.createTextRange()).moveToElementText(t),i.collapse(!1),i.select())},cleanStringFromScript:function(t){return"string"==typeof t&&t.replace(/<\/?(?:script|iframe)\b[^>]*>/gm,"")||t},executeCallback:function(t,e){if(t){var i;if("function"==typeof t)i=t;else if(("string"==typeof t||Array.isArray(t))&&"function"!=typeof(i=this.helper.namespace.call(this,(t="string"==typeof t?[t,[]]:t)[0],window)))return void(this.options.debug&&(I.log({node:this.selector,function:"executeCallback()",arguments:JSON.stringify(t),message:'WARNING - Invalid callback function"'}),I.print()));return i.apply(this,(t[1]||[]).concat(e||[]))}},namespace:function(t,e,i,o){if("string"!=typeof t||""===t)return this.options.debug&&(I.log({node:this.options.input||this.selector,function:"helper.namespace()",arguments:t,message:'ERROR - Missing string"'}),I.print()),!1;var s=void 0!==o?o:void 0;if(!~t.indexOf("."))return e[t]||s;for(var n,r=t.split("."),a=e||window,i=i||"get",l=0,c=r.length;l<c;l++){if(void 0===a[n=r[l]]){if(~["get","delete"].indexOf(i))return void 0!==o?o:void 0;a[n]={}}if(~["set","create","delete"].indexOf(i)&&l===c-1){if("set"!==i&&"create"!==i)return delete a[n],!0;a[n]=s}a=a[n]}return a},typeWatch:(i=0,function(t,e){clearTimeout(i),i=setTimeout(t,e)})}},j.fn.typeahead=j.typeahead=function(t){return e.typeahead(this,t)};var e={typeahead:function(t,e){if(!e||!e.source||"object"!=typeof e.source)return I.log({node:t.selector||e&&e.input,function:"$.typeahead()",arguments:JSON.stringify(e&&e.source||""),message:'Undefined "options" or "options.source" or invalid source type - Typeahead dropped'}),void I.print();if("function"==typeof t){if(!e.input)return I.log({node:t.selector,function:"$.typeahead()",message:'Undefined "options.input" - Typeahead dropped'}),void I.print();t=j(e.input)}if(void 0===t[0].value&&(t[0].value=t.text()),!t.length)return I.log({node:t.selector,function:"$.typeahead()",arguments:JSON.stringify(e.input),message:"Unable to find jQuery input element - Typeahead dropped"}),void I.print();if(1===t.length)return t[0].selector=t.selector||e.input||t[0].nodeName.toLowerCase(),window.Typeahead[t[0].selector]=new r(t,e);for(var i,o={},s=0,n=t.length;s<n;++s)void 0!==o[i=t[s].nodeName.toLowerCase()]&&(i+=s),t[s].selector=i,window.Typeahead[i]=o[i]=new r(t.eq(s),e);return o}},I={table:{},log:function(t){t.message&&"string"==typeof t.message&&(this.table[t.message]=j.extend({node:"",function:"",arguments:""},t))},print:function(){!r.prototype.helper.isEmpty(this.table)&&console&&console.table&&(void 0===console.group&&void 0===console.table||(console.groupCollapsed("--- jQuery Typeahead Debug ---"),console.table(this.table),console.groupEnd()),this.table={})}};return I.log({message:"WARNING - You are using the DEBUG version. Use /dist/jquery.typeahead.min.js in production."}),I.print(),window.console=window.console||{log:function(){}},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,e){(e=void 0===e?0:e)<0&&(e+=this.length),e<0&&(e=0);for(var i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1}),Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}),r});